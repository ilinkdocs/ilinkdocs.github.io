<!doctype html>
<html lang="ptPT" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-integracao-api-rest" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Integração via API REST | ilink Knowledge Base</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/docs/integracao-api-rest"><meta data-rh="true" property="og:locale" content="ptPT"><meta data-rh="true" property="og:locale:alternate" content="enGB"><meta data-rh="true" name="docusaurus_locale" content="pt"><meta data-rh="true" name="docsearch:language" content="pt"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Integração via API REST | ilink Knowledge Base"><meta data-rh="true" name="description" content="1. Âmbito"><meta data-rh="true" property="og:description" content="1. Âmbito"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/docs/integracao-api-rest"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/integracao-api-rest" hreflang="ptPT"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/en/docs/integracao-api-rest" hreflang="enGB"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/integracao-api-rest" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Integração via API REST","item":"https://your-docusaurus-site.example.com/docs/integracao-api-rest"}]}</script><link rel="stylesheet" href="/assets/css/styles.c09e8c32.css">
<script src="/assets/js/runtime~main.66a586b0.js" defer="defer"></script>
<script src="/assets/js/main.8f562005.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.png"><div role="region" aria-label="Pular para o conteúdo principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Pular para o conteúdo principal</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Alternar a barra de navegação" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="ilink Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="ilink Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">ilink Knowledge Base</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Guias Técnicos</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/integracao-api-rest">API REST</a></li><li><a class="dropdown__link" href="/docs/integracao-as2">AS2</a></li><li><a class="dropdown__link" href="/docs/webhooks-ilink">Webhooks</a></li><li><a class="dropdown__link" href="/docs/onboarding-feap">Onboarding FEAP</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Integrações</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/integracoes-ilink">Lista de Integrações</a></li><li><a class="dropdown__link" href="/docs/moloni">Integração Moloni</a></li><li><a class="dropdown__link" href="/docs/medidata">Integração Medidata</a></li></ul></div><a href="https://www.ilink.pt/swagger-ui/dist/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Especificação Técnica</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Português</a><ul class="dropdown__menu"><li><a href="/docs/integracao-api-rest" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ptPT">Português</a></li><li><a href="/en/docs/integracao-api-rest" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="enGB">English</a></li></ul></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Alterar entre os modos claro e escuro (modo system mode ativado)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Volte para o topo" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">ilink Knowledge Base</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/integracoes-ilink">Lista de Integrações</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/integracao-api-rest">Integração via API REST</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/integracao-as2">Integração via AS2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webhooks-ilink">Webhooks ilink</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/onboarding-feap">Onboarding FEAP</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Página Inicial" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Integração via API REST</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Nessa página</button></div><div class="theme-doc-markdown markdown"><header><h1>Integração via API REST</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-âmbito">1. Âmbito<a href="#1-âmbito" class="hash-link" aria-label="Link direto para 1. Âmbito" title="Link direto para 1. Âmbito">​</a></h2>
<p>O API REST do ilink permite um controlo programático das principais operações de documentos presentes no ilink, facilitando a integração com programas externos.</p>
<p>O ilink distingue 2 fluxos principais de integração: <strong>receção e emissão de documentos</strong>, com respetivo reporte de estados, dos quais poderão ser implementados ambos ou apenas um, dependendo das necessidades do software a integrar.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-notas-técnicas">2. Notas Técnicas<a href="#2-notas-técnicas" class="hash-link" aria-label="Link direto para 2. Notas Técnicas" title="Link direto para 2. Notas Técnicas">​</a></h2>
<ul>
<li>O webservice segue a estrutura <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="noopener noreferrer">REST</a></li>
<li>Os HTTP status codes devolvidos respeitam o <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" target="_blank" rel="noopener noreferrer">RFC 7231</a></li>
<li>Todos os dados enviados (incluindo anexos XML) deverão ser representados em <strong>UTF-8</strong>. Formatos como ANSI, UTF-8 BOM e ISO 8859-1 devem ser evitados de modo a garantir compatibilidade com todos os sistemas recetores</li>
<li>As respostas (payloads) são devolvidas em formato <strong>JSON</strong></li>
<li>Os servidores do ilink funcionam exclusivamente por <strong>HTTPS, com versão TLS 1.2</strong> (em caso de problemas com a comunicação, ver possíveis resoluções para <a href="https://www.google.com/search?q=enable%20tls%201.2%20java&amp;oq=enable%20tls%201.2%20java&amp;aqs=chrome..69i57j0i19i395l4j0i19i22i30l5.5771j1j7&amp;sourceid=chrome&amp;ie=UTF-8" target="_blank" rel="noopener noreferrer">Java</a> e <a href="https://www.google.com/search?q=enable%20tls%201.2%20c#&amp;sxsrf=ALeKk00pvMlLTAafzUGlqvul3udFWBE-Xw:1622739135091&amp;ei=vwi5YLeWBYmIlwTJyT8&amp;oq=enable%20tls%201.2%20c#&amp;gs_lcp=Cgdnd3Mtd2l6EAMyBQgAEMsBMgYIABAWEB4yBggAEBYQHjoHCCMQsAMQJzoHCAAQRxCwAzoCCABQgaQFWKinBWC5qQVoA3ACeACAAXiIAb4CkgEDMS4ymAEAoAEBqgEHZ3dzLXdpesgBCcABAQ&amp;sclient=gws-wiz&amp;ved=0ahUKEwj38dat9vvwAhUJxIUKHcnkDwAQ4dUDCBE&amp;uact=5" target="_blank" rel="noopener noreferrer">C#</a>)</li>
<li>A especificação e cliente de demonstração swagger está disponível <a href="https://ilink.acin.pt/swagger-ui/dist/index.html" target="_blank" rel="noopener noreferrer">aqui</a></li>
<li>Existem 2 ambientes distintos, com URLs base diferentes:<!-- -->
<ul>
<li><strong>Testes/pré-produção</strong>: <a href="https://ilink.acin.pt/ilinktests-api/api/v1/pt" target="_blank" rel="noopener noreferrer">https://ilink.acin.pt/ilinktests-api/api/v1/pt</a></li>
<li><strong>Produção</strong>: <a href="https://ilink.pt/ilink-api/api/v1/pt" target="_blank" rel="noopener noreferrer">https://ilink.pt/ilink-api/api/v1/pt</a></li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Nota:</strong> Os documentos emitidos e recebidos via API podem ser consultados no <a href="https://ilink.acin.pt" target="_blank" rel="noopener noreferrer">portal de testes do ilink</a> usando as credenciais que vos foram enviadas.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-pré-requisitos">3. Pré requisitos<a href="#3-pré-requisitos" class="hash-link" aria-label="Link direto para 3. Pré requisitos" title="Link direto para 3. Pré requisitos">​</a></h2>
<p>De modo a integrar via API, será necessário primeiro entrar em contacto com a nossa equipa (<strong><a href="mailto:apoio@ilink.pt" target="_blank" rel="noopener noreferrer">apoio@ilink.pt</a></strong>) de modo a pedir acessos ao nosso ambiente de testes/qualidade.</p>
<p>Os acessos disponibilizados serão os seguintes:</p>
<ul>
<li>Um <strong>token de plataforma</strong>, que identifica o sistema/plataforma a aceder ao webservice</li>
<li>Uma <strong>chave pública</strong>, que identifica o cliente/NIF que pretende aceder ao webservice</li>
</ul>
<p>Isto significa que <strong>cada cliente que permite emitir ou receber documentos necessita de um pré-registo com a nossa equipa, de modo a ser gerada a sua chave pública</strong>. O token de plataforma será único para o sistema a integrar (comum a todos os clientes que utilizam o vosso sistema), e deverá ser usado em todas as chamadas ao API.</p>
<p>Nos acessos de teste, também são disponibilizados 2 clientes/NIFs, juntamente com os seus logins de acesso ao portal do ilink. Deverão usar estas entidades para transacionar documentos entre si, e opcionalmente aceder ao portal para consulta dos mesmos. Os NIFs atribuídos podem ser alterados se necessário.</p>
<blockquote>
<p><strong>Nota</strong>: Serão enviados novos acessos (token de plataforma e chave pública por NIF) mediante entrada em produção.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-especificação-técnica">4. Especificação técnica<a href="#4-especificação-técnica" class="hash-link" aria-label="Link direto para 4. Especificação técnica" title="Link direto para 4. Especificação técnica">​</a></h2>
<p><a href="https://ilink.acin.pt/swagger-ui/dist/index.html" target="_blank" rel="noopener noreferrer">Aceder à especificação swagger</a></p>
<p>O ilink utiliza uma especificação OpenApi 3, e está disponível <a href="https://ilink.acin.pt/swagger-ui/dist/index.html" target="_blank" rel="noopener noreferrer">aqui</a>. Neste cliente web, poderá efetuar chamadas de teste ao nosso API, analisar as respostas obtidas bem como os dados a enviar para cada endpoint/método.</p>
<p><strong>O cliente swagger disponibilizado acima deverá acompanhar o vosso processo de desenvolvimento.</strong> É também possível verificar como as chamadas ao API são construídas via <a href="https://curl.se/" target="_blank" rel="noopener noreferrer">cURL</a> (ver exemplo abaixo):</p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20210417-111219-88f2f19a5ac787cdbef244dc05f8fb28.png" width="1400" height="539" class="img_ev3q"></p>
<blockquote>
<p><strong>Nota:</strong> São também disponibilizados vários <a href="https://ilink.acin.pt/resources/clients.zip" target="_blank" rel="noopener noreferrer">clientes HTTP,</a> em mais de 50 linguagens e frameworks, gerados automaticamente a partir da nossa especificação, que poderão servir de suporte inicial ao processo de integração.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-autorização">4.1 Autorização<a href="#41-autorização" class="hash-link" aria-label="Link direto para 4.1 Autorização" title="Link direto para 4.1 Autorização">​</a></h3>
<p>Todos os pedidos a efetuar ao API têm de conter obrigatoriamente o header de autorização abaixo:</p>
<ul>
<li><strong>Authorization</strong>: Bearer {TOKEN_PLATAFORMA}</li>
</ul>
<p>No cliente <a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/" target="_blank" rel="noopener noreferrer">Swagger</a>, o processo de autorização é feito inserindo o token de plataforma após clicar no botão <strong>Authorize</strong>.</p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20210415-103308-1912980fe8ad281c1559aadfa9901e69.png" width="1132" height="384" class="img_ev3q"></p>
<p>Após esta operação, deverão notar que todos os pedidos subsequentes ao API incluem o header <em>Authorization</em>:</p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20210417-111632-7d680ad6761f7607defd035c24e6cf22.png" width="1402" height="204" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-autenticação">4.2 Autenticação<a href="#42-autenticação" class="hash-link" aria-label="Link direto para 4.2 Autenticação" title="Link direto para 4.2 Autenticação">​</a></h3>
<p>Antes de efetuar a primeira consulta ao API do ilink, <strong>é obrigatório efetuar uma autenticação por cliente/NIF</strong>. Esta autenticação serve de <em>handshake</em> inicial entre o cliente e o ilink é feita com recurso ao endpoint <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Autentica%C3%A7%C3%A3o/postAuthentications" target="_blank" rel="noopener noreferrer">POST /apps/authentications</a></strong>:</p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20210415-103008-471d454f32df88fc66d0645e76b47275.png" width="1485" height="510" class="img_ev3q"></p>
<p>Uma autenticação válida deverá retornar esta resposta:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;e123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;Integração realizada com sucesso.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>A autenticação tem duração ilimitada (só precisa de ser invocada 1 vez por cliente/NIF que acede ao API). Pode também ser revogada através do método <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Autentica%C3%A7%C3%A3o/deleteAuthentications" target="_blank" rel="noopener noreferrer">DELETE /apps/authentications</a></strong>:</p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20210415-103711-9bb262490b5fe4a378b8e4edde60ea70.png" width="1495" height="328" class="img_ev3q"></p>
<p><strong>Se o processo de autenticação não for concluído, ou o header Authorization não for enviado nos pedidos ao API, todas as chamadas serão recusadas para esse NIF com um erro</strong>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">401</span><span class="token plain"> Unauthorized</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e069&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Autenticação inválida&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Nota: Em ambiente de produção é necessário autenticar novamente cada cliente/NIF.</strong></p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-emissão-de-documentos">5. Emissão de documentos<a href="#5-emissão-de-documentos" class="hash-link" aria-label="Link direto para 5. Emissão de documentos" title="Link direto para 5. Emissão de documentos">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-âmbito">5.1 Âmbito<a href="#51-âmbito" class="hash-link" aria-label="Link direto para 5.1 Âmbito" title="Link direto para 5.1 Âmbito">​</a></h3>
<p>Permite à plataforma integradora emitir documentos no ilink, que são posteriormente enviados para o seu destinatário. O destinatário dos documentos tem configurado no portal do ilink para que sistemas externos os documentos devem ser remetidos. Isto significa que o processo de envio de documentos aos ERPs e EDIs adequados de cada cliente é transparente ao API e fica à responsabilidade do ilink. Estas configurações são efetuadas pela equipa de apoio do ilink antes da passagem a produção.</p>
<p>A plataforma ilink permite o envio de faturas eletrónicas em 2 cenários distintos:</p>
<ul>
<li><strong>Envio de PDF assinado via e-mail para consumidores finais ou empresas privadas</strong>
<ul>
<li>Neste cenário, não será necessário criar ligações entre outros EDIs para o envio de documentos. Basta indicar ao endpoint de criação de documento o(s) endereço(s) de e-mail a remeter o mesmo. Para mais informações, consulte a secção <a href="#53-m%C3%A9todos-de-envio">Métodos de envio</a>.</li>
</ul>
</li>
<li><strong>Envio de XML CIUS-PT para entidades públicas (obrigatório nos contratos públicos)</strong>
<ul>
<li>Neste cenário, será necessário configurar previamente as ligações entre NIFs e possivelmente entre outros brokers EDI externos.</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Como são enviados os documentos para outros brokers EDI?</strong>
Na fase de passagem a produção, deverá ser feito um levantamento de todas as entidades que irão receber documentos via EDI, bem como os seus brokers EDI em uso. De seguida, a equipa de apoio (<a href="mailto:apoio@ilink.pt" target="_blank" rel="noopener noreferrer">apoio@ilink.pt</a>) irá configurar as ligações necessárias de modo a que os documentos sejam integrados automaticamente no sistema de cada recetor. Antes de enviar documentos para a solução FE-AP da eSPap, será também necessário cada emissor de faturas completar o <a href="/docs/onboarding-feap">processo de adesão de fornecedores FE-AP</a>.</p>
</blockquote>
<p>Todos os documentos emitidos ficam disponíveis no portal do ilink tanto na entidade emissora como na entidade recetora dos mesmos.</p>
<blockquote>
<p><strong>Nota: No nosso ambiente de testes, devem emitir documentos apenas entre as 2 entidades que receberam acessos.</strong> Caso pretendam verificar o funcionamento do envio de documentos para um consumidor final (NIF arbitrário), deverão sempre emitir o mesmo por uma das entidades que receberam acessos.</p>
</blockquote>
<p><strong>IMPORTANTE:</strong> Para o envio de documentos a <strong>entidades públicas</strong>, recomendamos fortemente implementar os seguintes campos, sob pena de não integrar os documentos com certos sistemas:</p>
<ul>
<li>Envio do número de compromisso</li>
<li>Envio do ficheiro PDF original da fatura</li>
<li>Envio do número de encomenda ou requisição (se aplicável)</li>
<li>Envio do Capital Social do fornecedor</li>
<li>Envio do endereço de e-mail do cliente (apenas para as secretarias do Governo Regional da Madeira)</li>
<li>Envio de todos os dados da morada do fornecedor (rua, código-postal, cidade, etc.)</li>
<li>Envio do GLN do cliente (se aplicável)</li>
<li>Possibilidade de reenvio do documento mediante o estado obtido (útil para corrigir e reenviar um documento previamente rejeitado)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-assinatura-digital">5.2 Assinatura digital<a href="#52-assinatura-digital" class="hash-link" aria-label="Link direto para 5.2 Assinatura digital" title="Link direto para 5.2 Assinatura digital">​</a></h3>
<p>O ilink permite assinar automaticamente os anexos dos documentos emitidos na plataforma (XML e PDF), desde que a entidade emissora tenha adquirido e configurado o selo de um dos provedores de assinaturas digitais qualificadas. Neste momento, apenas o <a href="https://globaltrustedsign.com/" target="_blank" rel="noopener noreferrer">GTS - Global Trusted Sign</a> é suportado, mas existem planos de suportar os restantes provedores em Portugal (<a href="https://www.multicert.com/pt/" target="_blank" rel="noopener noreferrer">Multicert</a> e <a href="https://www.digitalsign.pt/pt" target="_blank" rel="noopener noreferrer">DigitalSign</a>).</p>
<p>Isto significa que o ERP não é obrigado a integrar com um provedor de assinaturas, deixando (opcionalmente) o processo de certificação à responsabilidade do ilink. A outra alternativa será o próprio ERP efetuar o processo de certificação e enviar os documentos previamente assinados para o ilink.</p>
<blockquote>
<p><strong>Nota:</strong> <strong>No cenário de assinatura via ilink, por defeito, todos os ficheiros resultantes serão assinados no momento de entrada (xml e pdf)</strong>, e só depois remetidos ao cliente. Este processo é configurado no portal web, ficando fora da responsabilidade do API.</p>
</blockquote>
<p><strong>No caso de assinatura via ERP, a assinatura digital do documento será validada a nível criptográfico para todos os documentos que entram no sistema</strong>, e um documento com assinatura inválida, tanto no XML como no PDF não irá integrar e retorna sempre um erro via API como o seguinte:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e217&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;A assinatura do documento não é válida.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>O erro anterior indica que o documento sofreu alterações desde o momento que foi assinado, ou que a assinatura do mesmo foi gerada incorretamente. O seguinte <a href="https://ec.europa.eu/cefdigital/DSS/webapp-demo/validation" target="_blank" rel="noopener noreferrer">validador</a> pode ser utilizado para verificar a validade da assinatura dos documentos. Os formatos de assinatura reconhecidos pelo ilink são <a href="https://www.adobe.com/uk/acrobat/resources/document-files/pdf-types/pades.html" target="_blank" rel="noopener noreferrer">PADES</a> e PKCS7-B (PDF), ou XMLDSig e <a href="https://en.wikipedia.org/wiki/XAdES" target="_blank" rel="noopener noreferrer">XADES-BES</a> (XML).</p>
<blockquote>
<p><strong>Nota:</strong> Os requisitos legais de assinatura das faturas eletrónicas estão disponíveis no <a href="https://dre.pt/home/-/dre/119622094/details/maximized" target="_blank" rel="noopener noreferrer">Decreto-Lei 28/2019, secção II, artigo 12º</a>.</p>
</blockquote>
<blockquote>
<p><strong>Nota:</strong> O ilink assina os documentos PDF em <a href="https://www.adobe.com/uk/acrobat/resources/document-files/pdf-types/pades.html" target="_blank" rel="noopener noreferrer">PADES</a> e os documentos XML em <a href="https://en.wikipedia.org/wiki/XAdES" target="_blank" rel="noopener noreferrer">XADES-BES</a> <a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/ms767623%28v=vs.85%29" target="_blank" rel="noopener noreferrer">enveloped</a>.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-métodos-de-envio">5.3 Métodos de envio<a href="#53-métodos-de-envio" class="hash-link" aria-label="Link direto para 5.3 Métodos de envio" title="Link direto para 5.3 Métodos de envio">​</a></h3>
<p>Após efetuada a autenticação com sucesso, estamos em condições de começar a enviar documentos.
O API do ilink possibilita 2 métodos de envio de documentos:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="a-envio-do-xml-em-formato-ubl-21-cius-pt-ou-ubl-21-peppolbis3---encomendas">a) Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)<a href="#a-envio-do-xml-em-formato-ubl-21-cius-pt-ou-ubl-21-peppolbis3---encomendas" class="hash-link" aria-label="Link direto para a) Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)" title="Link direto para a) Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)">​</a></h4>
<p>Neste método, o sistema a integrar tem de gerar corretamente o ficheiro XML antes de enviar o mesmo ao ilink. Todos os ficheiros XML enviados por este método <a href="https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt" target="_blank" rel="noopener noreferrer">são verificados de acordo com o validador oficial da eSPap, versão 2.1.2</a>, e o API irá retornar um erro caso se verifiquem inconsistências sintáticas. A eSPap disponibiliza um <a href="https://www.espap.gov.pt/Documents/servicos/sp_fin/urn_feap.gov.pt_CIUS-PT_schematron.zip" target="_blank" rel="noopener noreferrer">validador Schematron</a> que implementa todas as validações da <a href="https://ec.europa.eu/digital-building-blocks/sites/spaces/DIGITAL/pages/467108950/EN+16931+compliance" target="_blank" rel="noopener noreferrer">Norma Europeia EN16931 CIUS</a> e as validações adicionais do CIUS-PT, e está disponível online <a href="https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt" target="_blank" rel="noopener noreferrer">neste link</a>. <strong>Se os ficheiros validam sintaticamente no <a href="https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt" target="_blank" rel="noopener noreferrer">validador online</a>, então deverão validar no ilink, com a exceção de validações adicionais colocadas pelo destinatário do documento.</strong></p>
<blockquote>
<p><strong>Nota:</strong> Para incluir um ficheiro <strong>PDF</strong> na fatura eletrónica e consultar outros casos de uso, consultar a secção <a href="#72-cria%C3%A7%C3%A3o-de-documentos-por-envio-do-cius-pt">casos de uso</a>.</p>
</blockquote>
<blockquote>
<p><strong>Nota:</strong> Podem consultar vários <a href="https://www.espap.gov.pt/Imagens/Documento.ashx?id=254" target="_blank" rel="noopener noreferrer">exemplos do CIUS-PT</a>, bem como toda a especificação do CIUS-PT  <a href="https://www.espap.gov.pt/spfin/normas/Paginas/normas.aspx" target="_blank" rel="noopener noreferrer">aqui</a>.</p>
</blockquote>
<p>Alguns exemplos de erros  no processo de validação XML:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e217&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[BR-CO-25]-Caso o valor a pagar (BT-115) seja positivo, deve indicar a data de vencimento (BT-9) ou a nota da condição de pagamento (BT-20).&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e217&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[DT-CIUS-PT-166]-Amount due for payment (BT-115) = Invoice total amount with VAT (BT-112) -Paid amount (BT-113) +Rounding amount (BT-114), with an acceptance range of 1.00 € (it does not mean that this tolerance is accepted by the customer).&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>O método a utilizar para envio do XML é o <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">POST /apps/documentsUBL</a></strong>.  Neste contexto, <strong>a chave pública identifica o emissor do documento</strong> e tem de ser a chave associada ao NIF do emissor do documento especificado no XML (<code>AccountingSupplierParty&gt;Party&gt;PartyTaxScheme&gt;CompanyID</code> para faturas/notas de crédito, ou <code>AccountingCustomerParty&gt;Party&gt;PartyTaxScheme&gt;CompanyID</code> para encomendas). Caso isto não se verifique, o API irá retornar o seguinte erro:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;supplier&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e199&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;A entidade criadora do documento deve ser cliente ou fornecedor do novo documento.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Se o XML for válido e respeitar todas as validações da norma, bem como todas as <a href="#55-valida%C3%A7%C3%B5es-adicionais">regras de negócio adicionais do recetor</a>, o API devolve uma resposta de sucesso, juntamente com os dados principais do documento criado:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">201</span><span class="token plain"> Created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s011&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documento criado com sucesso&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;response&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;60796c3c2a6fa2.53909016&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;7411111&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;emission_date&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2021-04-15&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type_document_fact&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5c9cb870a5ef57.36583702&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;380&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;invoice&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Fatura&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;issued&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Emitido&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;state_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5c9cb878745b16.4225687&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sent&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Enviado ao cliente.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Nota:</strong> Um documento é enviado com sucesso ao destinatário via EDI quando o campo <code>state_document.alias</code> tem o valor <code>sent</code> ou <code>accepted</code>. Caso se apenas pretenda que o documento seja enviado via e-mail, o estado do documento deve ser ignorado, e devemos alternativamente consultar os e-mails enviados através da <a href="#59-consulta-de-estado-de-documentos-emitidos">consulta de estado</a> do mesmo.</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="b-envio-dos-dados-estruturados-do-documento">b) Envio dos dados estruturados do documento<a href="#b-envio-dos-dados-estruturados-do-documento" class="hash-link" aria-label="Link direto para b) Envio dos dados estruturados do documento" title="Link direto para b) Envio dos dados estruturados do documento">​</a></h4>
<p>Ao adotar esta opção, o ERP dispensa de efetuar a geração completa do XML, ficando assim o ilink responsável por gerar o XML final. Assim, o ERP apenas necessita de enviar ao ilink todos os dados referentes ao documento. O endpoint a adotar aqui será o <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument" target="_blank" rel="noopener noreferrer">POST /apps/documents</a></strong></p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20210415-123923-45dc58da575be97ec00b5f16d9c8da41.png" width="1490" height="895" class="img_ev3q"></p>
<p>A especificação deste método é extensa, pois cobre todos os campos possíveis de uma fatura/encomenda, que estão devidamente documentados acima. Todos os documentos criados por este endpoint estão sujeitos às mesmas validações que os documentos enviados pelo método <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">POST /apps/documentsUBL</a></strong>, ou seja, o XML resultante dos dados inseridos será validado de acordo com o <a href="https://www.espap.gov.pt/spfin/normas/Paginas/normas.aspx" target="_blank" rel="noopener noreferrer">validador oficial da eSPap</a>, que pode ser consultado online <a href="https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt" target="_blank" rel="noopener noreferrer">neste link</a>, e segundo as <a href="#55-valida%C3%A7%C3%B5es-adicionais">regras de negócio adicionais</a> do recetor do documento, caso existam.</p>
<blockquote>
<p><strong>Nota:</strong> Para incluir um ficheiro <strong>PDF</strong> e outras situações habituais, consultar a secção <a href="#71-cria%C3%A7%C3%A3o-de-documentos-por-envio-de-dados">casos de uso</a>.</p>
</blockquote>
<blockquote>
<p><strong>Nota:</strong> É possível enviar vários anexos num documento através do campo <code>files[]</code> (ver especificação acima). Contudo, a representação visual do documento (i.e PDF original da fatura usado na impressão) deve ser enviado sempre no campo <code>file</code>, sendo o campo <code>files[]</code> reservado para ficheiros adicionais (notas de encomenda, avisos de despacho, guias de transporte, etc.). <strong>Se o emissor do documento tem uma assinatura digital ativa no ilink, todos os anexos serão assinados por defeito.</strong></p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-envio-do-documento">5.4 Envio do documento<a href="#54-envio-do-documento" class="hash-link" aria-label="Link direto para 5.4 Envio do documento" title="Link direto para 5.4 Envio do documento">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="541-envio-via-edi">5.4.1 Envio via EDI<a href="#541-envio-via-edi" class="hash-link" aria-label="Link direto para 5.4.1 Envio via EDI" title="Link direto para 5.4.1 Envio via EDI">​</a></h4>
<p>Um documento, após criação com sucesso por qualquer um dos métodos acima  (<a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">envio de XML</a> ou <a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument" target="_blank" rel="noopener noreferrer">envio de dados</a>), será enviado automaticamente ao destinatário por EDI. Contudo, em casos pontuais, este poderá não ser entregue imediatamente ao destinatário via EDI devido a configurações em falta e/ou outras anomalias na plataforma ilink ou no sistema do recetor. Caso isto se verifique, será devolvido um campo <code>to_send_status</code> na resposta do documento a detalhar a situação:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">201</span><span class="token plain"> OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s011&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documento criado com sucesso&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;response&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;60796c3c2a6fa2.53909016&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;state_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5c9cb870f34b16.42025494&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tosend&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Por enviar ao cliente.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;to_send_status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sent_connection&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;title&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Aguardar a aceitação de ligação com o destinatário do documento.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Nota:</strong> Pode-se verificar que o documento <strong>NÃO</strong> foi entregue via EDI pois o campo <code>state_document.alias</code> assume o valor <code>tosend</code> e o motivo de erro encontra-se descrito no campo <code>to_send_status</code>. Nesta situação, é necessário primeiro concluir a ligação EDI com o destinatário e depois proceder ao reenvio.</p>
</blockquote>
<p>Os motivos possíveis (<code>code</code>) para um documento não ser entregue são:</p>
<ul>
<li><code>sent_connection</code>, <code>no_connection</code>: Ligação com o destinatário em falta</li>
<li><code>registered_entity</code>: O destinatário não está registado no ilink</li>
<li><code>received_pay_transactions</code>: O destinatário suporta os custos dos documentos recebidos mas não dispõe de transações suficientes para o envio do documento</li>
</ul>
<p>Após regularizar a situação de erro, será possível enviar o documento novamente (ver secção de [reenvio de documentos]#56-criareditar-documento).</p>
<blockquote>
<p><strong>Nota</strong>: O estado do documento (<code>state_document</code>) é apenas aplicável a envios EDI. Caso o documento seja enviado para um cliente arbitrário via e-mail (PDF), o estado de envio não reflete o envio do e-mail (ver secção seguinte).</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="542-envio-via-e-mail">5.4.2 Envio via e-mail<a href="#542-envio-via-e-mail" class="hash-link" aria-label="Link direto para 5.4.2 Envio via e-mail" title="Link direto para 5.4.2 Envio via e-mail">​</a></h4>
<p>Um documento, após criação com sucesso (HTTP status 201) por qualquer um dos métodos acima (<a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">envio de XML</a> ou <a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument" target="_blank" rel="noopener noreferrer">envio de dados</a>), será remetido via e-mail ao destinatário caso seja especificado o campo <code>send_by_email</code> com o valor <code>1</code>. O(s) endereço(s) do(s) recetor(es) do documento pode(m) ser especificado(s) de 3 modos:</p>
<ul>
<li>no campo <code>additional_emails[]</code> (em ambos os métodos de envio)</li>
<li>no campo <code>customer[email]</code> (apenas no método de envio de dados)</li>
<li>no elemento <code>cac:AccountingCustomerParty/cac:Party/cac:Contact/cbc:ElectronicMail</code> do XML (apenas no método de envio de XML).</li>
</ul>
<p>Para consultar o envio dos e-mails e leitura dos mesmos para o cliente, ver secção b) de <a href="#59-consulta-de-estado-de-documentos-emitidos">consulta de estado de documentos emitidos</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="543-criação-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas">5.4.3 Criação de documentos e consumo de assinaturas digitais qualificadas<a href="#543-criação-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas" class="hash-link" aria-label="Link direto para 5.4.3 Criação de documentos e consumo de assinaturas digitais qualificadas" title="Link direto para 5.4.3 Criação de documentos e consumo de assinaturas digitais qualificadas">​</a></h4>
<p><strong>Esta secção é apenas relevante para clientes que utilizam o ilink para assinar digitalmente os documentos. <a href="#52-assinatura-digital">Ver detalhes</a>.</strong></p>
<p>Caso esteja configurada uma assinatura digital qualificada no ilink, todos os documentos serão assinados no momento da sua criação, incluindo todos os ficheiros resultantes da fatura eletrónica (xml e pdf). Dado que a assinatura dos documentos não é obrigatória por lei em todos os cenários de utilização, é possível controlar individualmente a assinatura dos ficheiros xml e pdf no momento da criação do documento com recurso aos os campos <code>disable_xml_sign</code> e <code>disable_pdf_sign</code>, disponíveis em ambos os métodos de criação de documento (<a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">XML</a> ou <a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument" target="_blank" rel="noopener noreferrer">dados</a>). Isto permite reduzir o consumo de assinaturas, bem como otimizar o processo de criação de documentos.</p>
<p>Ou seja:</p>
<ul>
<li>No envio de fatura digital via <strong>PDF assinado para um consumidor final ou cliente privado</strong>, não será obrigatório assinar o ficheiro XML resultante, pelo que recomendamos a utilização do campo <code>disable_xml_sign: 1</code>.</li>
<li>No envio de fatura eletrónica para a <strong>Administração Pública via EDI</strong> (exemplo eSPap), não é obrigatório assinar o documento, no entanto recomenda-se a assinatura de ambos os ficheiros por motivos de segurança adicional e integridade.</li>
<li><strong>Os campos acima apenas têm efeito quando o emissor do documento usa uma assinatura digital qualificada no ilink.</strong></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="55-validações-adicionais">5.5 Validações adicionais<a href="#55-validações-adicionais" class="hash-link" aria-label="Link direto para 5.5 Validações adicionais" title="Link direto para 5.5 Validações adicionais">​</a></h3>
<p>O recetor da fatura pode configurar no ilink requisitos adicionais para determinados campos (regras de negócio), mesmo quando estes não são obrigatórios na especificação CIUS-PT. Por exemplo, um cliente pode definir que apenas aceita faturas com o ficheiro PDF em anexo ou com o número de compromisso especificado. É fundamental que estes requisitos sejam acordados previamente com o cliente/destinatário antes da entrada em produção, de forma a evitar erros de integração.</p>
<p><strong>Caso o recetor do documento obrigue a presença de algum campo não especificado no XML, o API irá retornar um erro como abaixo e o documento não será gerado:</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;commitment_number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e048&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;O número de compromisso é obrigatório.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="56-criareditar-documento">5.6 Criar/editar documento<a href="#56-criareditar-documento" class="hash-link" aria-label="Link direto para 5.6 Criar/editar documento" title="Link direto para 5.6 Criar/editar documento">​</a></h3>
<p>Um documento pode ser editado e reenviado ao destinatário</p>
<ul>
<li>se <strong>ainda não foi enviado</strong> ao cliente final</li>
<li>ou se <strong>já foi enviado ao cliente e o cliente pediu uma regularização</strong> do mesmo</li>
</ul>
<p>Em termos práticos, a possibilidade de reenvio pode ser consultada através do campo de resposta seguinte do documento:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;state_edi_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> &lt;estado&gt; </span><span class="token comment" style="color:#999988;font-style:italic">// estados possíveis de reenvio: &#x27;regularization&#x27; ou &#x27;reception&#x27; ou &#x27;error&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Para consultar o estado de um documento, ver secção de <a href="#59-consulta-de-estado-de-documentos-emitidos">consulta de estado de documentos emitidos</a>.</p>
<p>Para editar um documento existente, basta repetir o pedido <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">POST /apps/documentsUBL</a></strong> ou <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument" target="_blank" rel="noopener noreferrer">POST /apps/documents</a></strong> com os dados corrigidos, mantendo o <strong>número, tipo e data de emissão</strong> do documento anterior:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">HTTP</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s012&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documento editado com sucesso&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;response&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;60796c3c2a6fa2.53909016&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;7411111&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;emission_date&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2021-04-16&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;type_document_fact&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5c9cb870a5ef57.36583702&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;380&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;invoice&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Fatura&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;type_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;issued&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Emitido&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;state_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5c9cb870f34b16.42025494&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tosend&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Por enviar ao cliente.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>Caso o documento não seja elegível para edição (i.e já foi enviado ou foi aceite pelo cliente final), será apresentado um erro ao tentar reenviar:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e200&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documento já existe.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="57-acesso-a-documentos-emitidos">5.7 Acesso a documentos emitidos<a href="#57-acesso-a-documentos-emitidos" class="hash-link" aria-label="Link direto para 5.7 Acesso a documentos emitidos" title="Link direto para 5.7 Acesso a documentos emitidos">​</a></h3>
<p>Quando um documento é registado com sucesso, será sempre devolvido um <code>id</code> nas respostas, que identifica o mesmo perante o ilink. É útil guardar este identificador para consultas futuras ao documento.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">201</span><span class="token plain"> Created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s011&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documento criado com sucesso&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;response&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;60796c3c2a6fa2.53909016&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>O API permite também aceder a todos os dados (inclusive ao XML e PDF gerados) de todos os documentos previamente emitidos. Para tal, deverão usar o método <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument" target="_blank" rel="noopener noreferrer">GET /apps/documents/{id}</a></strong>. O <code>id</code> recebido na criação do documento deve ser usado como parâmetro aqui para aceder ao documento em questão.</p>
<p>Todos os dados retornados por este método estão disponíveis na especificação acima.</p>
<blockquote>
<p><strong>Nota</strong>: Caso a entidade emissora do documento tenha configurado a assinatura automática de documentos no ilink, os URLs de acesso ao XML e ao PDF já retornam os ficheiros assinados.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="58-consulta-de-documentos-emitidos-no-portal-opcional">5.8 Consulta de documentos emitidos no portal (opcional)<a href="#58-consulta-de-documentos-emitidos-no-portal-opcional" class="hash-link" aria-label="Link direto para 5.8 Consulta de documentos emitidos no portal (opcional)" title="Link direto para 5.8 Consulta de documentos emitidos no portal (opcional)">​</a></h3>
<p>Os documentos podem também ser consultados no <a href="https://ilink.acin.pt" target="_blank" rel="noopener noreferrer">portal de testes do ilink</a> usando as credenciais das entidades que vos foram enviadas. Aqui podem validar visualmente se a informação apresentada está coerente com os dados enviados via API:</p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20230420-133607-c5d03a751653d102acc0ed60c783eee4.png" width="1596" height="839" class="img_ev3q"></p>
<p>Para aceder aos anexos de um documento, deverão aceder ao documento da tabela acima, e aceder ao ícone da lupa:</p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20230420-133914-c96ee4049998eb70825f7dcb46b5c6fb.png" width="1605" height="838" class="img_ev3q"></p>
<blockquote>
<p><strong>Nota:</strong> Os documentos deverão estar presentes tanto na entidade emissora (secção de documentos emitidos), bem como na entidade recetora (secção de documentos recebidos).</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="59-consulta-de-estado-de-documentos-emitidos">5.9 Consulta de estado de documentos emitidos<a href="#59-consulta-de-estado-de-documentos-emitidos" class="hash-link" aria-label="Link direto para 5.9 Consulta de estado de documentos emitidos" title="Link direto para 5.9 Consulta de estado de documentos emitidos">​</a></h3>
<p>É também possível aceder ao estado atual dos documentos previamente emitidos. Esta operação permite ao emissor do documento consultar se o documento foi aceite pelo cliente, ou se está pendente de reenvio/regularização, bem como os motivos que levaram a tal.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="591-consulta-de-estado-de-documento-enviado-via-edi">5.9.1 Consulta de estado de documento enviado via EDI<a href="#591-consulta-de-estado-de-documento-enviado-via-edi" class="hash-link" aria-label="Link direto para 5.9.1 Consulta de estado de documento enviado via EDI" title="Link direto para 5.9.1 Consulta de estado de documento enviado via EDI">​</a></h4>
<p>O ilink contempla 4 estados simplificados  de documento na propriedade <code>state_document</code>:</p>
<ul>
<li><strong>Por enviar</strong> (<code>tosend</code>) - o documento não foi enviado ao cliente. Provavelmente significa que falta alguma configuração no ilink, emissor/recetor não autorizam ligação entre eles, ou que alguma das entidades presentes no documento não tem transações suficientes para proceder ao envio.</li>
<li><strong>Enviado</strong> (<code>sent</code>) - o documento foi enviado ao cliente e está pendente de aceitação.</li>
<li><strong>Aceite</strong> (<code>accepted</code>) - o documento foi enviado e o cliente aceitou o mesmo. <strong>Estado final</strong>.</li>
<li><strong>Recusado</strong> (<code>rejected</code>) - o documento foi enviado e o cliente rejeitou o mesmo devido a uma incoerência. O motivo de recusa é disponibilizado na resposta no campo <code>reasons</code>. <a href="public:integrations-api#criar_editar_documento" target="_blank" rel="noopener noreferrer">O documento poderá ser enviado novamente</a> caso seja solicitada uma regularização do mesmo.</li>
</ul>
<blockquote>
<p><strong>Nota:</strong> O ilink devolve também o <strong>estado de processamento EDI</strong> atual do documento (<code>state_edi_document</code>), que é independente dos estados acima. Para mais informação, consultar o <a href="https://www.espap.gov.pt/Imagens/Documento.ashx?id=269" target="_blank" rel="noopener noreferrer">Guia de Transmissão de Documentos FE-AP, página 7</a>. Contudo, a leitura do estado EDI nem sempre é relevante para os softwares de faturação.</p>
</blockquote>
<p>Existem 3 abordagens para aceder ao estado de um documento previamente emitido: <strong>Consulta individual</strong>, <strong>Webhook de mudança de estado</strong> e <strong>Reporte de estados</strong>.</p>
<ul>
<li>
<p>Na <strong>Consulta individual de estado</strong>, basta efetuar a chamada <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument" target="_blank" rel="noopener noreferrer">GET /apps/documents/{id}</a></strong>. O <code>id</code> recebido na criação do documento deve ser usado como parâmetro para aceder ao documento em questão. O estado é devolvido no campo <code>state_document</code> (ver especificação acima). Este método apenas permite consultar o estado de um documento de cada vez, e como tal não é recomendado para clientes que emitem um volume elevado de documentos.</p>
</li>
<li>
<p>No <strong>Webhook de mudança de estado</strong>, o ilink tem a iniciativa de informar ao emissor do documento cada vez que o mesmo muda de estado. Esta é a opção recomendada em termos de desempenho e rapidez, mas pode não ser viável caso o sistema a integrar pertença a numa rede não exposta publicamente ao ilink. Para mais informação, consultar a secção <a href="/docs/webhooks-ilink">Webhooks</a>.</p>
</li>
<li>
<p>No <strong>Reporte de estados</strong>, a aplicação a integrar tem a iniciativa de consultar os diversos eventos que levaram às alterações de estado dos documentos emitidos. Para tal, basta efetuar a chamada <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Hist%C3%B3rico%20de%20estados/getStatesReport" target="_blank" rel="noopener noreferrer">GET /apps/states-report/documents</a></strong>. Cada evento identifica o documento e o estado alterados. É possível filtrar os eventos retornados por <code>id</code> de documento, número de documento, intervalos de datas, entre outros (ver especificação acima). Este método permite a aplicação consultar o estado de vários documentos em simultâneo.</p>
<p>De modo a facilitar a utilização do reporte de estados, é adicionalmente disponibilizado o endpoint de leitura de eventos <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Hist%C3%B3rico%20de%20estados/postStatesReportRead" target="_blank" rel="noopener noreferrer">POST /apps/states-report/documents/read</a></strong>, que permite marcar um ou mais <code>id</code>s de evento obtidos acima como lido(s). Os eventos marcados como lidos não são retornados novamente no endpoint de reporte de estados, facilitando a consulta futura. Esta opção é uma alternativa escalável para os sistemas que não podem implementar Webhooks.</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="592-consulta-de-estado-de-documento-enviado-via-e-mail">5.9.2 Consulta de estado de documento enviado via e-mail<a href="#592-consulta-de-estado-de-documento-enviado-via-e-mail" class="hash-link" aria-label="Link direto para 5.9.2 Consulta de estado de documento enviado via e-mail" title="Link direto para 5.9.2 Consulta de estado de documento enviado via e-mail">​</a></h4>
<p>No cenário de envio de documentos por e-mail, é possível consultar o registo de envio e de leitura dos e-mails enviados ao cliente. <strong>Note-se que o estado do documento retornado (<code>state_document</code>) não é aplicável neste cenário</strong>, pois o documento por norma não é enviado via EDI, e como tal, o seu estado de envio será habitualmente <code>to_send</code>. Este estado deve ser ignorado a favor das abordagens abaixo.</p>
<p>Existem duas abordagens para aceder ao registo de e-mails enviados de um documento: <strong>Consulta individual</strong>  e  <strong>Consulta de histórico de documento</strong>.</p>
<ul>
<li>Na <strong>Consulta individual</strong>, basta efetuar a chamada <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument" target="_blank" rel="noopener noreferrer">GET /apps/documents/{id}</a></strong>. O <code>id</code> recebido na criação do documento deve ser usado como parâmetro para aceder ao documento em questão. Na resposta, devem aceder à propriedade <code>emails</code>, que retorna uma lista das mensagens enviadas e o seu estado de receção e leitura.  Este método apenas permite consultar o estado de um documento de cada vez e tem as mesmas limitações que a consulta individual de documentos da secção anterior:</li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;response&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;60796c3c2a6fa2.53909016&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;emails&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;634672bab0f3b8.40302642&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;b_open&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// true caso o email tenha sido lido pelo recetor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;b_sent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// true caso o email tenha sido enviado com sucesso</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;created_at&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2022-10-12 08:54:34&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// data e hora de envio do email</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;opened_at&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2022-10-12 09:14:16&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// data e hora de leitura do email</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;address&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;emails&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;joao.freitas@email.com&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// endereço de envio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Nota:</strong> Certos clientes de e-mail (Outlook, etc.) podem bloquear o registo de leitura dos e-mails, ficando o <code>b_open</code> a false mesmo que o e-mail tenha sido aberto em algumas situações.</p>
</blockquote>
<ul>
<li>Na <strong>Consulta de histórico de documento</strong> é possível consultar todas as alterações processuais de um determinado documento. Este histórico irá listar todas as alterações de estado que ocorreram no documento por ordem cronológica, bem como os registos dos envios de e-mail para o destinatário, o que permite um rastreio completo de auditoria. Pode ser acedido através de <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocumentHistory" target="_blank" rel="noopener noreferrer">GET /apps/documents/{id}/history</a></strong>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-receção-de-documentos">6. Receção de documentos<a href="#6-receção-de-documentos" class="hash-link" aria-label="Link direto para 6. Receção de documentos" title="Link direto para 6. Receção de documentos">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-âmbito">6.1 Âmbito<a href="#61-âmbito" class="hash-link" aria-label="Link direto para 6.1 Âmbito" title="Link direto para 6.1 Âmbito">​</a></h3>
<p>Esta funcionalidade permite dar entrada automática aos documentos de faturação no sistema ERP do recetor, facilitando a integração direta nos sistemas contabilísticos. Adicionalmente, possibilita a comunicação dos estados de aceitação dos documentos ao respetivo emissor (pago, aceite, recusado, entre outros).</p>
<p>Neste fluxo de integração, recomendamos que sejam implementados os seguintes aspetos:</p>
<ul>
<li><strong>Leitura e processamento de dados</strong>: Extrair informações do XML ou dados estruturados do documento para registar corretamente as informações necessárias no ERP</li>
<li><strong>Comunicação do estado de integração</strong>: Informar o ilink sobre o estado do processo de integração do documento</li>
<li><strong>Gestão do estado de aceitação</strong>: Comunicar o estado de aceitação do documento, incluindo o envio de mensagens detalhadas em caso de erro ou rejeição</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-métodos-de-receção">6.2 Métodos de receção<a href="#62-métodos-de-receção" class="hash-link" aria-label="Link direto para 6.2 Métodos de receção" title="Link direto para 6.2 Métodos de receção">​</a></h3>
<p>Permite consultar e integrar documentos no sistema em questão.  A receção de documentos pode ser efetuada por 2 métodos: <strong>Consulta manual de documentos</strong> ou <strong>Webhook de receção</strong>.</p>
<ul>
<li><strong>a) Consulta manual de documentos</strong></li>
</ul>
<p>Neste modo, é necessário aceder ao endpoint <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocuments" target="_blank" rel="noopener noreferrer">GET /apps/documents</a></strong>. É possível especificar diversos parâmetros de pesquisa de modo a filtrar os resultados obtidos. A resposta deste método inclui os dados principais dos documentos, e adicionalmente a paginação através das propriedades <code>rows</code> (número de elementos por página) e <code>page</code> (número da página a consultar). Consulte a especificação acima para mais detalhes.</p>
<p>Para consultar os detalhes de um documento, bem como os links para os ficheiros XML e PDF do mesmo, deverá ser utilizado o método  <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument" target="_blank" rel="noopener noreferrer">GET /apps/documents/{id}</a></strong>, usando um dos <strong>IDs</strong> retornados na lista de documentos anterior.</p>
<p>O endpoint de consulta pode ser acedido periodicamente (num processo em segundo plano), ou mediante a consulta de um utilizador no sistema (em tempo real).</p>
<blockquote>
<p><strong>Nota: Aqui, a chave pública é usada no contexto da entidade recetora dos documentos</strong>, ou seja, deverão utilizar a chave pública que identifica a entidade que acede os documentos recebidos.</p>
</blockquote>
<blockquote>
<p><strong>Importante: Recomendamos uma utilização responsável deste endpoint. Chamadas excessivas a este recurso são de evitar, e poderão levar a &#x27;time-outs&#x27; e restrições de acesso, consoante o nosso acordo de interoperabilidade.</strong></p>
</blockquote>
<ul>
<li><strong>b) Webhook de receção (recomendado)</strong></li>
</ul>
<p>Neste modo, o ilink toma a iniciativa de comunicar ao ERP quando chega um novo documento ao cliente, dispensando consultas frequentes ao endpoint <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocuments" target="_blank" rel="noopener noreferrer">GET /apps/documents</a></strong>. Para mais informação, consultar a secção <a href="/docs/webhooks-ilink">Webhooks</a>.</p>
<blockquote>
<p><strong>Nota:</strong> Segundo especificação, serão retornados os dados dos documentos recebidos num formato estruturado, bem como os URLs públicos para o acesso aos ficheiros XML e PDF do documento.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="63-importação-e-aceitação">6.3 Importação e aceitação<a href="#63-importação-e-aceitação" class="hash-link" aria-label="Link direto para 6.3 Importação e aceitação" title="Link direto para 6.3 Importação e aceitação">​</a></h3>
<p>Após consultar o documento pretendido, é recomendado que o ERP comunique o estado de processamento do mesmo ao ilink, ou seja, se este integrou corretamete no sistema ou se é necessário retificar/regularizar o documento. Para tal, são necessários 2 passos:</p>
<ul>
<li>
<p><strong>1. Comunicar o estado do documento</strong></p>
<ul>
<li>É feito com o pedido <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentsAccepted" target="_blank" rel="noopener noreferrer">POST /apps/documents/{id}/accepted</a></strong>. Aqui é indicado se o documento foi aceite ou não, e caso contrário, o motivo que levou à sua rejeição</li>
<li>É obrigatório indicar o motivo de rejeição de um documento caso não seja aceite</li>
<li>Um documento rejeitado poderá ser reenviado pelo emissor com os dados corrigidos</li>
</ul>
</li>
<li>
<p><strong>2. Comunicar a importação do documento (apenas na aceitação com sucesso)</strong></p>
<ul>
<li>Caso o passo anterior seja concluído com sucesso (i.e. o documento está em condições de ser integrado no ERP), deverão invocar o método <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocuments" target="_blank" rel="noopener noreferrer">POST /apps/documents/{id}</a></strong></li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Nota:</strong> Não é necessário importar um documento rejeitado.</p>
</blockquote>
<p>A correta comunicação de documentos aceites e/ou importados cria um histórico de auditoria e facilita o consumo do API, dado que, caso estejam a adotar a receção de documentos pelo método de consulta manual, quaisquer documentos que tenham sido importados ou rejeitados não são devolvidos novamente em consultas futuras. <strong>Ou seja, as chamadas a <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocuments" target="_blank" rel="noopener noreferrer">GET /apps/documents</a></strong> não devolvem documentos previamente rejeitados ou importados</strong>.</p>
<p>A imagem abaixo demonstra como as operações realizadas pelo ERP são registadas no portal do ilink:</p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20230426-125316-0840655190d4733e042ef2069dda297b.png" width="1468" height="500" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="64-estados-de-processo-opcional">6.4 Estados de Processo (opcional)<a href="#64-estados-de-processo-opcional" class="hash-link" aria-label="Link direto para 6.4 Estados de Processo (opcional)" title="Link direto para 6.4 Estados de Processo (opcional)">​</a></h3>
<blockquote>
<p><strong>Nota</strong>: Esta funcionalidade é opcional e tem carácter meramente informativo, não afectando o processo de recepção de documentos.</p>
</blockquote>
<p>O ilink permite criar estados de documento personalizáveis para os documentos recebidos. Quando esta funcionalidade está ativa na entidade, é possível consultar e modificar o estado de um documento através da API.</p>
<p>Esta capacidade permite que software externo (como sistemas de gestão documental) altere o estado processual do documento no ilink de forma integrada. Todas as alterações de estado ficam registadas no histórico do documento.</p>
<blockquote>
<p><strong>Importante</strong>: O estado do processo é independente do estado padrão de um documento (recebido, aceite, etc.). Serve exclusivamente para fins de organização interna e registo de operações.</p>
</blockquote>
<p>Para consultar todos os estados de processo disponíveis na entidade em questão, deverá ser usado o método <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Estados%20de%20processamento%20de%20documentos/getProcessStates" target="_blank" rel="noopener noreferrer">GET /apps/processstates</a>,</strong> que retorna a lista completa de estados, juntamente com o seu <code>identification_code</code>. Para alterar o estado de processo de um documento, deverá ser usado o método <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Estados%20de%20processamento%20de%20documentos/postDocumentsProcessState" target="_blank" rel="noopener noreferrer">PUT /apps/documents/{id}/processstates</a></strong>, usando o campo <code>identification_code</code> para atribuir o novo estado.</p>
<p>Os estados de processo são configurados diretamente pela equipa de apoio do ilink.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-casos-de-uso">7. Casos de uso<a href="#7-casos-de-uso" class="hash-link" aria-label="Link direto para 7. Casos de uso" title="Link direto para 7. Casos de uso">​</a></h2>
<p>A seguinte secção exemplifica algumas situações comuns na criação de documentos CIUS-PT.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="71-criação-de-documentos-por-envio-de-dados">7.1 Criação de documentos por envio de dados<a href="#71-criação-de-documentos-por-envio-de-dados" class="hash-link" aria-label="Link direto para 7.1 Criação de documentos por envio de dados" title="Link direto para 7.1 Criação de documentos por envio de dados">​</a></h3>
<ul>
<li>
<p>Indicar as condições de pagamento</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">payment_terms[note]: 30 dias</span><br></span></code></pre></div></div>
</li>
<li>
<p>Indicar um local de consumo (CPE) numa das linhas do documento</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][additional_property][0][name]: CPE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][additional_property][0][value]: PT1234567890</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio do número de compromisso no cabeçalho do documento</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">commitment_number: 2021/451</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio do número de compromisso nas linhas do documento</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][commitment][number]: 2021/123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][commitment][line]: 1</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio do número de encomenda</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">references[0][document_type]: order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">references[0][number]: 1234</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio do PDF anexado (UTF-8)</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">file: (binary)</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio de outros anexos secundários</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">files[0]: (binary)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">files[1]: (binary)</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Nota:</strong> O PDF de representação do documento deve ser sempre enviado no campo <strong>file</strong>.</p>
</blockquote>
</li>
<li>
<p>Desconto no cabeçalho do documento</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][type]: false // usar true para encargo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][reason]: desconto comercial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][percent]: 23.00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][tax_code]: NOR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][amount]: 8.13 // refere-se ao valor sem imposto (ou seja, este desconto é de 10.00 EUR após a aplicação de IVA)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discount_amount: 8.13 // refere-se ao total de descontos de cabeçalho aplicados ao documento (NÃO inclui descontos nas linhas)</span><br></span></code></pre></div></div>
</li>
<li>
<p>Desconto ou encargo na linha do documento</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][discounts_charges][0][type]: false // usar true para encargo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][discounts_charges][0][reason]: desconto comercial // descrição textual do desconto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][discounts_charges][0][amount]: 5.00 // refere-se ao valor sem IVA a descontar na linha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][quantity]: 2.000 // quantidade de artigos na linha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][price]: 10.00000000 // preço unitário do artigo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][amount]: 15.00000000 // o total da linha do documento é afectado pelo desconto ( (10 * 2) - 5 = 15)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][taxes][0][tax_percent]: 23.000 // taxa de IVA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][taxes][0][tax_amount]: 3.45 // valor do IVA da linha (15 * 0.23)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discount_amount: 0.00 // refere-se ao total de descontos de cabeçalho aplicados ao documento (NÃO inclui descontos nas linhas)</span><br></span></code></pre></div></div>
</li>
<li>
<p>Desconto no preço do artigo</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][price_discount][base_amount]: 10.00 // preço unitário original do artigo antes de aplicar o desconto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][price_discount][amount]: 5.00 // refere-se ao valor sem IVA a descontar no preço do artigo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][quantity]: 2.000 // quantidade de artigos na linha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][price]: 5.00000000 // preço do artigo após aplicação do desconto (10 - 5 = 5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][amount]: 10.00000000 // o total da linha do documento é afectado pelo desconto ( (10 - 5) * 2 = 10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][taxes][0][tax_percent]: 23.000 // taxa de IVA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][taxes][0][tax_amount]: 2.30 // valor do IVA da linha (10 * 0.23)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discount_amount: 0.00 // refere-se ao total de descontos de cabeçalho aplicados ao documento (NÃO inclui descontos nas linhas)</span><br></span></code></pre></div></div>
</li>
<li>
<p>Retenção na fonte</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">withholding_tax[0][type]: IRF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">withholding_tax[0][tax_amount]: 10.00 // valor da retenção</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">withholding_tax[0][description]: Retenção IRS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">withholding_tax_amount: 10.00 // soma de todas as retenções do documento</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Nota:</strong> os totais do documento não são afetados pela retenção</p>
</blockquote>
</li>
<li>
<p>Isenção de IVA na linha</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][quantity]: 2.000 // quantidade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][price]: 5.00000000 // preço unitário</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][amount]: 10.00000000 // total da linha sem IVA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][taxes][0][tax_percent]: 0.00 // taxa de IVA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][taxes][0][tax_amount]: 0.00 // valor do IVA da linha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][taxes][0][tax_exemption_reason_code]: M08 // código de motivo da AT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines[0][taxes][0][tax_exemption_reason]: IVA - Autoliquidação // descritivo do motivo da AT</span><br></span></code></pre></div></div>
</li>
<li>
<p>Isenção de IVA no desconto ou encargo de cabeçalho</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][type]: false // usar true para encargo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][reason]: desconto comercial // descritivo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][percent]: 0.00 // percentagem (isento)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][tax_code]: ISE // isento</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][amount]: 10.00 // valor do desconto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][tax_exemption_reason]: M08 // código de motivo da AT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">discounts_charges[0][tax_exemption_reason_code]: IVA - Autoliquidação // descritivo do motivo da AT</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio da fatua por e-mail a um ou mais endereços</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">send_by_email: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customer[email]: endereco1@email.com // enviado sempre para o email especificado no cliente</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">additional_emails[0]: endereco2@email.com // também enviado para a lista adicional de endereços</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">additional_emails[1]: endereco3@email.com</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio de código QR</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">qr_code: A:500000000*B:123456789*C:PT*D:GT*E:N*F:20190720*G:GT G234CB/50987*H:GTVX4Y8B-50987*I1:0*N:0.00*O:0.00*Q:5uIg*R:9999</span><br></span></code></pre></div></div>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="72-criação-de-documentos-por-envio-do-cius-pt">7.2 Criação de documentos por envio do CIUS-PT<a href="#72-criação-de-documentos-por-envio-do-cius-pt" class="hash-link" aria-label="Link direto para 7.2 Criação de documentos por envio do CIUS-PT" title="Link direto para 7.2 Criação de documentos por envio do CIUS-PT">​</a></h3>
<ul>
<li>
<p>Envio do número de compromisso no cabeçalho do documento</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">AccountingCost</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2021/156</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">AccountingCost</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio do Capital Social do fornecedor:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AccountingSupplierParty</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PartyLegalEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">CompanyLegalForm</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2.000.000 EUR</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">CompanyLegalForm</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PartyLegalEntity</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AccountingSupplierParty</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio do GLN do cliente (usar o schemeID 0088):</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AccountingCustomerParty</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EndpointID</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">schemeID</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0088</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">123456789</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EndpointID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AccountingCustomerParty</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio de ATCUD e QRCODE:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalDocumentReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">schemeID</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">ANG</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">AFHOFX-22</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Valor ATCUD --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">DocumentDescription</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">QR_CODE</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">DocumentDescription</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Attachment</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Texto do QRCODE, em base64 (da sequência de carateres, NÃO da imagem) --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EmbeddedDocumentBinaryObject</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mimeCode</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">text/plain</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">QR_CODE.txt</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">UVJDT0RF=</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EmbeddedDocumentBinaryObject</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Attachment</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalDocumentReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Indicar o método de pagamento:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PaymentMeans</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PaymentMeansCode</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">NU</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PaymentMeansCode</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PaymentMeans</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>Valores permitidos:</p>
<table><thead><tr><th>Código</th><th>Descrição</th></tr></thead><tbody><tr><td><strong>CC</strong></td><td>Cartão crédito</td></tr><tr><td><strong>CD</strong></td><td>Cartão débito</td></tr><tr><td><strong>CH</strong></td><td>Cheque bancário</td></tr><tr><td><strong>CI</strong></td><td>Crédito documentário internacional</td></tr><tr><td><strong>CO</strong></td><td>Cheque ou cartão oferta</td></tr><tr><td><strong>CS</strong></td><td>Compensação de saldos em conta corrente</td></tr><tr><td><strong>DE</strong></td><td>Dinheiro eletrónico (ex.: cartões de fidelidade ou pontos)</td></tr><tr><td><strong>LC</strong></td><td>Letra comercial</td></tr><tr><td><strong>MB</strong></td><td>Referências de pagamento para Multibanco</td></tr><tr><td><strong>NU</strong></td><td>Numerário</td></tr><tr><td><strong>OU</strong></td><td>Outros meios não assinalados</td></tr><tr><td><strong>PR</strong></td><td>Permuta de bens</td></tr><tr><td><strong>TB</strong></td><td>Transferência bancária ou débito direto autorizado</td></tr><tr><td><strong>TR</strong></td><td>Títulos de compensação extrassalarial (ex.: refeição, educação, etc.)</td></tr></tbody></table>
</li>
<li>
<p>Indicar informações de pagamento de cartão de débito ou crédito:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PaymentMeans</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PaymentMeansCode</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">CC</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PaymentMeansCode</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">CardAccount</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PrimaryAccountNumberID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">4211456651233545687</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PrimaryAccountNumberID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Número da conta --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">NetworkID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">04256</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">NetworkID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Identificador da rede bancária --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">HolderName</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">João Ferreira</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">HolderName</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Nome do titular --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">CardAccount</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PaymentMeans</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Indicar método de pagamento por transferência bancária:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PaymentMeans</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PaymentMeansCode</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">TB</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PaymentMeansCode</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PayeeFinancialAccount</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">PT50000700230012345667899</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- IBAN--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">João</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Nome do titular --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">FinancialInstitutionBranch</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">NBxxxx</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--SWIFT --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">FinancialInstitutionBranch</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PayeeFinancialAccount</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PaymentMeans</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Indicar método de pagamento por referência multibanco:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PaymentMeans</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PaymentMeansCode</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">#DESCRIPTION@ATMPAYMENT#156.22#</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">#ENTITY@ATMPAYMENT#15652</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PaymentMeansCode</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Entidade e Valor --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PaymentID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">#REFERENCE@ATMPAYMENT#156555145#</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">PaymentID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Referência --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">PaymentMeans</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Indicar uma segunda referência multibanco:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">#ENTITY@ATMPAYMENT-001#12345#</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 2ª entidade --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">#REFERENCE@ATMPAYMENT-001#012345678#</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 2ª referência --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">#AMOUNT@ATMPAYMENT-001#3264.10#</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--Valor da 2ª referência --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">#DESCRIPTION@ATMPAYMENT-001#Valor total do documento, mais valores em atraso#</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Descrição da 2ª referência --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Indicar as condições de pagamento:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">PaymentTerms</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">30 dias</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">PaymentTerms</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Indicar uma nota textual no cabeçalho do documento:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Nota cabeçalho</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Indicar uma nota textual numa das linhas do documento:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">InvoiceLine</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Nota linha</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">InvoiceLine</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Indicar uma propriedade adicional no documento:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">#ADDITIONALPROPERTY#VOUCHER#123#</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Note</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Indicar um local de consumo (CPE) numa das linhas do documento:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">InvoiceLine</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalItemProperty</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">CPE</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">PT1234567890</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalItemProperty</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">InvoiceLine</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio do número de encomenda / número de requisição</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">OrderReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">20159854587</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">OrderReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio do número de compromisso nas linhas do documento</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">InvoiceLine</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">AccountingCost</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2020/123</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">AccountingCost</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- número do compromisso da linha --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Item</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalItemProperty</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">#LINEID@COMMITMENTLINEREFERENCE#</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">Value</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- número da linha --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalItemProperty</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Item</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">InvoiceLine</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio do PDF anexado (o conteúdo deve estar em <a href="https://www.base64decode.org/" target="_blank" rel="noopener noreferrer">base64</a>)</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalDocumentReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">DocumentDescription</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">INVOICE_REPRESENTATION</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">DocumentDescription</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Attachment</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EmbeddedDocumentBinaryObject</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mimeCode</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">application/pdf</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">document</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">JVBERi0xLjUNCiW1tbW1DQoxIDAgb2JqDQo8PC9UeXBlL0NhdGFsb2cvUGIvTGF==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EmbeddedDocumentBinaryObject</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Attachment</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalDocumentReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p><a href="/assets/files/xml_com_pdf-5cf4add52a31cb42942fd7d18eee4113.xml" target="_blank">Ver exemplo</a></p>
</li>
<li>
<p>Envio de múltiplos PDFs anexados</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalDocumentReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- O anexo principal deve ter a descrição INVOICE_REPRESENTATION&#x27;, ou &#x27;CREDITNOTE_REPRESENTATION&#x27; --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">DocumentDescription</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">INVOICE_REPRESENTATION</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">DocumentDescription</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Attachment</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EmbeddedDocumentBinaryObject</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mimeCode</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">application/pdf</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">document.pdf</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">JVBERi0xLjUNCiW1tbW1DQoxIDAgb2JqDQo8PC9UeXBlL0NhdGFsb2cvUGIvTGF==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EmbeddedDocumentBinaryObject</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Attachment</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalDocumentReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalDocumentReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Os anexos secundários (como a nota de encomenda, guias de pagamento, etc.) devem ter a descrição &#x27;ATTACHMENT&#x27;. É possível incluir vários ATTACHMENTs num documento. --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">DocumentDescription</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">ATTACHMENT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">DocumentDescription</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Attachment</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EmbeddedDocumentBinaryObject</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mimeCode</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">application/pdf</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">document2.pdf</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jUNCiW1tbW1DQoJVBERi0xLjUNCiW1tbW1DQo8PC9UeXBlL0NhUGIvTGF==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EmbeddedDocumentBinaryObject</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Attachment</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalDocumentReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Envio de outros anexos (QR Code, etc.) (o conteúdo deve estar em <a href="https://www.base64decode.org/" target="_blank" rel="noopener noreferrer">base64</a>)</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalDocumentReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">ID</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">DocumentDescription</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">ATTACHMENT</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">DocumentDescription</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- usar QR_CODE para o código QR --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Attachment</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EmbeddedDocumentBinaryObject</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">mimeCode</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">application/txt</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">filename</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">document</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">JVBERi0xLjUNCiW1tbW1DQoxIDAgb2JqDQo8PC9UeXBlL0NhdGFsb2cvUGIvTGF==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cbc:</span><span class="token tag" style="color:#00009f">EmbeddedDocumentBinaryObject</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">Attachment</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">cac:</span><span class="token tag" style="color:#00009f">AdditionalDocumentReference</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">Invoice</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Desconto ou encargo no cabeçalho do documento
<a href="/assets/files/desconto_global-7f962577f9178b4e4050a61354d84ad5.xml" target="_blank">Ver exemplo</a></p>
</li>
<li>
<p>Desconto ou encargo na linha do documento
<a href="/assets/files/desconto_linha-ef6ab1a5bf162d00117e0172d1eb7153.xml" target="_blank">Ver exemplo</a></p>
</li>
<li>
<p>Desconto ou encargo no preço do artigo
<a href="/assets/files/desconto_preco-4a3e7203c3e558d6acd18480febb0d63.xml" target="_blank">Ver exemplo</a></p>
</li>
<li>
<p>Retenção na fonte
<a href="/assets/files/retencao-c90ddcc404e0ff8258e6f60d49740639.xml" target="_blank">Ver exemplo</a></p>
</li>
<li>
<p>Isenção de IVA na linha do documento
<a href="/assets/files/isencao_linha-2f81199b8bcfb1faacdd8ee195a47a10.xml" target="_blank">Ver exemplo</a></p>
</li>
<li>
<p>Isenção de IVA no desconto de cabeçalho do documento
<a href="/assets/files/isencao_desconto-649e8711f6de2bd714ad7a37c1d7d8b8.xml" target="_blank">Ver exemplo</a></p>
</li>
<li>
<p>Múltiplas isenções no documento
<a href="/assets/files/multiplas_isencoes-ea8cb719d2368087c201300a30f434e9.xml" target="_blank">Ver exemplo</a></p>
</li>
<li>
<p>Vários descontos na linha
<a href="/assets/files/varios_descontos-378c454a1a128c0264b25ee26656f839.xml" target="_blank">Ver exemplo</a></p>
</li>
<li>
<p>Ver <a href="https://www.espap.gov.pt/Imagens/Documento.ashx?id=254" target="_blank" rel="noopener noreferrer">lista completa de casos de uso CIUS-PT</a> pela eSPap.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-fluxos-api">8. Fluxos API<a href="#8-fluxos-api" class="hash-link" aria-label="Link direto para 8. Fluxos API" title="Link direto para 8. Fluxos API">​</a></h2>
<p>A imagem abaixo consolida os fluxos de integração do API do ilink acima descritos:</p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20230420-132629-75cc0fe2123c068f396e1ac5ffbb7543.png" width="882" height="683" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-checklist-pré-produção">9. Checklist pré-produção<a href="#9-checklist-pré-produção" class="hash-link" aria-label="Link direto para 9. Checklist pré-produção" title="Link direto para 9. Checklist pré-produção">​</a></h2>
<p>Antes de passar a integração a ambiente produtivo, devem validar os seguintes pontos:</p>
<p><strong>Acordo de interoperabilidade (obrigatório)</strong></p>
<ul>
<li>Deverá ser assinado e devolvido à acin</li>
</ul>
<p><strong>Envio de documentos (no caso da implementação do fluxo de envio)</strong></p>
<ul>
<li>Verificar se é possível criar um documento entre ambas as entidades de teste sem erros de validação, contendo os seguintes campos:<!-- -->
<ul>
<li>PDF anexado</li>
<li>Número de compromisso</li>
<li>Todos os campos da morada do fornecedor (rua, cidade, código postal)</li>
<li>Capital social do fornecedor</li>
<li>Número de encomenda/requisição</li>
<li>GLN do cliente</li>
<li>GLN do local de entrega</li>
</ul>
</li>
<li>No caso do envio de documentos para <strong>entidades não públicas</strong> (e.g envio de e-mail com PDF anexado), verificar se é enviado um e-mail com a fatura ao destinatário, <a href="#54-envio-do-documento">e se a assinatura do documento XML é desativada</a> (caso seja usada uma assinatura digital qualificada no ilink)</li>
<li>No caso da <a href="#59-consulta-de-estado-de-documentos-emitidos">consulta de estado de documentos emitidos</a>, deverão testar se o software é capaz de receber e agir confirme o estado do documento</li>
<li>Caso o documento seja rejeitado/regularizado, <a href="#56-criareditar-documento">deverá ser possível reenviar o mesmo</a> com informação retificada.</li>
</ul>
<p><strong>Receção de documentos (no caso da implementação do fluxo de receção)</strong></p>
<ul>
<li>Devem verificar se um documento recebido é corretamente integrado no software, <a href="#63-importa%C3%A7%C3%A3o-e-aceita%C3%A7%C3%A3o">e se é comunicada a correta importação e aceitação do mesmo</a>.</li>
</ul>
<p><strong>Passagem a produção (obrigatório)</strong></p>
<ol>
<li>Configurar o <a href="#2-notas-t%C3%A9cnicas">URL de produção</a> no vosso software</li>
<li>Solicitar à equipa do ilink o token de aplicação e chave(s) da(s) entidade(s) do ambiente de produção</li>
<li>Assegurar-se que são efetuadas as <a href="#42-autentica%C3%A7%C3%A3o">autenticações</a> necessárias em ambiente produtivo</li>
<li>Assegurar-se que o cliente tem todas as ligações previamente configuradas no portal do ilink, assim como as transações necessárias ativas (solicitar ao serviço de apoio)</li>
<li>Opcional: assegurar que o cliente tem a assinatura digital corretamente configurada no ambiente produtivo.</li>
<li>Opcional: assegurar que o cliente tem o template de envio de e-mail de faturação configurado no ambiente produtivo.</li>
</ol></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Páginas de documentação"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/integracoes-ilink"><div class="pagination-nav__sublabel">Anterior</div><div class="pagination-nav__label">Lista de Integrações</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/integracao-as2"><div class="pagination-nav__sublabel">Próxima</div><div class="pagination-nav__label">Integração via AS2</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-âmbito" class="table-of-contents__link toc-highlight">1. Âmbito</a></li><li><a href="#2-notas-técnicas" class="table-of-contents__link toc-highlight">2. Notas Técnicas</a></li><li><a href="#3-pré-requisitos" class="table-of-contents__link toc-highlight">3. Pré requisitos</a></li><li><a href="#4-especificação-técnica" class="table-of-contents__link toc-highlight">4. Especificação técnica</a><ul><li><a href="#41-autorização" class="table-of-contents__link toc-highlight">4.1 Autorização</a></li><li><a href="#42-autenticação" class="table-of-contents__link toc-highlight">4.2 Autenticação</a></li></ul></li><li><a href="#5-emissão-de-documentos" class="table-of-contents__link toc-highlight">5. Emissão de documentos</a><ul><li><a href="#51-âmbito" class="table-of-contents__link toc-highlight">5.1 Âmbito</a></li><li><a href="#52-assinatura-digital" class="table-of-contents__link toc-highlight">5.2 Assinatura digital</a></li><li><a href="#53-métodos-de-envio" class="table-of-contents__link toc-highlight">5.3 Métodos de envio</a></li><li><a href="#54-envio-do-documento" class="table-of-contents__link toc-highlight">5.4 Envio do documento</a></li><li><a href="#55-validações-adicionais" class="table-of-contents__link toc-highlight">5.5 Validações adicionais</a></li><li><a href="#56-criareditar-documento" class="table-of-contents__link toc-highlight">5.6 Criar/editar documento</a></li><li><a href="#57-acesso-a-documentos-emitidos" class="table-of-contents__link toc-highlight">5.7 Acesso a documentos emitidos</a></li><li><a href="#58-consulta-de-documentos-emitidos-no-portal-opcional" class="table-of-contents__link toc-highlight">5.8 Consulta de documentos emitidos no portal (opcional)</a></li><li><a href="#59-consulta-de-estado-de-documentos-emitidos" class="table-of-contents__link toc-highlight">5.9 Consulta de estado de documentos emitidos</a></li></ul></li><li><a href="#6-receção-de-documentos" class="table-of-contents__link toc-highlight">6. Receção de documentos</a><ul><li><a href="#61-âmbito" class="table-of-contents__link toc-highlight">6.1 Âmbito</a></li><li><a href="#62-métodos-de-receção" class="table-of-contents__link toc-highlight">6.2 Métodos de receção</a></li><li><a href="#63-importação-e-aceitação" class="table-of-contents__link toc-highlight">6.3 Importação e aceitação</a></li><li><a href="#64-estados-de-processo-opcional" class="table-of-contents__link toc-highlight">6.4 Estados de Processo (opcional)</a></li></ul></li><li><a href="#7-casos-de-uso" class="table-of-contents__link toc-highlight">7. Casos de uso</a><ul><li><a href="#71-criação-de-documentos-por-envio-de-dados" class="table-of-contents__link toc-highlight">7.1 Criação de documentos por envio de dados</a></li><li><a href="#72-criação-de-documentos-por-envio-do-cius-pt" class="table-of-contents__link toc-highlight">7.2 Criação de documentos por envio do CIUS-PT</a></li></ul></li><li><a href="#8-fluxos-api" class="table-of-contents__link toc-highlight">8. Fluxos API</a></li><li><a href="#9-checklist-pré-produção" class="table-of-contents__link toc-highlight">9. Checklist pré-produção</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 ilink.pt | apoio@ilink.pt | 707 451 451</div></div></div></footer></div>
</body>
</html>