<!doctype html>
<html lang="ptPT" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-integrations/api/issued" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Emissão de documentos | ilink Knowledge Base</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/docs/integrations/api/issued"><meta data-rh="true" property="og:locale" content="ptPT"><meta data-rh="true" property="og:locale:alternate" content="enGB"><meta data-rh="true" name="docusaurus_locale" content="pt"><meta data-rh="true" name="docsearch:language" content="pt"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Emissão de documentos | ilink Knowledge Base"><meta data-rh="true" name="description" content="Âmbito"><meta data-rh="true" property="og:description" content="Âmbito"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/docs/integrations/api/issued"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/integrations/api/issued" hreflang="ptPT"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/en/docs/integrations/api/issued" hreflang="enGB"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/integrations/api/issued" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Emissão de documentos","item":"https://your-docusaurus-site.example.com/docs/integrations/api/issued"}]}</script><link rel="stylesheet" href="/assets/css/styles.c09e8c32.css">
<script src="/assets/js/runtime~main.3f9e2f35.js" defer="defer"></script>
<script src="/assets/js/main.9f762443.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.png"><div role="region" aria-label="Pular para o conteúdo principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Pular para o conteúdo principal</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Alternar a barra de navegação" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="ilink Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="ilink Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">ilink Knowledge Base</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Guias Técnicos</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/integrations/api/scope">API REST</a></li><li><a class="dropdown__link" href="/docs/integrations/webhooks/intro">Webhooks</a></li><li><a class="dropdown__link" href="/docs/integrations/as2/intro">AS2</a></li><li><a class="dropdown__link" href="/docs/onboarding-feap">Onboarding FEAP</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Integrações</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/guides/main">Lista de Integrações</a></li><li><a class="dropdown__link" href="/docs/guides/moloni">Integração Moloni</a></li><li><a class="dropdown__link" href="/docs/guides/medidata">Integração Medidata</a></li></ul></div><a href="https://www.ilink.pt/swagger-ui/dist/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Especificação Técnica</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Português</a><ul class="dropdown__menu"><li><a href="/docs/integrations/api/issued" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ptPT">Português</a></li><li><a href="/en/docs/integrations/api/issued" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="enGB">English</a></li></ul></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Alterar entre os modos claro e escuro (modo system mode ativado)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Volte para o topo" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">ilink Knowledge Base</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/integrations/api/scope">Integração API REST</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/api/scope">Introdução ao API REST v1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/api/specification">Especificação técnica</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/integrations/api/issued">Emissão de documentos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/api/received">Receção de documentos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/api/usecases">Casos de uso</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/api/flows">Fluxos API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/api/checklist">Checklist pré-produção</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/integrations/webhooks/intro">Webhooks ilink</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/integrations/as2/intro">Integração AS2</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/onboarding-feap">Onboarding FEAP</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Página Inicial" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Integração API REST</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Emissão de documentos</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Nessa página</button></div><div class="theme-doc-markdown markdown"><header><h1>Emissão de documentos</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="âmbito">Âmbito<a href="#âmbito" class="hash-link" aria-label="Link direto para Âmbito" title="Link direto para Âmbito">​</a></h2>
<p>A plataforma ilink permite aos sistemas integradores emitir documentos que são automaticamente enviados aos respetivos destinatários. O ilink gere todo o processo de envio para os ERPs e EDIs configurados para cada cliente, tornando este processo transparente para o API. Estas configurações são realizadas pela equipa de apoio do ilink antes da entrada em produção.</p>
<p>A plataforma ilink suporta o envio de faturas eletrónicas em 2 cenários distintos:</p>
<ul>
<li><strong>Envio de PDF assinado via e-mail para consumidores finais ou empresas privadas</strong>
<ul>
<li>Neste cenário, não é necessário criar ligações com outros EDIs. Basta indicar no endpoint de criação de documento o(s) endereço(s) de e-mail de destino. Para mais informações, consulte a secção <a href="/docs/integrations/api/issued#m%C3%A9todos-de-envio">Métodos de envio</a>.</li>
</ul>
</li>
<li><strong>Envio de XML CIUS-PT para entidades públicas (obrigatório nos contratos públicos)</strong>
<ul>
<li>Neste cenário, é necessário configurar previamente as ligações entre NIFs e, possivelmente, entre outros brokers EDI externos.</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Como são enviados os documentos para outros brokers EDI?</strong>
Durante a fase de passagem a produção, deve ser feito um levantamento de todas as entidades que irão receber documentos via EDI, bem como os respetivos brokers EDI. Posteriormente, a equipa de apoio (<a href="mailto:apoio@ilink.pt" target="_blank" rel="noopener noreferrer">apoio@ilink.pt</a>) configurará as ligações necessárias para que os documentos sejam automaticamente integrados no sistema de cada recetor. Antes de enviar documentos para a solução FE-AP da eSPap, é também necessário que cada emissor complete o <a href="/docs/onboarding-feap">processo de adesão de fornecedores FE-AP</a>.</p>
</blockquote>
<p>Todos os documentos emitidos ficam disponíveis no portal do ilink, tanto para a entidade emissora como para a entidade recetora.</p>
<blockquote>
<p><strong>Nota: No ambiente de testes, deve emitir documentos apenas entre as 2 entidades que receberam acessos.</strong> Caso pretenda verificar o funcionamento do envio de documentos para um consumidor final (NIF arbitrário), deve sempre emitir o documento através de uma das entidades que receberam acessos.</p>
</blockquote>
<p><strong>IMPORTANTE:</strong> Para o envio de documentos a <strong>entidades públicas</strong>, recomendamos vivamente a implementação dos seguintes aspetos, sob pena de não conseguir integrar os documentos com determinados sistemas:</p>
<ul>
<li>Número de compromisso</li>
<li>Ficheiro PDF original da fatura</li>
<li>Número de encomenda ou requisição (se aplicável)</li>
<li>Capital Social do fornecedor</li>
<li>Endereço de e-mail do cliente (apenas para as secretarias do Governo Regional da Madeira)</li>
<li>Todos os dados da morada do fornecedor (rua, código postal, cidade, etc.)</li>
<li>GLN do cliente (se aplicável)</li>
<li>Possibilidade de reenvio do documento mediante o estado obtido (útil para corrigir e reenviar um documento previamente rejeitado)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="assinatura-digital">Assinatura digital<a href="#assinatura-digital" class="hash-link" aria-label="Link direto para Assinatura digital" title="Link direto para Assinatura digital">​</a></h2>
<p>O ilink permite assinar automaticamente os anexos dos documentos emitidos (XML e PDF), desde que a entidade emissora tenha adquirido e configurado um selo de um dos provedores de assinaturas digitais qualificadas. Atualmente, apenas o <a href="https://globaltrustedsign.com/" target="_blank" rel="noopener noreferrer">GTS - Global Trusted Sign</a> é suportado, mas existem planos para suportar os restantes provedores em Portugal.</p>
<p>Isto significa que o ERP não é obrigado a integrar com um provedor de assinaturas, podendo delegar (opcionalmente) o processo de certificação ao ilink. A alternativa será o próprio ERP efetuar o processo de certificação e enviar os documentos já assinados para o ilink.</p>
<blockquote>
<p><strong>Nota:</strong> <strong>No cenário de assinatura via ilink, por defeito, todos os ficheiros resultantes são assinados no momento de entrada (xml e pdf)</strong>, sendo posteriormente enviados ao cliente. Este comportamento pode ser alterado, permitindo definir que ficheiros são assinados. Para mais informações, consulte a seção sobre o <a href="/docs/integrations/api/issued#cria%C3%A7%C3%A3o-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas">consumo de assinaturas</a>.</p>
</blockquote>
<p><strong>No caso de assinatura via ERP, a assinatura digital do documento é sempre validada criptograficamente para todos os documentos que entram no sistema</strong>. Um documento com assinatura inválida, tanto no XML como no PDF, não integrará e retornará sempre um erro via API como o seguinte:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e217&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;A assinatura do documento não é válida.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>O erro anterior indica que o documento sofreu alterações desde o momento da assinatura, ou que a assinatura foi gerada incorretamente. O seguinte <a href="https://ec.europa.eu/cefdigital/DSS/webapp-demo/validation" target="_blank" rel="noopener noreferrer">validador</a> pode ser utilizado para verificar a validade da assinatura dos documentos. Os formatos de assinatura reconhecidos pelo ilink são <a href="https://www.adobe.com/uk/acrobat/resources/document-files/pdf-types/pades.html" target="_blank" rel="noopener noreferrer">PADES</a> e PKCS7-B (PDF), ou XMLDSig e <a href="https://en.wikipedia.org/wiki/XAdES" target="_blank" rel="noopener noreferrer">XADES-BES</a> (XML).</p>
<blockquote>
<p><strong>Nota:</strong> Os requisitos legais de assinatura das faturas eletrónicas estão disponíveis no <a href="https://dre.pt/home/-/dre/119622094/details/maximized" target="_blank" rel="noopener noreferrer">Decreto-Lei 28/2019, secção II, artigo 12º</a>.</p>
</blockquote>
<blockquote>
<p><strong>Nota:</strong> O ilink assina os documentos PDF em <a href="https://www.adobe.com/uk/acrobat/resources/document-files/pdf-types/pades.html" target="_blank" rel="noopener noreferrer">PADES</a> e os documentos XML em <a href="https://en.wikipedia.org/wiki/XAdES" target="_blank" rel="noopener noreferrer">XADES-BES</a> <a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/ms767623%28v=vs.85%29" target="_blank" rel="noopener noreferrer">enveloped</a>.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="métodos-de-envio">Métodos de envio<a href="#métodos-de-envio" class="hash-link" aria-label="Link direto para Métodos de envio" title="Link direto para Métodos de envio">​</a></h2>
<p>Após efetuada a autenticação com sucesso, estamos em condições de começar a enviar documentos.
O API do ilink disponibiliza duas abordagens para o envio de documentos:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="envio-do-xml-em-formato-ubl-21-cius-pt-ou-ubl-21-peppolbis3---encomendas">Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)<a href="#envio-do-xml-em-formato-ubl-21-cius-pt-ou-ubl-21-peppolbis3---encomendas" class="hash-link" aria-label="Link direto para Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)" title="Link direto para Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)">​</a></h3>
<p>Neste método, o sistema integrador deve gerar corretamente o ficheiro XML antes de enviá-lo para o ilink. A eSPap disponibiliza a especificação técnica do formato CIUS-PT <a href="https://www.espap.gov.pt/Imagens/Documento.ashx?id=265" target="_blank" rel="noopener noreferrer">aqui</a>.</p>
<p>Todos os ficheiros XML enviados por este método <a href="https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt" target="_blank" rel="noopener noreferrer">são validados de acordo com o validador oficial da eSPap, versão 2.1.2</a>, e o API retornará um erro caso se verifiquem inconsistências sintáticas. A eSPap disponibiliza um <a href="https://www.espap.gov.pt/Imagens/Documento.ashx?id=267" target="_blank" rel="noopener noreferrer">validador Schematron</a> que implementa todas as validações da <a href="https://ec.europa.eu/digital-building-blocks/sites/spaces/DIGITAL/pages/467108950/EN+16931+compliance" target="_blank" rel="noopener noreferrer">Norma Europeia EN16931 CIUS</a> e as validações adicionais do CIUS-PT, estando disponível online <a href="https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt" target="_blank" rel="noopener noreferrer">neste link</a>. <strong>Se os ficheiros validam sintaticamente no <a href="https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt" target="_blank" rel="noopener noreferrer">validador online</a>, então deverão validar no ilink, com exceção das <a href="/docs/integrations/api/issued#valida%C3%A7%C3%B5es-adicionais">validações adicionais</a> definidas pelo destinatário do documento.</strong></p>
<blockquote>
<p><strong>Nota:</strong> Para incluir um ficheiro <strong>PDF</strong> na fatura eletrónica e consultar outros casos de uso, consulte a secção <a href="/docs/integrations/api/usecases#cria%C3%A7%C3%A3o-de-documentos-por-envio-do-cius-pt">casos de uso</a>.</p>
</blockquote>
<blockquote>
<p><strong>Nota:</strong> A eSPap também disponibiliza vários <a href="https://www.espap.gov.pt/Imagens/Documento.ashx?id=254" target="_blank" rel="noopener noreferrer">exemplos do CIUS-PT</a>.</p>
</blockquote>
<p>Alguns exemplos de erros no processo de validação XML:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e217&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[BR-CO-25]-Caso o valor a pagar (BT-115) seja positivo, deve indicar a data de vencimento (BT-9) ou a nota da condição de pagamento (BT-20).&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e217&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[DT-CIUS-PT-166]-Amount due for payment (BT-115) = Invoice total amount with VAT (BT-112) -Paid amount (BT-113) +Rounding amount (BT-114), with an acceptance range of 1.00 € (it does not mean that this tolerance is accepted by the customer).&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>O método a utilizar para envio do XML é o <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">POST /apps/documentsUBL</a></strong>. Neste contexto, <strong>a chave pública identifica o emissor do documento</strong> e deve corresponder à chave associada ao NIF do emissor especificado no XML (<code>AccountingSupplierParty&gt;Party&gt;PartyTaxScheme&gt;CompanyID</code> para faturas/notas de crédito, ou <code>AccountingCustomerParty&gt;Party&gt;PartyTaxScheme&gt;CompanyID</code> para encomendas). Caso isto não se verifique, o API retornará o seguinte erro:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;supplier&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e199&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;A entidade criadora do documento deve ser cliente ou fornecedor do novo documento.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Se o XML for válido e respeitar todas as validações da norma, bem como todas as <a href="/docs/integrations/api/issued#valida%C3%A7%C3%B5es-adicionais">regras de negócio adicionais do recetor</a>, o API retorna uma resposta de sucesso, juntamente com os dados principais do documento criado:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">201</span><span class="token plain"> Created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s011&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documento criado com sucesso&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;response&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;60796c3c2a6fa2.53909016&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;7411111&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;emission_date&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2021-04-15&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type_document_fact&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5c9cb870a5ef57.36583702&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;380&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;invoice&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Fatura&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;issued&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Emitido&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;state_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5c9cb878745b16.4225687&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sent&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Enviado ao cliente.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Nota:</strong> Um documento é enviado com sucesso ao destinatário via EDI quando o campo <code>state_document.alias</code> tem o valor <code>sent</code> ou <code>accepted</code>. Caso pretenda apenas que o documento seja enviado via e-mail, o estado do documento deve ser ignorado, devendo consultar alternativamente o registo dos e-mails enviados através da <a href="/docs/integrations/api/issued#consulta-de-estado-de-documento-enviado-via-e-mail">consulta de estado</a>.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="envio-dos-dados-estruturados-do-documento">Envio dos dados estruturados do documento<a href="#envio-dos-dados-estruturados-do-documento" class="hash-link" aria-label="Link direto para Envio dos dados estruturados do documento" title="Link direto para Envio dos dados estruturados do documento">​</a></h3>
<p>Ao adotar esta opção, o ERP dispensa a geração completa do XML, ficando o ilink responsável por gerar o XML final. Assim, o ERP necessita apenas de enviar ao ilink todos os dados referentes ao documento. O endpoint a adotar aqui é o <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument" target="_blank" rel="noopener noreferrer">POST /apps/documents</a></strong></p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20210415-123923-45dc58da575be97ec00b5f16d9c8da41.png" width="1490" height="895" class="img_ev3q"></p>
<p>A especificação deste método é extensa, pois abrange todos os campos possíveis de uma fatura/encomenda, que estão devidamente documentados na especificação. Todos os documentos criados por este endpoint estão sujeitos às mesmas validações que os documentos enviados pelo método <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">POST /apps/documentsUBL</a></strong>, ou seja, o XML resultante dos dados inseridos será validado de acordo com o validador oficial da eSPap, que pode ser consultado online <a href="https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt" target="_blank" rel="noopener noreferrer">neste link</a>, e segundo as <a href="/docs/integrations/api/issued#valida%C3%A7%C3%B5es-adicionais">regras de negócio adicionais</a> do recetor do documento, caso existam.</p>
<blockquote>
<p><strong>Nota:</strong> Para incluir um ficheiro <strong>PDF</strong> na fatura eletrónica e outras situações habituais, consulte a secção <a href="/docs/integrations/api/usecases#cria%C3%A7%C3%A3o-de-documentos-por-envio-de-dados">casos de uso</a>.</p>
</blockquote>
<blockquote>
<p><strong>Nota:</strong> É possível enviar vários anexos num documento através do campo <code>files[]</code> (ver especificação acima). Contudo, a representação visual do documento (i.e. PDF original da fatura usado na impressão) deve ser enviada sempre no campo <code>file</code>, sendo o campo <code>files[]</code> reservado para ficheiros adicionais (notas de encomenda, avisos de despacho, guias de transporte, etc.). <strong>Se o emissor do documento tem uma assinatura digital ativa no ilink, todos os anexos serão assinados por defeito</strong>, e o consumo de transações terá em conta a soma do tamanho ocupado por todos os anexos enviados (é debitada 1 transação por cada 1MB de anexos enviados).</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="envio-do-documento">Envio do documento<a href="#envio-do-documento" class="hash-link" aria-label="Link direto para Envio do documento" title="Link direto para Envio do documento">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="envio-via-edi">Envio via EDI<a href="#envio-via-edi" class="hash-link" aria-label="Link direto para Envio via EDI" title="Link direto para Envio via EDI">​</a></h3>
<p>Um documento, após criação com sucesso por qualquer um dos métodos descritos (<a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">envio de XML</a> ou <a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument" target="_blank" rel="noopener noreferrer">envio de dados</a>), será enviado automaticamente ao destinatário por EDI. Contudo, em casos pontuais, este poderá não ser entregue imediatamente via EDI devido a configurações em falta e/ou outras anomalias na plataforma ilink ou no sistema do recetor. Caso isto se verifique, será devolvido um campo <code>to_send_status</code> na resposta do documento para detalhar a situação:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">201</span><span class="token plain"> OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s011&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documento criado com sucesso&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;response&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;60796c3c2a6fa2.53909016&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;state_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5c9cb870f34b16.42025494&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tosend&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Por enviar ao cliente.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;to_send_status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sent_connection&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;title&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Aguardar a aceitação de ligação com o destinatário do documento.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Nota:</strong> Pode verificar que o documento <strong>NÃO</strong> foi entregue via EDI pois o campo <code>state_document.alias</code> assume o valor <code>tosend</code> e o motivo de erro encontra-se descrito no campo <code>to_send_status</code>. Nesta situação, é necessário primeiro concluir a ligação EDI com o destinatário e depois proceder ao reenvio.</p>
</blockquote>
<p>Os motivos possíveis (<code>code</code>) para um documento não ser entregue são:</p>
<ul>
<li><code>sent_connection</code>, <code>no_connection</code>: Ligação com o destinatário em falta</li>
<li><code>registered_entity</code>: O destinatário não está registado no ilink</li>
<li><code>received_pay_transactions</code>: O destinatário suporta os custos dos documentos recebidos mas não dispõe de transações suficientes para o envio do documento</li>
</ul>
<p>Após regularizar a situação de erro, será possível enviar o documento novamente (ver secção de <a href="/docs/integrations/api/issued#criareditar-documento">reenvio de documentos</a>).</p>
<blockquote>
<p><strong>Nota</strong>: O estado do documento (<code>state_document</code>) é apenas aplicável a envios EDI. Caso o documento seja apenas enviado para um cliente arbitrário via e-mail (PDF), o estado de envio não reflete o envio do e-mail. Consulte a seguinte <a href="/docs/integrations/api/issued#consulta-de-estado-de-documento-enviado-via-e-mail">secção</a> para mais informações.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="envio-via-e-mail">Envio via e-mail<a href="#envio-via-e-mail" class="hash-link" aria-label="Link direto para Envio via e-mail" title="Link direto para Envio via e-mail">​</a></h3>
<p>Um documento, após criação com sucesso (HTTP status 201) por qualquer um dos métodos descritos (<a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">envio de XML</a> ou <a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument" target="_blank" rel="noopener noreferrer">envio de dados</a>), será remetido via e-mail ao destinatário caso seja especificado o campo <code>send_by_email</code> com o valor <code>1</code>. O(s) endereço(s) do(s) recetor(es) do documento pode(m) ser especificado(s) de 3 formas:</p>
<ul>
<li>no campo <code>additional_emails[]</code> (em ambos os métodos de envio)</li>
<li>no campo <code>customer[email]</code> (apenas no método de envio de dados)</li>
<li>no elemento <code>cac:AccountingCustomerParty/cac:Party/cac:Contact/cbc:ElectronicMail</code> do XML (apenas no método de envio de XML).</li>
</ul>
<p>Para consultar o envio dos e-mails e leitura dos mesmos pelo cliente, ver secção de <a href="/docs/integrations/api/issued#consulta-de-estado-de-documentos-emitidos">consulta de estado de documentos emitidos</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="criação-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas">Criação de documentos e consumo de assinaturas digitais qualificadas<a href="#criação-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas" class="hash-link" aria-label="Link direto para Criação de documentos e consumo de assinaturas digitais qualificadas" title="Link direto para Criação de documentos e consumo de assinaturas digitais qualificadas">​</a></h3>
<blockquote>
<p><strong>Nota</strong>: Esta secção é apenas relevante para clientes que utilizam o ilink para assinar digitalmente os documentos emitidos. <a href="/docs/integrations/api/issued#assinatura-digital">Ver detalhes</a>.</p>
</blockquote>
<p>Caso esteja configurada uma assinatura digital qualificada no ilink, todos os documentos serão assinados no momento da sua criação, incluindo todos os ficheiros resultantes da fatura eletrónica (xml e pdf). Dado que a assinatura dos documentos não é obrigatória por lei em todos os cenários de utilização, é possível controlar individualmente a assinatura dos ficheiros xml e pdf no momento da criação do documento através dos campos <code>disable_xml_sign</code> e <code>disable_pdf_sign</code>, disponíveis em ambos os métodos de criação de documento (<a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">XML</a> ou <a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument" target="_blank" rel="noopener noreferrer">dados</a>). Isto permite reduzir o consumo de assinaturas digitais, bem como otimizar o processo de criação de documentos.</p>
<p>Ou seja:</p>
<ul>
<li>No envio de fatura digital via <strong>PDF assinado para um consumidor final ou cliente privado</strong>, não será obrigatório assinar o ficheiro XML resultante, pelo que recomendamos a utilização do campo <code>disable_xml_sign: 1</code>.</li>
<li>No envio de fatura eletrónica para a <strong>Administração Pública via EDI</strong> (exemplo eSPap), não é obrigatório assinar o documento, no entanto é sempre possível assinar ambos os ficheiros por motivos de segurança adicional e integridade. Se pretende, por exemplo, desativar a assinatura digital do anexo PDF, basta usar a opção <code>disable_pdf_sign: 1</code>.</li>
<li><strong>Os campos acima descritos apenas têm efeito quando o emissor do documento usa uma assinatura digital qualificada no ilink.</strong></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="validações-adicionais">Validações adicionais<a href="#validações-adicionais" class="hash-link" aria-label="Link direto para Validações adicionais" title="Link direto para Validações adicionais">​</a></h2>
<p>O recetor da fatura pode configurar no ilink requisitos adicionais para determinados campos (regras de negócio), mesmo quando estes não são obrigatórios na especificação CIUS-PT. Por exemplo, um cliente pode definir que apenas aceita faturas com o ficheiro PDF em anexo ou com o número de compromisso especificado. É fundamental que estes requisitos sejam acordados previamente com o cliente/destinatário antes da entrada em produção, de forma a evitar erros de integração.</p>
<p>Caso o recetor do documento obrigue à presença de algum campo não especificado no XML, o API retornará um erro como abaixo e o documento não será gerado:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;commitment_number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e048&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;O número de compromisso é obrigatório.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Note-se que apenas são retornados erros neste formato quando o receptor do documento é cliente ilink e tem as devidas regras de negócio configuradas na plataforma. Quando um documento é enviado a um sistema EDI externo, qualquer falha no processo de validação é normalmente comunicada num momento futuro via alteração de estado para <strong>Rejeitado</strong>, com a devida mensagem de erro. É importante notar que nem todos os sistemas EDI suportam envio de mensagens de estado.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="criareditar-documento">Criar/editar documento<a href="#criareditar-documento" class="hash-link" aria-label="Link direto para Criar/editar documento" title="Link direto para Criar/editar documento">​</a></h2>
<p>Um documento pode ser editado e reenviado ao destinatário:</p>
<ul>
<li>se <strong>ainda não foi enviado</strong> ao cliente final</li>
<li>ou se <strong>já foi enviado ao cliente e o cliente pediu uma regularização</strong></li>
</ul>
<p>Em termos práticos, a possibilidade de reenvio pode ser consultada através do seguinte campo de resposta do documento:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;state_edi_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> &lt;estado&gt; </span><span class="token comment" style="color:#999988;font-style:italic">// estados possíveis de reenvio: &#x27;regularization&#x27; ou &#x27;reception&#x27; ou &#x27;error&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Para consultar o estado de um documento, ver secção de <a href="/docs/integrations/api/issued#consulta-de-estado-de-documentos-emitidos">consulta de estado de documentos emitidos</a>.</p>
<p>Para editar um documento existente, basta repetir o pedido <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL" target="_blank" rel="noopener noreferrer">POST /apps/documentsUBL</a></strong> ou <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument" target="_blank" rel="noopener noreferrer">POST /apps/documents</a></strong> com os dados corrigidos, mantendo o <strong>número, tipo e data de emissão</strong> do documento anterior:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">HTTP</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s012&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documento editado com sucesso&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">&quot;response&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;60796c3c2a6fa2.53909016&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;7411111&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;emission_date&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2021-04-16&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;type_document_fact&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5c9cb870a5ef57.36583702&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;380&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;invoice&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Fatura&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;type_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;issued&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Emitido&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&quot;state_document&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5c9cb870f34b16.42025494&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;alias&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tosend&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Por enviar ao cliente.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>Caso o documento não seja elegível para edição (i.e. já foi enviado ou foi aceite pelo cliente final), será apresentado um erro ao tentar reenviar:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> Bad request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e200&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documento já existe.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="acesso-a-documentos-emitidos">Acesso a documentos emitidos<a href="#acesso-a-documentos-emitidos" class="hash-link" aria-label="Link direto para Acesso a documentos emitidos" title="Link direto para Acesso a documentos emitidos">​</a></h2>
<p>Quando um documento é registado com sucesso, será sempre devolvido um <code>id</code> nas respostas, que o identifica perante o ilink. É útil guardar este identificador para consultas futuras ao documento.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">201</span><span class="token plain"> Created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;s011&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;msg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documento criado com sucesso&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;response&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;60796c3c2a6fa2.53909016&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>O API permite também aceder a todos os dados (inclusive ao XML e PDF gerados) de todos os documentos previamente emitidos. Para tal, deve usar o método <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument" target="_blank" rel="noopener noreferrer">GET /apps/documents/{id}</a></strong>. O <code>id</code> recebido na criação do documento deve ser usado como parâmetro aqui para aceder ao documento em questão.</p>
<p>Todos os dados retornados por este método estão disponíveis na especificação.</p>
<blockquote>
<p><strong>Nota</strong>: Caso a entidade emissora do documento tenha configurado a assinatura automática de documentos no ilink, os URLs de acesso ao XML e ao PDF já retornam os ficheiros assinados.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="consulta-de-documentos-emitidos-no-portal-opcional">Consulta de documentos emitidos no portal (opcional)<a href="#consulta-de-documentos-emitidos-no-portal-opcional" class="hash-link" aria-label="Link direto para Consulta de documentos emitidos no portal (opcional)" title="Link direto para Consulta de documentos emitidos no portal (opcional)">​</a></h2>
<p>Os documentos podem também ser consultados no <a href="https://ilink.acin.pt" target="_blank" rel="noopener noreferrer">portal de testes do ilink</a> usando as credenciais das entidades que foram fornecidas. Aqui pode validar visualmente se a informação apresentada está coerente com os dados enviados via API:</p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20230420-133607-c5d03a751653d102acc0ed60c783eee4.png" width="1596" height="839" class="img_ev3q"></p>
<p>Para aceder aos anexos de um documento, deve aceder ao documento da tabela e clicar no ícone da lupa:</p>
<p><img decoding="async" loading="lazy" alt="img info" src="/assets/images/20230420-133914-c96ee4049998eb70825f7dcb46b5c6fb.png" width="1605" height="838" class="img_ev3q"></p>
<blockquote>
<p><strong>Nota:</strong> Os documentos deverão estar presentes tanto na entidade emissora (secção de documentos emitidos), como na entidade recetora (secção de documentos recebidos).</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="consulta-de-estado-de-documentos-emitidos">Consulta de estado de documentos emitidos<a href="#consulta-de-estado-de-documentos-emitidos" class="hash-link" aria-label="Link direto para Consulta de estado de documentos emitidos" title="Link direto para Consulta de estado de documentos emitidos">​</a></h2>
<p>É também possível aceder ao estado atual dos documentos previamente emitidos. Esta operação permite ao emissor do documento consultar se o documento foi aceite pelo cliente, ou se está pendente de reenvio/regularização, bem como os motivos que levaram a tal.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="consulta-de-estado-de-documento-enviado-via-edi">Consulta de estado de documento enviado via EDI<a href="#consulta-de-estado-de-documento-enviado-via-edi" class="hash-link" aria-label="Link direto para Consulta de estado de documento enviado via EDI" title="Link direto para Consulta de estado de documento enviado via EDI">​</a></h3>
<p>O ilink contempla 4 estados simplificados de documento na propriedade <code>state_document</code>:</p>
<table><thead><tr><th>Estado</th><th>alias</th><th>Descrição</th></tr></thead><tbody><tr><td><strong>Por enviar</strong></td><td><code>tosend</code></td><td>O documento não foi enviado ao cliente. Provavelmente significa que falta alguma configuração no ilink, emissor/recetor não autorizam ligação entre eles, ou que alguma das entidades presentes no documento não tem transações suficientes para proceder ao envio. Se apenas se pretende que o documento seja remetido via email, este estado deve ser ignorado.</td></tr><tr><td><strong>Enviado</strong></td><td><code>sent</code></td><td>O documento não foi enviado ao cliente. Provavelmente significa que falta alguma configuração no ilink, emissor/recetor não autorizam ligação entre eles, ou que alguma das entidades presentes no documento não tem transações suficientes para proceder ao envio. Se apenas se pretende que o documento seja remetido via email, este estado deve ser ignorado.</td></tr><tr><td><strong>Aceite</strong></td><td><code>accepted</code></td><td>O documento foi enviado e o cliente aprovou o documento. <strong>Estado final</strong>.</td></tr><tr><td><strong>Recusado</strong></td><td><code>rejected</code></td><td>O documento foi enviado e o cliente rejeitou o mesmo devido a uma incoerência. O motivo de recusa é disponibilizado na resposta no campo <code>reasons</code>. <a href="/docs/integrations/api/issued#criareditar-documento">O documento poderá ser enviado novamente</a> caso seja solicitada uma regularização.</td></tr></tbody></table>
<blockquote>
<p><strong>Nota:</strong> O ilink devolve também o <strong>estado de processamento EDI</strong> do documento (<code>state_edi_document</code>), que é independente dos estados acima. Para mais informação, consulte o <a href="https://www.espap.gov.pt/Imagens/Documento.ashx?id=269" target="_blank" rel="noopener noreferrer">Guia de Transmissão de Documentos FE-AP, página 7</a>. Contudo, a leitura do estado EDI nem sempre é relevante para os softwares de faturação.</p>
</blockquote>
<p>Existem 3 abordagens para aceder ao estado de um documento previamente emitido: <strong>Consulta individual</strong>, <strong>Webhook de mudança de estado</strong> e <strong>Reporte de estados</strong>.</p>
<ul>
<li>
<p>Na <strong>Consulta individual de estado</strong>, basta efetuar a chamada <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument" target="_blank" rel="noopener noreferrer">GET /apps/documents/{id}</a></strong>. O <code>id</code> recebido na criação do documento deve ser usado como parâmetro para aceder ao documento em questão. O estado é devolvido no campo <code>state_document</code> (ver especificação). Este método apenas permite consultar o estado de um documento de cada vez, e como tal não é recomendado para clientes que processam um volume elevado de documentos.</p>
</li>
<li>
<p>No <strong>Webhook de mudança de estado</strong>, o ilink tem a iniciativa de informar o emissor do documento sempre que o mesmo muda de estado. Esta é a opção recomendada em termos de desempenho e rapidez, mas pode não ser viável caso o sistema a integrar pertença a uma rede não exposta publicamente ao ilink. Para mais informação, consulte a secção <a href="/docs/integrations/webhooks/intro">Webhooks</a>.</p>
</li>
<li>
<p>No <strong>Reporte de estados</strong>, a aplicação integradora tem a iniciativa de consultar os diversos eventos que levaram às alterações de estado dos documentos emitidos. Para tal, basta efetuar a chamada <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Hist%C3%B3rico%20de%20estados/getStatesReport" target="_blank" rel="noopener noreferrer">GET /apps/states-report/documents</a></strong>. Cada evento identifica o documento e o estado alterados. É possível filtrar os eventos retornados por <code>id</code> de documento, número de documento, intervalos de datas, entre outros (ver especificação). Este método permite à aplicação consultar o estado de vários documentos em simultâneo.</p>
<p>De modo a facilitar a utilização do reporte de estados, é adicionalmente disponibilizado o endpoint de leitura de eventos <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Hist%C3%B3rico%20de%20estados/postStatesReportRead" target="_blank" rel="noopener noreferrer">POST /apps/states-report/documents/read</a></strong>, que permite marcar um ou mais <code>id</code>s de evento obtidos anteriormente como lidos. Os eventos marcados como lidos não são retornados novamente no endpoint de reporte de estados, facilitando a consulta futura do método anterior. Esta opção é uma alternativa escalável para os sistemas que não podem implementar Webhooks.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="consulta-de-estado-de-documento-enviado-via-e-mail">Consulta de estado de documento enviado via e-mail<a href="#consulta-de-estado-de-documento-enviado-via-e-mail" class="hash-link" aria-label="Link direto para Consulta de estado de documento enviado via e-mail" title="Link direto para Consulta de estado de documento enviado via e-mail">​</a></h3>
<p>No cenário de envio de documentos por e-mail, é possível consultar o registo de envio e de leitura dos e-mails remetidos ao cliente. <strong>Note-se que o estado do documento retornado (<code>state_document</code>) não é aplicável neste cenário</strong>, pois estes documentos por norma não são enviados via EDI, e como tal, o seu estado de envio será habitualmente <code>to_send</code>. Este estado deve ser ignorado a favor das abordagens abaixo descritas:</p>
<ul>
<li>Na <strong>Consulta individual</strong>, basta efetuar a chamada <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument" target="_blank" rel="noopener noreferrer">GET /apps/documents/{id}</a></strong>. O <code>id</code> recebido na criação do documento deve ser usado como parâmetro para aceder ao documento em questão. Na resposta, deve aceder à propriedade <code>emails</code>, que retorna uma lista das mensagens enviadas e o seu estado de receção e leitura. Este método apenas permite consultar o estado de um documento de cada vez e tem as mesmas limitações que a consulta individual de documentos da secção anterior:</li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;response&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;60796c3c2a6fa2.53909016&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;emails&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;634672bab0f3b8.40302642&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;b_open&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// true caso o email tenha sido lido pelo recetor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;b_sent&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// true caso o email tenha sido enviado com sucesso</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;created_at&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2022-10-12 08:54:34&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// data e hora de envio do email</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;opened_at&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2022-10-12 09:14:16&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// data e hora de leitura do email</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;address&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;emails&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;joao.freitas@email.com&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// endereço de envio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Nota:</strong> Alguns clientes de e-mail (Outlook, etc.) podem bloquear o registo de leitura dos e-mails, ficando o <code>b_open</code> a false mesmo que o e-mail tenha sido aberto em algumas situações. O ilink tem também a capacidade de detetar se um email foi devolvido pelo servidor de email, ficando responsável por tentativas sucessivas de reenvio ao longo do tempo.</p>
</blockquote>
<ul>
<li>Na <strong>Consulta de histórico de documento</strong> é possível consultar todas as alterações processuais de um determinado documento. Este histórico irá listar todas as alterações de estado que ocorreram no documento por ordem cronológica, bem como os registos dos envios de e-mail para o destinatário, o que permite um rastreio completo de auditoria. Pode ser acedido através de <strong><a href="https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocumentHistory" target="_blank" rel="noopener noreferrer">GET /apps/documents/{id}/history</a></strong>.</li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Páginas de documentação"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/integrations/api/specification"><div class="pagination-nav__sublabel">Anterior</div><div class="pagination-nav__label">Especificação técnica</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/integrations/api/received"><div class="pagination-nav__sublabel">Próxima</div><div class="pagination-nav__label">Receção de documentos</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#âmbito" class="table-of-contents__link toc-highlight">Âmbito</a></li><li><a href="#assinatura-digital" class="table-of-contents__link toc-highlight">Assinatura digital</a></li><li><a href="#métodos-de-envio" class="table-of-contents__link toc-highlight">Métodos de envio</a><ul><li><a href="#envio-do-xml-em-formato-ubl-21-cius-pt-ou-ubl-21-peppolbis3---encomendas" class="table-of-contents__link toc-highlight">Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)</a></li><li><a href="#envio-dos-dados-estruturados-do-documento" class="table-of-contents__link toc-highlight">Envio dos dados estruturados do documento</a></li></ul></li><li><a href="#envio-do-documento" class="table-of-contents__link toc-highlight">Envio do documento</a><ul><li><a href="#envio-via-edi" class="table-of-contents__link toc-highlight">Envio via EDI</a></li><li><a href="#envio-via-e-mail" class="table-of-contents__link toc-highlight">Envio via e-mail</a></li><li><a href="#criação-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas" class="table-of-contents__link toc-highlight">Criação de documentos e consumo de assinaturas digitais qualificadas</a></li></ul></li><li><a href="#validações-adicionais" class="table-of-contents__link toc-highlight">Validações adicionais</a></li><li><a href="#criareditar-documento" class="table-of-contents__link toc-highlight">Criar/editar documento</a></li><li><a href="#acesso-a-documentos-emitidos" class="table-of-contents__link toc-highlight">Acesso a documentos emitidos</a></li><li><a href="#consulta-de-documentos-emitidos-no-portal-opcional" class="table-of-contents__link toc-highlight">Consulta de documentos emitidos no portal (opcional)</a></li><li><a href="#consulta-de-estado-de-documentos-emitidos" class="table-of-contents__link toc-highlight">Consulta de estado de documentos emitidos</a><ul><li><a href="#consulta-de-estado-de-documento-enviado-via-edi" class="table-of-contents__link toc-highlight">Consulta de estado de documento enviado via EDI</a></li><li><a href="#consulta-de-estado-de-documento-enviado-via-e-mail" class="table-of-contents__link toc-highlight">Consulta de estado de documento enviado via e-mail</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 ilink.pt | apoio@ilink.pt | 707 451 451</div></div></div></footer></div>
</body>
</html>