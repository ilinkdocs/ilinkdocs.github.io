{"searchDocs":[{"title":"Integração acinGov","type":0,"sectionRef":"#","url":"/acingov","content":"Integração acinGov O presente manual demonstra o processo a seguir para configurar a integração entre a plataforma de compras públicas acinGov e o software de faturação eletrónica ilink. Após login no ilink, aceda ao menu Entidade &gt; Dados da Entidade e copie a chave pública que vai possibilitar a integração com a plataforma acinGov. Depois, efetue o seu login na plataforma acinGov, clique em Configurações &gt; Informação Base e introduza a chave que copiou anteriormente. No final clique em ‘Associar conta’. Para remover a conta basta clicar na opção abaixo. Após estes passos, o ícone do ilink será apresentado no canto superior direito do seu menu. Desta forma saberá que a integração foi concluída com sucesso. Nota: Ao clicar sobre o logotipo será automaticamente redirecionado para o ilink, sem necessidade de introduzir os dados de acesso.","keywords":"","version":"Next"},{"title":"Integração Moloni","type":0,"sectionRef":"#","url":"/moloni","content":"","keywords":"","version":"Next"},{"title":"Configuração do Moloni​","type":1,"pageTitle":"Integração Moloni","url":"/moloni#configuração-do-moloni","content":" Após efetuar login no Moloni, devemos aceder a Configurações &gt; Developers &gt; Config API  Aqui é necessário:  Ativar o APIIntroduzir o URL de callback de resposta (https://ilink.acin.pt)    Deverão também tomar nota dos seguintes valores que são gerados automaticamente:  developer IDclient secret  ","version":"Next","tagName":"h2"},{"title":"Configuração do ilink​","type":1,"pageTitle":"Integração Moloni","url":"/moloni#configuração-do-ilink","content":" Após guardar as alterações do lado do Moloni, entrar no ilink e ir a Integrações &gt; Recepção:  O developer ID adquirido no Moloni é inserido no identificador do cliente no ilinkO client secret adquirido no Moloni é introduzido em chave do cliente no ilinkO utilizador e palavra passe são os dados de acesso da entidade Moloni.  Nota: Ambas as entidades (no Moloni e ilink) têm de possuir o mesmo NIF para a integração ser criada correctamente.  Após ativar esta configuração, o ilink irá sincronizar automaticamente todos os documentos emitidos no Moloni, e estes aparecem em Integrações &gt; Moloni:    Devemos selecionar os documentos a importar, que irão ficar em Emitidos &gt; Por enviar   ","version":"Next","tagName":"h2"},{"title":"Webhooks ilink","type":0,"sectionRef":"#","url":"/webhooks-ilink","content":"","keywords":"","version":"Next"},{"title":"Âmbito​","type":1,"pageTitle":"Webhooks ilink","url":"/webhooks-ilink#âmbito","content":" Neste modelo de comunicação, o ilink toma a iniciativa de comunicar ao ERP no momento que um determinado evento ocorre, dispensando de consultas frequentes ao nosso API.  O ilink disponibiliza 2 webhooks:  Webhook de novo documento - enviado ao receptor cada vez que um novo documento lhe é encaminhadoWebhook de mudança de estado de documento - enviado ao emissor cada vez que um documento previamente emitido altera o seu estado  Para qualquer dos webhooks acima funcionar é necessário:  Implementar um endpoint Web, disponível publicamente aos servidores do ilink, ao qual o ilink irá comunicar via HTTP. Os dados enviados do ilink para este URL público estão de acordo com o webhook que pretendem implementar (ver abaixo)Comunicar à equipa do ilink que pretendem implementar o Webhook específico para o vosso cliente, e indicar-nos uma chave de acesso e o URL público do vosso endpoint.  Este método, apesar de implementação mais extensa, tem a vantagem de evitar polling constante aos nossos servidores, consumir menos recursos em ambos os sistemas, e permite aceder a toda a informação em tempo real. Só recomendamos optar pela consulta manual caso existam implicações de segurança na abordagem dos Webhooks (ver abaixo).  ","version":"Next","tagName":"h2"},{"title":"Informação importante / Implicações de Segurança​","type":1,"pageTitle":"Webhooks ilink","url":"/webhooks-ilink#informação-importante--implicações-de-segurança","content":" Esta opção assume que o URL/porta em questão está disponível publicamente, ou pelo menos acessível aos nossos ambientes de testes e produção! Para tal, poderá ser necessário abrir portas ou criar as seguintes excepções no firewall da máquina que executa o serviço web:  https://ilink.acin.pt (62.28.56.162:443) - testeshttps://ilink.pt (194.38.136.153:443 193.43.40.153:443) - produção  Caso falhe o processo de comunicação de um documento, o ilink irá tentar comunicar novamente até 10 vezes nos próximos 7 dias, com intervalos incrementalmente maiores por cada tentativa. Após 10 tentativas falhadas de comunicação, o ilink irá deixar de tentar comunicar esse documento ao ERP.  Um documento é considerado entregue com sucesso ao ERP quando a reposta do webhook retorna um HTTP status code 200 (independentemente do conteúdo da resposta).  Importante: Na implementação deste endpoint, o ERP tem a responsabilidade de validar a chave de acesso e posteriormente registar a informação recebida no seu sistema. Recomendamos vivamente ao vosso sistema validar a chave de acesso enviada nos headers da nossa resposta, caso contrário estão a aceitar dados provenientes de origem desconhecida. O ilink envia a vossa chave no header Authorization: Bearer {CHAVE_INTEGRACAO}.  ","version":"Next","tagName":"h2"},{"title":"Webhooks​","type":1,"pageTitle":"Webhooks ilink","url":"/webhooks-ilink#webhooks","content":" ","version":"Next","tagName":"h2"},{"title":"Webhook de novo documento​","type":1,"pageTitle":"Webhooks ilink","url":"/webhooks-ilink#webhook-de-novo-documento","content":" O webhook de novo documento é uma alternativa à consulta frequente de documentos por parte da entidade receptora. Cada vez que chega um novo documento a esta entidade, o callback de novo documento será invocado.  O endpoint implementado deverá esperar os seguintes dados desta especificação.  ","version":"Next","tagName":"h3"},{"title":"Webhook de mudança de estado de documento​","type":1,"pageTitle":"Webhooks ilink","url":"/webhooks-ilink#webhook-de-mudança-de-estado-de-documento","content":" O webhook de mudança de estado de documento é uma alternativa à consulta frequente dos estados de cada documento emitido por parte da entidade emissora. Cada vez que o receptor do um documento emitido aceitar, recusar ou receber o mesmo, este callback será invocado.  O endpoint implementado deverá esperar os seguintes dados desta especificação. ","version":"Next","tagName":"h3"},{"title":"Integração iGEST","type":0,"sectionRef":"#","url":"/igest","content":"","keywords":"","version":"Next"},{"title":"Configuração​","type":1,"pageTitle":"Integração iGEST","url":"/igest#configuração","content":" Após efetuada a adesão à plataforma iLink, aceda ao menu Entidade &gt; Dados da Entidade e copie a chave pública que vai possibilitar a integração com o software faturação iGEST.    Para permitir a receção de documentos de faturação do iGEST para o iLink deverá ativar a integração. Para tal, aceda ao meu Integrações &gt; Receção e clique em ‘Ativar’.    Por sua vez, para permitir o envio de documentos de faturação do iLink para o iGEST deverá ativar a integração. Aceda ao meu Integrações &gt; Integrações - Envio e clique em ‘Ativar’.    Após estas configurações iniciais na plataforma iLink, vamos proceder à configuração do software de faturação iGEST.  Efetue o seu login no iGEST para ativar a integração com a plataforma iLINK. Para tal, deve dirigir-se ao menu Entidade &gt; Configurar &gt; Integrações e escolher ILINK. Aqui deve inserir os dados de acesso e chave pública:    Nota: O cliente pode configurar alguns campos como sendo obrigatórios para os documentos recebidos no ilink. O Número de encomenda é um desses campos: Para enviar esse campo, ao emitir o documento no iGEST, deve adicionar uma informação adicional com um dos seguintes nomes:  Nº EncomendaNúmero EncomendaNúmero de EncomendaEncomenda.    Nota 2: Um documento ficará disponível para reenvio caso seja rejeitado pelo cliente no iLink por motivo “Regularizar”  ","version":"Next","tagName":"h2"},{"title":"Como enviar documentos para o iLINK manualmente?​","type":1,"pageTitle":"Integração iGEST","url":"/igest#como-enviar-documentos-para-o-ilink-manualmente","content":" Menu Entidade &gt; iLINK - Digital Sharing &gt; Documentos por enviarSeleccionar documentos pretendidosClicar em enviar selecionados  ","version":"Next","tagName":"h2"},{"title":"Como importar documentos compras dos fornecedores?​","type":1,"pageTitle":"Integração iGEST","url":"/igest#como-importar-documentos-compras-dos-fornecedores","content":" Menu Entidade &gt; iLINK - Digital Sharing &gt; Documentos por importarSeleccionar documentos pretendidosClicar em importar selecionadosPara consultar documentos importados devem ir a menu Compras &gt; Pesquisar  ","version":"Next","tagName":"h2"},{"title":"Como consultar estado/histórico documentos enviados?​","type":1,"pageTitle":"Integração iGEST","url":"/igest#como-consultar-estadohistórico-documentos-enviados","content":" Menu Entidade &gt; iLINK - Digital Sharing &gt; Histórico de envio  ","version":"Next","tagName":"h2"},{"title":"Como consultar histórico documentos importados?​","type":1,"pageTitle":"Integração iGEST","url":"/igest#como-consultar-histórico-documentos-importados","content":" Menu Entidade &gt; iLINK - Digital Sharing &gt; Histórico de importação ","version":"Next","tagName":"h2"},{"title":"Integração Medidata","type":0,"sectionRef":"#","url":"/medidata","content":"","keywords":"","version":"Next"},{"title":"Funcionamento​","type":1,"pageTitle":"Integração Medidata","url":"/medidata#funcionamento","content":" O ilink tem a capacidade de integrar faturas com os programas da suite Medidata, tanto no inbound (receção de documentos na aplicação Sigma) como no outbound (envio de documentos da aplicação das águas).  Para tal processo funcionar, é necessário assegurar os seguintes requisitos do lado do cliente:  ","version":"Next","tagName":"h2"},{"title":"Inbound (envio de documentos do ilink para o software Medidata)​","type":1,"pageTitle":"Integração Medidata","url":"/medidata#inbound-envio-de-documentos-do-ilink-para-o-software-medidata","content":" É necessário que o cliente disponibilize um servidor SFTP, com permissões de escrita, e acessível publicamente ou aos IPs do ilink com regras NAT:  62.28.56.161, 62.28.56.162 (ilink testes)193.43.40.153 (ilink produção)Opcionalmente, podem ser autorizadas as gamas de IP anteriores.  Nota: Apenas é suportado o protocolo SFTP. Ligações FTP, mesmo com encriptação TLS/SSL, não são aceites.  Este servidor deverá ser também acessível ao software Medidata (normalmente através do mapeamento de uma pasta de rede). O objetivo é que seja possível ao ilink criar ficheiros neste servidor e que os mesmos consigam ser lidos pelo software Medidata através da pasta INBOUND.  Após a criação do mesmo, devem-nos enviar os seguintes dados para serem configurados no ilink:  endereço/IP do servidorportautilizadorpalavra-passe  ","version":"Next","tagName":"h2"},{"title":"Outbound (envio de documentos do software Medidata para o ilink)​","type":1,"pageTitle":"Integração Medidata","url":"/medidata#outbound-envio-de-documentos-do-software-medidata-para-o-ilink","content":" É necessário configurar o módulo da aplicação das águas para gerar os ficheiros XML num servidor SFTP, que deverão enviar os acessos ao ilink. Este servidor SFTP pode igualmente ser configurado como uma pasta de rede, de modo a que a aplicação das águas guarde os ficheiros XML nessa pasta, e estes fiquem imediatamente disponíveis no servidor SFTP. Não é necessário disponibilizar os ficheiros PDF na pasta de outbound.  Necessita igualmente de permissões de leitura e escrita públicas ou para os nossos IPs com regras NAT:  62.28.56.161 (ilink testes)193.43.40.153 (ilink produção)Opcionalmente, podem ser autorizadas as gamas de IP anteriores.  Nota: Apenas é suportado o protocolo SFTP. Ligações FTP, mesmo com encriptação TLS/SSL, não são aceites.  Após a criação do mesmo, devem-nos enviar os seguintes dados para serem configurados no ilink:  endereço/IP do servidorportautilizadorpalavra-passe  ","version":"Next","tagName":"h2"},{"title":"Estrutura de pastas Medidata​","type":1,"pageTitle":"Integração Medidata","url":"/medidata#estrutura-de-pastas-medidata","content":" Por norma, os servidores Medidata devem ter a seguinte estrutura de pastas preparadas para a emissão e receção de documentos:  / ├── IN # O ilink coloca aqui as faturas a receber pelo Medidata ├── OUT # Medidata coloca os estados dos documentos recebidos e processados aqui ├── OUTBOUND │ ├── ADERENTES │ ├── COPIAS │ ├── DOCUMENTOS # Medidata coloca aqui os ficheiros a enviar para o ilink | | | (IMPORTANTE: NÃO separar em subpastas por NIF) │ │ ├── ERRORS # O ilink coloca os ficheiros com erro aqui: consultar registo de integração │ │ └── FAILED # O ilink coloca aqui os ficheiros que não conseguiu processar │ └── RESPOSTAS │ └── DOCUMENTOS │ └── FicheiroEstados.txt # O ilink comunica aqui as referências das faturas criadas e enviadas ├── READED └── RESPOSTAS   ","version":"Next","tagName":"h2"},{"title":"Consulta de documentos e registos de integração​","type":1,"pageTitle":"Integração Medidata","url":"/medidata#consulta-de-documentos-e-registos-de-integração","content":" É possível consultar os documentos emitidos e recebidos no ilink acedendo ao portal, nas áreas deDocumentos Emitidos e Documentos Recebidos.  Para consulta dos documentos comunicados via integração com o Medidata (análise de erros, confirmação de receção, etc), é possível aceder à área Integrações &gt; Registos de Integração, e verificar quaisquer erros que ocorreram na comunicação de documentos.  Nota: É possível configurar o envio de um relatório via email após o envio de documentos emitidos pelo Medidata. Deste modo, é possível confirmar que documentos foram enviados com sucesso, bem como possíveis erros de integração e envio. ","version":"Next","tagName":"h2"},{"title":"Lista de Sistemas integrados","type":0,"sectionRef":"#","url":"/integracoes-ilink","content":"","keywords":"","version":"Next"},{"title":"ERPs/Sistemas de faturação​","type":1,"pageTitle":"Lista de Sistemas integrados","url":"/integracoes-ilink#erpssistemas-de-faturação","content":" iGESTb-OnlineMoloniXISConnectPrimavera (requer conector ILINK)SAGE X3 F5IT PHC WinSigAntúrioNovos canaisNorma6BetaSystemsPHCResolveNSOFTMicrolopesSeguinf SAP Lead4B Microsoft Dynamics NAV ArquiconsultSquadMicrosoft Business Central (cpcIT4all) WorkInNetAltmaia FaturaçãoMicroDigitalSIAGFacturamaXDArtsoftKeyInvoiceTripointEdiprinterSigPorForenseSendysR2 InformáticaDigiSoftProtótipoQuidgestOriGestRentway ChallengeIT ProtótipoAquamatrixFcore FapricelaNewHotelGRIDGolfinhosoftPlataforma WattElsifWebgescomINOVAsis  ","version":"Next","tagName":"h2"},{"title":"Gestão de Autarquias​","type":1,"pageTitle":"Lista de Sistemas integrados","url":"/integracoes-ilink#gestão-de-autarquias","content":" iFREG-SNC-APiTaxasMedidata Sigma-SNCairc SNC-APFresoft ERP  ","version":"Next","tagName":"h3"},{"title":"Gestão Documental​","type":1,"pageTitle":"Lista de Sistemas integrados","url":"/integracoes-ilink#gestão-documental","content":" iDokeDocuments - FlowinnWebdoc Ambisig  ","version":"Next","tagName":"h3"},{"title":"Contratação Pública​","type":1,"pageTitle":"Lista de Sistemas integrados","url":"/integracoes-ilink#contratação-pública","content":" acinGov  ","version":"Next","tagName":"h3"},{"title":"Brokers EDI​","type":1,"pageTitle":"Lista de Sistemas integrados","url":"/integracoes-ilink#brokers-edi","content":" SaphetyCegid YetEdicomSERESGenerixIndra - MinsaitFE-APPageroeFaturaGovSeeburgerInposiaCompacerMontovabaVel - Voxel GroupAtos - Eviden  *Lista atualizada a 2025-04-24 ","version":"Next","tagName":"h3"},{"title":"Onboarding FEAP","type":0,"sectionRef":"#","url":"/onboarding-feap","content":"","keywords":"","version":"Next"},{"title":"Quais os organismos da Administração Pública (AP) obrigados a utilizar a solução FE-AP?​","type":1,"pageTitle":"Onboarding FEAP","url":"/onboarding-feap#quais-os-organismos-da-administração-pública-ap-obrigados-a-utilizar-a-solução-fe-ap","content":" ​Os contraentes públicos vinculados à utilização da solução FE-AP fornecida pela eSPap são:  os organismos da Administração direta do Estado, ou seja, todos os órgãos, serviços e agentes integrados na pessoa coletiva Estado, por exemplo, Direções-Gerais, Direções Regionais, Secretarias Gerais, DGEstE, ASAE, AT, IGF, entre outras;os institutos públicos, por exemplo, o IAPMEI, o INEM, o IPDJ, o ISS, a própria eSPap, entre outros.  Consulte a lista de TODAS as entidades públicas atualmente a usar o FE-AP.  ","version":"Next","tagName":"h2"},{"title":"Como podem os fornecedores da AP aderir à solução FE-AP?​","type":1,"pageTitle":"Onboarding FEAP","url":"/onboarding-feap#como-podem-os-fornecedores-da-ap-aderir-à-solução-fe-ap","content":" Os utilizadores do ilink podem efetuar o envio automático de faturação eletrónica directamente para o FE-AP após a conclusão do processo de adesão e onboarding da eSPap.  Em suma, existem 3 passos:  ","version":"Next","tagName":"h2"},{"title":"1. Formulário de adesão​","type":1,"pageTitle":"Onboarding FEAP","url":"/onboarding-feap#1-formulário-de-adesão","content":" Preenchimento do formulário de adesão de fornecedores.  Página inicial. Premir Pedido de Adesão Preencher os dados da vossa empresa (todos os campos assinalados são obrigatórios)  Nota: No caso de representar mais do que uma entidade fiscal, devem descarregar o template e preencher o mesmo no passo 1.2:  Preencher com os dados da vossa empresa (responsável que irá dar seguimento à faturação eletrónica) Responder que vão utilizar um broker Identificar o broker ACIN, bem como o responsável do projeto no passo seguinte e marcar a autorização Inserir um email para receber as notificações de entrega dos documentos e carregar um exemplo de uma fatura e uma nota de crédito reais Passo final: consentir e enviar Receber o email de confirmação e ID de projeto, que será solicitado na fase final do projeto.  ","version":"Next","tagName":"h3"},{"title":"2. Testes​","type":1,"pageTitle":"Onboarding FEAP","url":"/onboarding-feap#2-testes","content":" Após a validação pela equipa da eSPap, o fornecedor é contactado pela eSPap com email que informa o seu ID de projeto e a data de início dos testes:  O fornecedor deverá solicitar acessos no ambiente de qualidade (testes) do ilink e emitir diversos documentos para estas entidades de teste. Estes documentos poderão ser criados manualmente no ilink mas idealmente recomendamos que sejam integrados directamente a partir do seu software EDI/ERP. Nota: devem enviar sempre o PDF da fatura anexado durante a fase de testes.Após o envio destes documentos para as entidades de teste, o fornecedor deverá informar a equipa do iLink para verificar se os ficheiros foram comunicados com sucesso à eSPap, e caso contrário, como deverão corrigir os documentos.À medida que os documentos são integrados correctamente no ambiente de qualidade da eSPap, o fornecedor irá receber e-mails de confirmação como este. Nota: deverão guardar os IDs obtidos, bem como os documentos que enviaram para testes, pois são necessários para a fase final!  2.1 Preenchimento de campos das faturas nos testes​  Caso não pretenda criar os documentos manualmente no ilink, pode saltar este passo.  É altamente recomendado preencher os campos abaixo durante a fase de testes:  Número de encomenda (deve usar o valor TESTENOTAENCOM1234): Morada de entrega (deve usar a morada presente na fatura) Termos de pagamento (deve usar os termos de pagamento presentes na fatura) Meios de pagamento (deve usar os meios de pagamento presentes na fatura) Número de compromisso (deve usar o valor TESTECOMPROMISSO1234) PDF do documento (obrigatório)  ","version":"Next","tagName":"h3"},{"title":"3. Passagem a produção​","type":1,"pageTitle":"Onboarding FEAP","url":"/onboarding-feap#3-passagem-a-produção","content":" Após o envio de faturas e notas de crédito válidas e a sua confirmação pela equipa do iLink, o fornecedor deverá preencher o formulário de passagem a produção.  Neste formulário, terá de preencher uma lista de documentos que foram usados para os testes: No primeiro passo deverá identificar o ID do projecto (indicado por email pela ESPAP) bem como o NIF associado ao projeto). Devem depois anexar imagens dos e-mails recebidos onde solicitado no formulário acima (apenas a fatura e a nota de crédito são obrigatórios) No final, devem consentir e submeter o formulário:  Será depois enviado um email de confirmação:  ","version":"Next","tagName":"h3"},{"title":"4. Formalização da adesão​","type":1,"pageTitle":"Onboarding FEAP","url":"/onboarding-feap#4-formalização-da-adesão","content":" Após confirmação da passagem a produção, é recebido um e-mail da eSPap a pedir para finalizar o processo através do seguinte link, onde devem preencher os dados necessários e anexar a documentação requisitada pelo representante legal da empresa:  https://www.feap.gov.pt/Paginas/PedidoAdesao.aspx  Isto conclui a passagem a produção no FE-AP. Após validação da eSPap, o processo fica concluído e entrará em produção na data indicada do email. Caso sejam detectadas falhas, a equipa do ilink irá entrar em contacto.  ","version":"Next","tagName":"h3"},{"title":"Mais informação​","type":1,"pageTitle":"Onboarding FEAP","url":"/onboarding-feap#mais-informação","content":" Perguntas Frequentes da eSPap  Lista de todos os fornecedores atualmente inscritos no FE-AP ","version":"Next","tagName":"h2"},{"title":"Integração via AS2","type":0,"sectionRef":"#","url":"/integracao-as2","content":"","keywords":"","version":"Next"},{"title":"Âmbito​","type":1,"pageTitle":"Integração via AS2","url":"/integracao-as2#âmbito","content":" A comunicação via AS2 é destinada principalmente a brokers EDI, e facilita a comunicação em tempo real de documentos e mensagens de estado. Para iniciar esta interligação, deverá pedir as nossas credenciais AS2 à equipa de apoio.  ","version":"Next","tagName":"h2"},{"title":"Detalhes técnicos​","type":1,"pageTitle":"Integração via AS2","url":"/integracao-as2#detalhes-técnicos","content":" Assinatura MDN ativaAlgoritmo de encriptação 3DESAlgoritmo de assinatura SHA1MDN asíncronoFormatos suportados: CIUS-PT, CEF Telecom  ","version":"Next","tagName":"h2"},{"title":"Fase de testes​","type":1,"pageTitle":"Integração via AS2","url":"/integracao-as2#fase-de-testes","content":" Após configuração de credenciais e certificados, normalmente é feito um teste simples de ligação entre os parceiros com um ficheiro de texto.  Após essa fase, procede-se ao envio de documentos reais no ambiente de testes, passando a produção após a validação dos documentos e mensagens de estado. Caso o broker já esteja integrado com diversos clientes, cada novo cliente pode passar a produção de imediato após o pedido de ligação.  ","version":"Next","tagName":"h2"},{"title":"Formatos e estados​","type":1,"pageTitle":"Integração via AS2","url":"/integracao-as2#formatos-e-estados","content":" Todos os documentos recebidos pelo ilink são sujeitos à validação CIUS-PT. Ver validador online.  Nota: Para incluir um ficheiro PDF na fatura, este deverá ser inserido em base64 encode dentro do elemento AdditionalDocumentReference &gt; Attachment &gt; EmbeddedDocumentBinaryObject. Ver exemplo.  Nota: Podem consultar vários exemplos, bem como toda a especificação do CIUS-PT aqui.  ","version":"Next","tagName":"h2"},{"title":"Mensagem de estado​","type":1,"pageTitle":"Integração via AS2","url":"/integracao-as2#mensagem-de-estado","content":" As respostas serão enviadas via XML CIUS MessageStatus versão 2.1, em que:  O nome do ficheiro enviado pelo ilink segue a estrutura Response_{UUID_MESSAGE_STATUS}O elemento DocumentResponse&gt;DocumentReference&gt;ID inclui o número de documento que se refereO elemento DocumentResponse&gt;DocumentReference&gt;UUID inclui o AdditionalDocumentReference&gt;ID[schemeID=AIM] do documento que se refere. Caso não exista, o elemento não é enviado.  Nota: Caso o documento recebido não consiga ser interpretado (ficheiro corrupto, XML inválido), o ilink irá enviar uma mensagem .txt de volta ao emissor com o título igual ao AS2_MESSAGE_ID do documento a que se refere a indicar que o ficheiro recebido não foi lido.  Nota: Caso falhe o envio do MessageStatus, o ilink irá tentar novamente no final do dia, e assim sucessivamente até o ficheiro ser recebido pelo destinatário.  Abaixo pode consultar um exemplo de um ficheiro de estados:  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;ubl:DocumentStatus xmlns:cac=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&quot; xmlns:cbc=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2&quot; xmlns:ubl=&quot;urn:oasis:names:specification:ubl:schema:xsd:DocumentStatus-2&quot;&gt; &lt;cbc:CustomizationID&gt;urn:feap.gov.pt:MSGSTS_CIUS-PT:2.1&lt;/cbc:CustomizationID&gt; &lt;cbc:ID&gt;Response_f02866d2-feeb-4f96-9320-d00507c0018a_6e098568-dfde-4835-87e9-28f6ca1b139d&lt;/cbc:ID&gt; &lt;cbc:IssueDate&gt;2021-04-13&lt;/cbc:IssueDate&gt; &lt;cbc:IssueTime&gt;09:06:41.0000000+01:00&lt;/cbc:IssueTime&gt; &lt;cac:SenderParty&gt; &lt;cac:PartyName&gt; &lt;cbc:Name&gt;ENTIDADE PÚBLICA Nº 156&lt;/cbc:Name&gt; &lt;/cac:PartyName&gt; &lt;cac:PostalAddress&gt; &lt;cac:Country&gt; &lt;cbc:IdentificationCode&gt;PT&lt;/cbc:IdentificationCode&gt; &lt;/cac:Country&gt; &lt;/cac:PostalAddress&gt; &lt;cac:PartyTaxScheme&gt; &lt;cbc:CompanyID&gt;PT614054128&lt;/cbc:CompanyID&gt; &lt;cac:TaxScheme&gt; &lt;cbc:ID&gt;VAT&lt;/cbc:ID&gt; &lt;/cac:TaxScheme&gt; &lt;/cac:PartyTaxScheme&gt; &lt;cac:PartyLegalEntity&gt; &lt;cbc:RegistrationName&gt;ENTIDADE PÚBLICA Nº 156&lt;/cbc:RegistrationName&gt; &lt;/cac:PartyLegalEntity&gt; &lt;/cac:SenderParty&gt; &lt;cac:ReceiverParty&gt; &lt;cac:PartyName&gt; &lt;cbc:Name&gt;Serviços de Consultoria, Lda.&lt;/cbc:Name&gt; &lt;/cac:PartyName&gt; &lt;cac:PostalAddress&gt; &lt;cac:Country&gt; &lt;cbc:IdentificationCode&gt;PT&lt;/cbc:IdentificationCode&gt; &lt;/cac:Country&gt; &lt;/cac:PostalAddress&gt; &lt;cac:PartyTaxScheme&gt; &lt;cbc:CompanyID&gt;PT547570692&lt;/cbc:CompanyID&gt; &lt;cac:TaxScheme&gt; &lt;cbc:ID&gt;VAT&lt;/cbc:ID&gt; &lt;/cac:TaxScheme&gt; &lt;/cac:PartyTaxScheme&gt; &lt;cac:PartyLegalEntity&gt; &lt;cbc:RegistrationName&gt;Serviços de Consultoria, Lda.&lt;/cbc:RegistrationName&gt; &lt;/cac:PartyLegalEntity&gt; &lt;/cac:ReceiverParty&gt; &lt;cac:DocumentResponse&gt; &lt;cac:Response&gt; &lt;cbc:ResponseCode&gt;11&lt;/cbc:ResponseCode&gt; &lt;/cac:Response&gt; &lt;cac:DocumentReference&gt; &lt;cbc:ID&gt;ZM 02/7000009232102&lt;/cbc:ID&gt; &lt;cbc:UUID&gt;f02866d2-feeb-4f96-9320-d00507c0018a&lt;/cbc:UUID&gt; &lt;cbc:IssueDate&gt;2021-03-10&lt;/cbc:IssueDate&gt; &lt;cbc:DocumentTypeCode&gt;380&lt;/cbc:DocumentTypeCode&gt; &lt;/cac:DocumentReference&gt; &lt;/cac:DocumentResponse&gt; &lt;/ubl:DocumentStatus&gt;   ","version":"Next","tagName":"h3"},{"title":"Lista de estados​","type":1,"pageTitle":"Integração via AS2","url":"/integracao-as2#lista-de-estados","content":" Os MessageStatus do ilink incluem os estados EDI definidos pela eSPap no elemento DocumentResponse&gt;Response&gt;ResponseCode:  ACCEPTED - documento passou pela validação de XML e regras de qualidade, e foi integrado no sistema, e foi enviado ao receptorERROR - documento não passou pela validação inicial de qualidade (XML com erros, não cumpre os campos obrigatórios especificados pelo receptor, etc)14 - documento foi recusado pelo receptor e aguarda regularização (deve ser retificado e reenviado, ou alternativamente submetida uma nota de crédito/débito)22 - documento foi devolvido pelo receptor e deverá ser anulado. Deve ser emitido novo documento33 - documento foi colocado a pagamento29 - documento pago11 - documento processado pelo receptor (documento foi aceite)30 - nota de crédito aceite pelo receptor  Nota: Os estados ERROR, 14 e 22 incluem a descrição do erro em DocumentResponse&gt;Response&gt;Description. Nota: Embora os estados 33 e 29 não sejam enviados pelo ilink, estes podem ser recebidos e interpretados correctamente pelo nosso sistema.  ","version":"Next","tagName":"h3"},{"title":"Fluxo de estados EDI​","type":1,"pageTitle":"Integração via AS2","url":"/integracao-as2#fluxo-de-estados-edi","content":" Tendo em conta os estados descritos acima, estes são os diversos fluxos que um documento pode seguir:  Descrição\tProcessoO documento chegou ao ilink e não passou a validação das regras semânticas do XML ou controlo de qualidade (erro CIUS-PT, campos obrigatórios em falta, ligação não existente).\tERROR O documento chegou ao ilink e passou na validação XML, e foi enviado ao receptor.\tACCEPTED O documento chegou ao ilink, validou correctamente e chegou ao destinatário, mas o destinatário não integrou o mesmo no seu sistema e pediu um documento de regularização (emissão de NC ou re-envio do documento retificado).\tACCEPTED &gt; 14 O documento chegou ao ilink, validou correctamente e chegou ao destinatário, mas o destinatário devolveu o mesmo e obriga à emissão de um novo documento.\tACCEPTED &gt; 22 O documento chegou ao ilink, validou correctamente e chegou ao destinatário, foi integrado no sistema contabilístico.\tACCEPTED &gt; 11 A Nota de Crédito chegou ao ilink, validou correctamente e chegou ao destinatário, e o destinatário integrou o mesmo no seu sistema contabilístico, para depois proceder ao ajuste de caixa.\tACCEPTED &gt; 30  ","version":"Next","tagName":"h3"},{"title":"Reenvio de documentos​","type":1,"pageTitle":"Integração via AS2","url":"/integracao-as2#reenvio-de-documentos","content":" É possível reenviar um documento após retificação do mesmo. Um documento apenas pode ser reenviado se o seu último estado for:  ERROR (Erro de validação ou ligação)14 (Regularização por parte do cliente)  Para os restantes estados, não é possível reenviar um documento e este será rejeitado pelo sistema.  ","version":"Next","tagName":"h3"},{"title":"Assinatura digital​","type":1,"pageTitle":"Integração via AS2","url":"/integracao-as2#assinatura-digital","content":" O protocolo AS2 requer o uso de uma assinatura especifica a aplicar ao nível do protocolo de transporte, recorrendo-se para tal a S/MIME e usando certificados X.509. A autenticação é feita através da comparação das chaves públicas e privadas tanto do emissor como do recetor.  A assinatura ao nível do documento é obrigatória para comunicações via web services, sendo que passa a facultativa no caso de comunicações via AS2, dado que, no caso deste último canal, a assinatura já é usada ao nível do S/MIME.  Fonte: Guia de Transmissão de documentos eletrónicos FE-AP, ESPAP-IP  É também verificada a validade da assinatura de todos os documentos recebidos pelo ilink. O seguinte validador pode ser utilizado para verificar a validade da assinatura dos documentos. Os formatos de assinatura reconhecidos pelo ilink são PADES (PDF), ou XMLDSig e XADES-BES enveloped (XML).  ","version":"Next","tagName":"h2"},{"title":"Pedidos de ligação​","type":1,"pageTitle":"Integração via AS2","url":"/integracao-as2#pedidos-de-ligação","content":" Deve ser enviado um pedido de ligação à equipa do ilink usando o portal de ligações quando um cliente do broker externo se pretende ligar a um cliente do ilink, e vice-versa. Este processo é feito por cada par de clientes a ligar.  Quando a equipa do ilink configura um pedido de ligação de outro broker, irá ser indicado na nossa resposta as validações adicionais que o nosso cliente exige nos ficheiros recebidos (e.g PDF anexado, número de compromisso associado, etc), caso existam.  ","version":"Next","tagName":"h2"},{"title":"Alterações de certificados​","type":1,"pageTitle":"Integração via AS2","url":"/integracao-as2#alterações-de-certificados","content":" Por norma, os nossos certificados usados na comunicação AS2 têm a validade de 3 anos. As alterações de certificados são informadas aos nossos parceiros com 1 mês de antecedência. ","version":"Next","tagName":"h2"},{"title":"Integração via API REST","type":0,"sectionRef":"#","url":"/integracao-api-rest","content":"","keywords":"","version":"Next"},{"title":"1. Âmbito​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#1-âmbito","content":" O API REST do ilink permite um controlo programático das principais operações de documentos presentes no ilink, facilitando a integração com programas externos.  O ilink distingue 2 fluxos principais de integração: receção e emissão de documentos, com respetivo reporte de estados, dos quais poderão ser implementados ambos ou apenas um, dependendo das necessidades do software a integrar.  ","version":"Next","tagName":"h2"},{"title":"2. Notas Técnicas​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#2-notas-técnicas","content":" O webservice segue a estrutura RESTOs HTTP status codes devolvidos respeitam o RFC 7231Todos os dados enviados (incluindo anexos XML) deverão ser representados em UTF-8. Formatos como ANSI, UTF-8 BOM e ISO 8859-1 devem ser evitados de modo a garantir compatibilidade com todos os sistemas recetoresAs respostas (payloads) são devolvidas em formato JSONOs servidores do ilink funcionam exclusivamente por HTTPS, com versão TLS 1.2 (em caso de problemas com a comunicação, ver possíveis resoluções para Java e C#)A especificação e cliente de demonstração swagger está disponível aquiExistem 2 ambientes distintos, com URLs base diferentes: Testes/pré-produção: https://ilink.acin.pt/ilinktests-api/api/v1/ptProdução: https://ilink.pt/ilink-api/api/v1/pt  Nota: Os documentos emitidos e recebidos via API podem ser consultados no portal de testes do ilink usando as credenciais que vos foram enviadas.  ","version":"Next","tagName":"h2"},{"title":"3. Pré requisitos​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#3-pré-requisitos","content":" De modo a integrar via API, será necessário primeiro entrar em contacto com a nossa equipa (apoio@ilink.pt) de modo a pedir acessos ao nosso ambiente de testes/qualidade.  Os acessos disponibilizados serão os seguintes:  Um token de plataforma, que identifica o sistema/plataforma a aceder ao webserviceUma chave pública, que identifica o cliente/NIF que pretende aceder ao webservice  Isto significa que cada cliente que permite emitir ou receber documentos necessita de um pré-registo com a nossa equipa, de modo a ser gerada a sua chave pública. O token de plataforma será único para o sistema a integrar (comum a todos os clientes que utilizam o vosso sistema), e deverá ser usado em todas as chamadas ao API.  Nos acessos de teste, também são disponibilizados 2 clientes/NIFs, juntamente com os seus logins de acesso ao portal do ilink. Deverão usar estas entidades para transacionar documentos entre si, e opcionalmente aceder ao portal para consulta dos mesmos. Os NIFs atribuídos podem ser alterados se necessário.  Nota: Serão enviados novos acessos (token de plataforma e chave pública por NIF) mediante entrada em produção.  ","version":"Next","tagName":"h2"},{"title":"4. Especificação técnica​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#4-especificação-técnica","content":" Aceder à especificação swagger  O ilink utiliza uma especificação OpenApi 3, e está disponível aqui. Neste cliente web, poderá efetuar chamadas de teste ao nosso API, analisar as respostas obtidas bem como os dados a enviar para cada endpoint/método.  O cliente swagger disponibilizado acima deverá acompanhar o vosso processo de desenvolvimento. É também possível verificar como as chamadas ao API são construídas via cURL (ver exemplo abaixo):    Nota: São também disponibilizados vários clientes HTTP, em mais de 50 linguagens e frameworks, gerados automaticamente a partir da nossa especificação, que poderão servir de suporte inicial ao processo de integração.  ","version":"Next","tagName":"h2"},{"title":"4.1 Autorização​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#41-autorização","content":" Todos os pedidos a efetuar ao API têm de conter obrigatoriamente o header de autorização abaixo:  Authorization: Bearer {TOKEN_PLATAFORMA}  No cliente Swagger, o processo de autorização é feito inserindo o token de plataforma após clicar no botão Authorize.    Após esta operação, deverão notar que todos os pedidos subsequentes ao API incluem o header Authorization:    ","version":"Next","tagName":"h3"},{"title":"4.2 Autenticação​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#42-autenticação","content":" Antes de efetuar a primeira consulta ao API do ilink, é obrigatório efetuar uma autenticação por cliente/NIF. Esta autenticação serve de handshake inicial entre o cliente e o ilink é feita com recurso ao endpoint POST /apps/authentications:    Uma autenticação válida deverá retornar esta resposta:  HTTP status: 200 OK { &quot;success&quot;: true, &quot;message&quot;: { &quot;code&quot;:&quot;e123&quot;, &quot;msg&quot;:&quot;Integração realizada com sucesso.&quot; } }   A autenticação tem duração ilimitada (só precisa de ser invocada 1 vez por cliente/NIF que acede ao API). Pode também ser revogada através do método DELETE /apps/authentications:    Se o processo de autenticação não for concluído, ou o header Authorization não for enviado nos pedidos ao API, todas as chamadas serão recusadas para esse NIF com um erro:  HTTP status: 401 Unauthorized { &quot;success&quot;: false, &quot;errors&quot;: [ { &quot;code&quot;: &quot;e069&quot;, &quot;msg&quot;: &quot;Autenticação inválida&quot; } ] }   Nota: Em ambiente de produção é necessário autenticar novamente cada cliente/NIF.  ","version":"Next","tagName":"h3"},{"title":"5. Emissão de documentos​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#5-emissão-de-documentos","content":" ","version":"Next","tagName":"h2"},{"title":"5.1 Âmbito​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#51-âmbito","content":" Permite à plataforma integradora emitir documentos no ilink, que são posteriormente enviados para o seu destinatário. O destinatário dos documentos tem configurado no portal do ilink para que sistemas externos os documentos devem ser remetidos. Isto significa que o processo de envio de documentos aos ERPs e EDIs adequados de cada cliente é transparente ao API e fica à responsabilidade do ilink. Estas configurações são efetuadas pela equipa de apoio do ilink antes da passagem a produção.  A plataforma ilink permite o envio de faturas eletrónicas em 2 cenários distintos:  Envio de PDF assinado via e-mail para consumidores finais ou empresas privadas Neste cenário, não será necessário criar ligações entre outros EDIs para o envio de documentos. Basta indicar ao endpoint de criação de documento o(s) endereço(s) de e-mail a remeter o mesmo. Para mais informações, consulte a secção Métodos de envio. Envio de XML CIUS-PT para entidades públicas (obrigatório nos contratos públicos) Neste cenário, será necessário configurar previamente as ligações entre NIFs e possivelmente entre outros brokers EDI externos.  Como são enviados os documentos para outros brokers EDI?Na fase de passagem a produção, deverá ser feito um levantamento de todas as entidades que irão receber documentos via EDI, bem como os seus brokers EDI em uso. De seguida, a equipa de apoio (apoio@ilink.pt) irá configurar as ligações necessárias de modo a que os documentos sejam integrados automaticamente no sistema de cada recetor. Antes de enviar documentos para a solução FE-AP da eSPap, será também necessário cada emissor de faturas completar o processo de adesão de fornecedores FE-AP.  Todos os documentos emitidos ficam disponíveis no portal do ilink tanto na entidade emissora como na entidade recetora dos mesmos.  Nota: No nosso ambiente de testes, devem emitir documentos apenas entre as 2 entidades que receberam acessos. Caso pretendam verificar o funcionamento do envio de documentos para um consumidor final (NIF arbitrário), deverão sempre emitir o mesmo por uma das entidades que receberam acessos.  IMPORTANTE: Para o envio de documentos a entidades públicas, recomendamos fortemente implementar os seguintes campos, sob pena de não integrar os documentos com certos sistemas:  Envio do número de compromissoEnvio do ficheiro PDF original da faturaEnvio do número de encomenda ou requisição (se aplicável)Envio do Capital Social do fornecedorEnvio do endereço de e-mail do cliente (apenas para as secretarias do Governo Regional da Madeira)Envio de todos os dados da morada do fornecedor (rua, código-postal, cidade, etc.)Envio do GLN do cliente (se aplicável)Possibilidade de reenvio do documento mediante o estado obtido (útil para corrigir e reenviar um documento previamente rejeitado)  ","version":"Next","tagName":"h3"},{"title":"5.2 Assinatura digital​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#52-assinatura-digital","content":" O ilink permite assinar automaticamente os anexos dos documentos emitidos na plataforma (XML e PDF), desde que a entidade emissora tenha adquirido e configurado o selo de um dos provedores de assinaturas digitais qualificadas. Neste momento, apenas o GTS - Global Trusted Sign é suportado, mas existem planos de suportar os restantes provedores em Portugal (Multicert e DigitalSign).  Isto significa que o ERP não é obrigado a integrar com um provedor de assinaturas, deixando (opcionalmente) o processo de certificação à responsabilidade do ilink. A outra alternativa será o próprio ERP efetuar o processo de certificação e enviar os documentos previamente assinados para o ilink.  Nota: No cenário de assinatura via ilink, por defeito, todos os ficheiros resultantes serão assinados no momento de entrada (xml e pdf), e só depois remetidos ao cliente. Este processo é configurado no portal web, ficando fora da responsabilidade do API.  No caso de assinatura via ERP, a assinatura digital do documento será validada a nível criptográfico para todos os documentos que entram no sistema, e um documento com assinatura inválida, tanto no XML como no PDF não irá integrar e retorna sempre um erro via API como o seguinte:  HTTP status: 400 Bad request { &quot;success&quot;: false, &quot;errors&quot;: { &quot;document&quot;: { &quot;code&quot;: &quot;e217&quot;, &quot;msg&quot;: &quot;A assinatura do documento não é válida.&quot; } } }   O erro anterior indica que o documento sofreu alterações desde o momento que foi assinado, ou que a assinatura do mesmo foi gerada incorretamente. O seguinte validador pode ser utilizado para verificar a validade da assinatura dos documentos. Os formatos de assinatura reconhecidos pelo ilink são PADES e PKCS7-B (PDF), ou XMLDSig e XADES-BES (XML).  Nota: Os requisitos legais de assinatura das faturas eletrónicas estão disponíveis no Decreto-Lei 28/2019, secção II, artigo 12º.  Nota: O ilink assina os documentos PDF em PADES e os documentos XML em XADES-BES enveloped.  ","version":"Next","tagName":"h3"},{"title":"5.3 Métodos de envio​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#53-métodos-de-envio","content":" Após efetuada a autenticação com sucesso, estamos em condições de começar a enviar documentos. O API do ilink possibilita 2 métodos de envio de documentos:  a) Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)​  Neste método, o sistema a integrar tem de gerar corretamente o ficheiro XML antes de enviar o mesmo ao ilink. Todos os ficheiros XML enviados por este método são verificados de acordo com o validador oficial da eSPap, versão 2.1.2, e o API irá retornar um erro caso se verifiquem inconsistências sintáticas. A eSPap disponibiliza um validador Schematron que implementa todas as validações da Norma Europeia EN16931 CIUS e as validações adicionais do CIUS-PT, e está disponível online neste link. Se os ficheiros validam sintaticamente no validador online, então deverão validar no ilink, com a exceção de validações adicionais colocadas pelo destinatário do documento.  Nota: Para incluir um ficheiro PDF na fatura eletrónica e consultar outros casos de uso, consultar a secção casos de uso.  Nota: Podem consultar vários exemplos do CIUS-PT, bem como toda a especificação do CIUS-PT aqui.  Alguns exemplos de erros no processo de validação XML:  HTTP status: 400 Bad request { &quot;success&quot;: false, &quot;errors&quot;: { &quot;document&quot;: { &quot;code&quot;: &quot;e217&quot;, &quot;msg&quot;: &quot;[BR-CO-25]-Caso o valor a pagar (BT-115) seja positivo, deve indicar a data de vencimento (BT-9) ou a nota da condição de pagamento (BT-20).&quot; } } }   HTTP status: 400 Bad request { &quot;success&quot;: false, &quot;errors&quot;: { &quot;document&quot;: { &quot;code&quot;: &quot;e217&quot;, &quot;msg&quot;: &quot;[DT-CIUS-PT-166]-Amount due for payment (BT-115) = Invoice total amount with VAT (BT-112) -Paid amount (BT-113) +Rounding amount (BT-114), with an acceptance range of 1.00 € (it does not mean that this tolerance is accepted by the customer).&quot; } } }   O método a utilizar para envio do XML é o POST /apps/documentsUBL. Neste contexto, a chave pública identifica o emissor do documento e tem de ser a chave associada ao NIF do emissor do documento especificado no XML (AccountingSupplierParty&gt;Party&gt;PartyTaxScheme&gt;CompanyID para faturas/notas de crédito, ou AccountingCustomerParty&gt;Party&gt;PartyTaxScheme&gt;CompanyID para encomendas). Caso isto não se verifique, o API irá retornar o seguinte erro:  HTTP status: 400 Bad request { &quot;success&quot;: false, &quot;errors&quot;: { &quot;supplier&quot;: { &quot;code&quot;: &quot;e199&quot;, &quot;msg&quot;: &quot;A entidade criadora do documento deve ser cliente ou fornecedor do novo documento.&quot; } } }   Se o XML for válido e respeitar todas as validações da norma, bem como todas as regras de negócio adicionais do recetor, o API devolve uma resposta de sucesso, juntamente com os dados principais do documento criado:  HTTP status: 201 Created { &quot;success&quot;: true, &quot;message&quot;: { &quot;code&quot;: &quot;s011&quot;, &quot;msg&quot;: &quot;Documento criado com sucesso&quot; }, &quot;response&quot;: { &quot;data&quot;: { &quot;id&quot;: &quot;60796c3c2a6fa2.53909016&quot;, &quot;number&quot;: &quot;7411111&quot;, &quot;emission_date&quot;: &quot;2021-04-15&quot;, &quot;type_document_fact&quot;: { &quot;id&quot;: &quot;5c9cb870a5ef57.36583702&quot;, &quot;code&quot;: &quot;380&quot;, &quot;alias&quot;: &quot;invoice&quot;, &quot;type&quot;: &quot;FT&quot;, &quot;description&quot;: &quot;Fatura&quot; }, &quot;type_document&quot;: { &quot;alias&quot;: &quot;issued&quot;, &quot;description&quot;: &quot;Emitido&quot; }, &quot;state_document&quot;: { &quot;id&quot;: &quot;5c9cb878745b16.4225687&quot;, &quot;alias&quot;: &quot;sent&quot;, &quot;description&quot;: &quot;Enviado ao cliente.&quot; } } } }   Nota: Um documento é enviado com sucesso ao destinatário via EDI quando o campo state_document.alias tem o valor sent ou accepted. Caso se apenas pretenda que o documento seja enviado via e-mail, o estado do documento deve ser ignorado, e devemos alternativamente consultar os e-mails enviados através da consulta de estado do mesmo.  b) Envio dos dados estruturados do documento​  Ao adotar esta opção, o ERP dispensa de efetuar a geração completa do XML, ficando assim o ilink responsável por gerar o XML final. Assim, o ERP apenas necessita de enviar ao ilink todos os dados referentes ao documento. O endpoint a adotar aqui será o POST /apps/documents    A especificação deste método é extensa, pois cobre todos os campos possíveis de uma fatura/encomenda, que estão devidamente documentados acima. Todos os documentos criados por este endpoint estão sujeitos às mesmas validações que os documentos enviados pelo método POST /apps/documentsUBL, ou seja, o XML resultante dos dados inseridos será validado de acordo com o validador oficial da eSPap, que pode ser consultado online neste link, e segundo as regras de negócio adicionais do recetor do documento, caso existam.  Nota: Para incluir um ficheiro PDF e outras situações habituais, consultar a secção casos de uso.  Nota: É possível enviar vários anexos num documento através do campo files[] (ver especificação acima). Contudo, a representação visual do documento (i.e PDF original da fatura usado na impressão) deve ser enviado sempre no campo file, sendo o campo files[] reservado para ficheiros adicionais (notas de encomenda, avisos de despacho, guias de transporte, etc.). Se o emissor do documento tem uma assinatura digital ativa no ilink, todos os anexos serão assinados por defeito.  ","version":"Next","tagName":"h3"},{"title":"5.4 Envio do documento​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#54-envio-do-documento","content":" 5.4.1 Envio via EDI​  Um documento, após criação com sucesso por qualquer um dos métodos acima (envio de XML ou envio de dados), será enviado automaticamente ao destinatário por EDI. Contudo, em casos pontuais, este poderá não ser entregue imediatamente ao destinatário via EDI devido a configurações em falta e/ou outras anomalias na plataforma ilink ou no sistema do recetor. Caso isto se verifique, será devolvido um campo to_send_status na resposta do documento a detalhar a situação:  HTTP status: 201 OK { &quot;success&quot;: true, &quot;message&quot;: { &quot;code&quot;: &quot;s011&quot;, &quot;msg&quot;: &quot;Documento criado com sucesso&quot; }, &quot;response&quot;: { &quot;data&quot;: { &quot;id&quot;:&quot;60796c3c2a6fa2.53909016&quot;, &quot;state_document&quot;: { &quot;id&quot;: &quot;5c9cb870f34b16.42025494&quot;, &quot;alias&quot;: &quot;tosend&quot;, &quot;description&quot;: &quot;Por enviar ao cliente.&quot; }, &quot;to_send_status&quot;: { &quot;code&quot;: &quot;sent_connection&quot;, &quot;title&quot;: &quot;Aguardar a aceitação de ligação com o destinatário do documento.&quot; } } } }   Nota: Pode-se verificar que o documento NÃO foi entregue via EDI pois o campo state_document.alias assume o valor tosend e o motivo de erro encontra-se descrito no campo to_send_status. Nesta situação, é necessário primeiro concluir a ligação EDI com o destinatário e depois proceder ao reenvio.  Os motivos possíveis (code) para um documento não ser entregue são:  sent_connection, no_connection: Ligação com o destinatário em faltaregistered_entity: O destinatário não está registado no ilinkreceived_pay_transactions: O destinatário suporta os custos dos documentos recebidos mas não dispõe de transações suficientes para o envio do documento  Após regularizar a situação de erro, será possível enviar o documento novamente (ver secção de [reenvio de documentos]#56-criareditar-documento).  Nota: O estado do documento (state_document) é apenas aplicável a envios EDI. Caso o documento seja enviado para um cliente arbitrário via e-mail (PDF), o estado de envio não reflete o envio do e-mail (ver secção seguinte).  5.4.2 Envio via e-mail​  Um documento, após criação com sucesso (HTTP status 201) por qualquer um dos métodos acima (envio de XML ou envio de dados), será remetido via e-mail ao destinatário caso seja especificado o campo send_by_email com o valor 1. O(s) endereço(s) do(s) recetor(es) do documento pode(m) ser especificado(s) de 3 modos:  no campo additional_emails[] (em ambos os métodos de envio)no campo customer[email] (apenas no método de envio de dados)no elemento cac:AccountingCustomerParty/cac:Party/cac:Contact/cbc:ElectronicMail do XML (apenas no método de envio de XML).  Para consultar o envio dos e-mails e leitura dos mesmos para o cliente, ver secção b) de consulta de estado de documentos emitidos.  5.4.3 Criação de documentos e consumo de assinaturas digitais qualificadas​  Esta secção é apenas relevante para clientes que utilizam o ilink para assinar digitalmente os documentos. Ver detalhes.  Caso esteja configurada uma assinatura digital qualificada no ilink, todos os documentos serão assinados no momento da sua criação, incluindo todos os ficheiros resultantes da fatura eletrónica (xml e pdf). Dado que a assinatura dos documentos não é obrigatória por lei em todos os cenários de utilização, é possível controlar individualmente a assinatura dos ficheiros xml e pdf no momento da criação do documento com recurso aos os campos disable_xml_sign e disable_pdf_sign, disponíveis em ambos os métodos de criação de documento (XML ou dados). Isto permite reduzir o consumo de assinaturas, bem como otimizar o processo de criação de documentos.  Ou seja:  No envio de fatura digital via PDF assinado para um consumidor final ou cliente privado, não será obrigatório assinar o ficheiro XML resultante, pelo que recomendamos a utilização do campo disable_xml_sign: 1.No envio de fatura eletrónica para a Administração Pública via EDI (exemplo eSPap), não é obrigatório assinar o documento, no entanto recomenda-se a assinatura de ambos os ficheiros por motivos de segurança adicional e integridade.Os campos acima apenas têm efeito quando o emissor do documento usa uma assinatura digital qualificada no ilink.  ","version":"Next","tagName":"h3"},{"title":"5.5 Validações adicionais​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#55-validações-adicionais","content":" O recetor da fatura pode configurar no ilink requisitos adicionais para determinados campos (regras de negócio), mesmo quando estes não são obrigatórios na especificação CIUS-PT. Por exemplo, um cliente pode definir que apenas aceita faturas com o ficheiro PDF em anexo ou com o número de compromisso especificado. É fundamental que estes requisitos sejam acordados previamente com o cliente/destinatário antes da entrada em produção, de forma a evitar erros de integração.  Caso o recetor do documento obrigue a presença de algum campo não especificado no XML, o API irá retornar um erro como abaixo e o documento não será gerado:  HTTP status: 400 Bad request { &quot;success&quot;: false, &quot;errors&quot;: { &quot;commitment_number&quot;: { &quot;code&quot;: &quot;e048&quot;, &quot;msg&quot;: &quot;O número de compromisso é obrigatório.&quot; } } }   ","version":"Next","tagName":"h3"},{"title":"5.6 Criar/editar documento​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#56-criareditar-documento","content":" Um documento pode ser editado e reenviado ao destinatário  se ainda não foi enviado ao cliente finalou se já foi enviado ao cliente e o cliente pediu uma regularização do mesmo  Em termos práticos, a possibilidade de reenvio pode ser consultada através do campo de resposta seguinte do documento:  &quot;state_edi_document&quot;: { &quot;alias&quot;: &lt;estado&gt; // estados possíveis de reenvio: 'regularization' ou 'reception' ou 'error' }   Para consultar o estado de um documento, ver secção de consulta de estado de documentos emitidos.  Para editar um documento existente, basta repetir o pedido POST /apps/documentsUBL ou POST /apps/documents com os dados corrigidos, mantendo o número, tipo e data de emissão do documento anterior:  HTTP status: 200 OK { &quot;success&quot;: true, &quot;message&quot;: { &quot;code&quot;: &quot;s012&quot;, &quot;msg&quot;: &quot;Documento editado com sucesso&quot; }, &quot;response&quot;: { &quot;data&quot;: { &quot;id&quot;: &quot;60796c3c2a6fa2.53909016&quot;, &quot;number&quot;: &quot;7411111&quot;, &quot;emission_date&quot;: &quot;2021-04-16&quot;, &quot;type_document_fact&quot;: { &quot;id&quot;: &quot;5c9cb870a5ef57.36583702&quot;, &quot;code&quot;: &quot;380&quot;, &quot;alias&quot;: &quot;invoice&quot;, &quot;type&quot;: &quot;FT&quot;, &quot;description&quot;: &quot;Fatura&quot; }, &quot;type_document&quot;: { &quot;alias&quot;: &quot;issued&quot;, &quot;description&quot;: &quot;Emitido&quot; }, &quot;state_document&quot;: { &quot;id&quot;: &quot;5c9cb870f34b16.42025494&quot;, &quot;alias&quot;: &quot;tosend&quot;, &quot;description&quot;: &quot;Por enviar ao cliente.&quot; } } } }   Caso o documento não seja elegível para edição (i.e já foi enviado ou foi aceite pelo cliente final), será apresentado um erro ao tentar reenviar:  HTTP status: 400 Bad request { &quot;success&quot;: false, &quot;errors&quot;: { &quot;number&quot;: { &quot;code&quot;: &quot;e200&quot;, &quot;msg&quot;: &quot;Documento já existe.&quot; } } }   ","version":"Next","tagName":"h3"},{"title":"5.7 Acesso a documentos emitidos​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#57-acesso-a-documentos-emitidos","content":" Quando um documento é registado com sucesso, será sempre devolvido um id nas respostas, que identifica o mesmo perante o ilink. É útil guardar este identificador para consultas futuras ao documento.  HTTP status: 201 Created { &quot;success&quot;: true, &quot;message&quot;: { &quot;code&quot;: &quot;s011&quot;, &quot;msg&quot;: &quot;Documento criado com sucesso&quot; }, &quot;response&quot;: { &quot;data&quot;: { &quot;id&quot;: &quot;60796c3c2a6fa2.53909016&quot; } } }   O API permite também aceder a todos os dados (inclusive ao XML e PDF gerados) de todos os documentos previamente emitidos. Para tal, deverão usar o método GET /apps/documents/{id}. O id recebido na criação do documento deve ser usado como parâmetro aqui para aceder ao documento em questão.  Todos os dados retornados por este método estão disponíveis na especificação acima.  Nota: Caso a entidade emissora do documento tenha configurado a assinatura automática de documentos no ilink, os URLs de acesso ao XML e ao PDF já retornam os ficheiros assinados.  ","version":"Next","tagName":"h3"},{"title":"5.8 Consulta de documentos emitidos no portal (opcional)​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#58-consulta-de-documentos-emitidos-no-portal-opcional","content":" Os documentos podem também ser consultados no portal de testes do ilink usando as credenciais das entidades que vos foram enviadas. Aqui podem validar visualmente se a informação apresentada está coerente com os dados enviados via API:    Para aceder aos anexos de um documento, deverão aceder ao documento da tabela acima, e aceder ao ícone da lupa:    Nota: Os documentos deverão estar presentes tanto na entidade emissora (secção de documentos emitidos), bem como na entidade recetora (secção de documentos recebidos).  ","version":"Next","tagName":"h3"},{"title":"5.9 Consulta de estado de documentos emitidos​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#59-consulta-de-estado-de-documentos-emitidos","content":" É também possível aceder ao estado atual dos documentos previamente emitidos. Esta operação permite ao emissor do documento consultar se o documento foi aceite pelo cliente, ou se está pendente de reenvio/regularização, bem como os motivos que levaram a tal.  5.9.1 Consulta de estado de documento enviado via EDI​  O ilink contempla 4 estados simplificados de documento na propriedade state_document:  Por enviar (tosend) - o documento não foi enviado ao cliente. Provavelmente significa que falta alguma configuração no ilink, emissor/recetor não autorizam ligação entre eles, ou que alguma das entidades presentes no documento não tem transações suficientes para proceder ao envio.Enviado (sent) - o documento foi enviado ao cliente e está pendente de aceitação.Aceite (accepted) - o documento foi enviado e o cliente aceitou o mesmo. Estado final.Recusado (rejected) - o documento foi enviado e o cliente rejeitou o mesmo devido a uma incoerência. O motivo de recusa é disponibilizado na resposta no campo reasons. O documento poderá ser enviado novamente caso seja solicitada uma regularização do mesmo.  Nota: O ilink devolve também o estado de processamento EDI atual do documento (state_edi_document), que é independente dos estados acima. Para mais informação, consultar o Guia de Transmissão de Documentos FE-AP, página 7. Contudo, a leitura do estado EDI nem sempre é relevante para os softwares de faturação.  Existem 3 abordagens para aceder ao estado de um documento previamente emitido: Consulta individual, Webhook de mudança de estado e Reporte de estados.  Na Consulta individual de estado, basta efetuar a chamada GET /apps/documents/{id}. O id recebido na criação do documento deve ser usado como parâmetro para aceder ao documento em questão. O estado é devolvido no campo state_document (ver especificação acima). Este método apenas permite consultar o estado de um documento de cada vez, e como tal não é recomendado para clientes que emitem um volume elevado de documentos. No Webhook de mudança de estado, o ilink tem a iniciativa de informar ao emissor do documento cada vez que o mesmo muda de estado. Esta é a opção recomendada em termos de desempenho e rapidez, mas pode não ser viável caso o sistema a integrar pertença a numa rede não exposta publicamente ao ilink. Para mais informação, consultar a secção Webhooks. No Reporte de estados, a aplicação a integrar tem a iniciativa de consultar os diversos eventos que levaram às alterações de estado dos documentos emitidos. Para tal, basta efetuar a chamada GET /apps/states-report/documents. Cada evento identifica o documento e o estado alterados. É possível filtrar os eventos retornados por id de documento, número de documento, intervalos de datas, entre outros (ver especificação acima). Este método permite a aplicação consultar o estado de vários documentos em simultâneo. De modo a facilitar a utilização do reporte de estados, é adicionalmente disponibilizado o endpoint de leitura de eventos POST /apps/states-report/documents/read, que permite marcar um ou mais ids de evento obtidos acima como lido(s). Os eventos marcados como lidos não são retornados novamente no endpoint de reporte de estados, facilitando a consulta futura. Esta opção é uma alternativa escalável para os sistemas que não podem implementar Webhooks.  5.9.2 Consulta de estado de documento enviado via e-mail​  No cenário de envio de documentos por e-mail, é possível consultar o registo de envio e de leitura dos e-mails enviados ao cliente. Note-se que o estado do documento retornado (state_document) não é aplicável neste cenário, pois o documento por norma não é enviado via EDI, e como tal, o seu estado de envio será habitualmente to_send. Este estado deve ser ignorado a favor das abordagens abaixo.  Existem duas abordagens para aceder ao registo de e-mails enviados de um documento: Consulta individual e Consulta de histórico de documento.  Na Consulta individual, basta efetuar a chamada GET /apps/documents/{id}. O id recebido na criação do documento deve ser usado como parâmetro para aceder ao documento em questão. Na resposta, devem aceder à propriedade emails, que retorna uma lista das mensagens enviadas e o seu estado de receção e leitura. Este método apenas permite consultar o estado de um documento de cada vez e tem as mesmas limitações que a consulta individual de documentos da secção anterior:  HTTP status: 200 OK { &quot;success&quot;: true, &quot;response&quot;: { &quot;data&quot;: { &quot;id&quot;: &quot;60796c3c2a6fa2.53909016&quot;, ... &quot;emails&quot;: [ { &quot;id&quot;: &quot;634672bab0f3b8.40302642&quot;, &quot;b_open&quot;: true, // true caso o email tenha sido lido pelo recetor &quot;b_sent&quot;: true, // true caso o email tenha sido enviado com sucesso &quot;created_at&quot;: &quot;2022-10-12 08:54:34&quot;, // data e hora de envio do email &quot;opened_at&quot;: &quot;2022-10-12 09:14:16&quot;, // data e hora de leitura do email &quot;address&quot;: { &quot;emails&quot;: [&quot;joao.freitas@email.com&quot;], // endereço de envio } } ] } } }   Nota: Certos clientes de e-mail (Outlook, etc.) podem bloquear o registo de leitura dos e-mails, ficando o b_open a false mesmo que o e-mail tenha sido aberto em algumas situações.  Na Consulta de histórico de documento é possível consultar todas as alterações processuais de um determinado documento. Este histórico irá listar todas as alterações de estado que ocorreram no documento por ordem cronológica, bem como os registos dos envios de e-mail para o destinatário, o que permite um rastreio completo de auditoria. Pode ser acedido através de GET /apps/documents/{id}/history.  ","version":"Next","tagName":"h3"},{"title":"6. Receção de documentos​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#6-receção-de-documentos","content":" ","version":"Next","tagName":"h2"},{"title":"6.1 Âmbito​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#61-âmbito","content":" Esta funcionalidade permite dar entrada automática aos documentos de faturação no sistema ERP do recetor, facilitando a integração direta nos sistemas contabilísticos. Adicionalmente, possibilita a comunicação dos estados de aceitação dos documentos ao respetivo emissor (pago, aceite, recusado, entre outros).  Neste fluxo de integração, recomendamos que sejam implementados os seguintes aspetos:  Leitura e processamento de dados: Extrair informações do XML ou dados estruturados do documento para registar corretamente as informações necessárias no ERPComunicação do estado de integração: Informar o ilink sobre o estado do processo de integração do documentoGestão do estado de aceitação: Comunicar o estado de aceitação do documento, incluindo o envio de mensagens detalhadas em caso de erro ou rejeição  ","version":"Next","tagName":"h3"},{"title":"6.2 Métodos de receção​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#62-métodos-de-receção","content":" Permite consultar e integrar documentos no sistema em questão. A receção de documentos pode ser efetuada por 2 métodos: Consulta manual de documentos ou Webhook de receção.  a) Consulta manual de documentos  Neste modo, é necessário aceder ao endpoint GET /apps/documents. É possível especificar diversos parâmetros de pesquisa de modo a filtrar os resultados obtidos. A resposta deste método inclui os dados principais dos documentos, e adicionalmente a paginação através das propriedades rows (número de elementos por página) e page (número da página a consultar). Consulte a especificação acima para mais detalhes.  Para consultar os detalhes de um documento, bem como os links para os ficheiros XML e PDF do mesmo, deverá ser utilizado o método GET /apps/documents/{id}, usando um dos IDs retornados na lista de documentos anterior.  O endpoint de consulta pode ser acedido periodicamente (num processo em segundo plano), ou mediante a consulta de um utilizador no sistema (em tempo real).  Nota: Aqui, a chave pública é usada no contexto da entidade recetora dos documentos, ou seja, deverão utilizar a chave pública que identifica a entidade que acede os documentos recebidos.  Importante: Recomendamos uma utilização responsável deste endpoint. Chamadas excessivas a este recurso são de evitar, e poderão levar a 'time-outs' e restrições de acesso, consoante o nosso acordo de interoperabilidade.  b) Webhook de receção (recomendado)  Neste modo, o ilink toma a iniciativa de comunicar ao ERP quando chega um novo documento ao cliente, dispensando consultas frequentes ao endpoint GET /apps/documents. Para mais informação, consultar a secção Webhooks.  Nota: Segundo especificação, serão retornados os dados dos documentos recebidos num formato estruturado, bem como os URLs públicos para o acesso aos ficheiros XML e PDF do documento.  ","version":"Next","tagName":"h3"},{"title":"6.3 Importação e aceitação​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#63-importação-e-aceitação","content":" Após consultar o documento pretendido, é recomendado que o ERP comunique o estado de processamento do mesmo ao ilink, ou seja, se este integrou corretamete no sistema ou se é necessário retificar/regularizar o documento. Para tal, são necessários 2 passos:  1. Comunicar o estado do documento É feito com o pedido POST /apps/documents/{id}/accepted. Aqui é indicado se o documento foi aceite ou não, e caso contrário, o motivo que levou à sua rejeiçãoÉ obrigatório indicar o motivo de rejeição de um documento caso não seja aceiteUm documento rejeitado poderá ser reenviado pelo emissor com os dados corrigidos 2. Comunicar a importação do documento (apenas na aceitação com sucesso) Caso o passo anterior seja concluído com sucesso (i.e. o documento está em condições de ser integrado no ERP), deverão invocar o método POST /apps/documents/{id}  Nota: Não é necessário importar um documento rejeitado.  A correta comunicação de documentos aceites e/ou importados cria um histórico de auditoria e facilita o consumo do API, dado que, caso estejam a adotar a receção de documentos pelo método de consulta manual, quaisquer documentos que tenham sido importados ou rejeitados não são devolvidos novamente em consultas futuras. Ou seja, as chamadas a GET /apps/documents não devolvem documentos previamente rejeitados ou importados.  A imagem abaixo demonstra como as operações realizadas pelo ERP são registadas no portal do ilink:    ","version":"Next","tagName":"h3"},{"title":"6.4 Estados de Processo (opcional)​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#64-estados-de-processo-opcional","content":" Nota: Esta funcionalidade é opcional e tem carácter meramente informativo, não afectando o processo de recepção de documentos.  O ilink permite criar estados de documento personalizáveis para os documentos recebidos. Quando esta funcionalidade está ativa na entidade, é possível consultar e modificar o estado de um documento através da API.  Esta capacidade permite que software externo (como sistemas de gestão documental) altere o estado processual do documento no ilink de forma integrada. Todas as alterações de estado ficam registadas no histórico do documento.  Importante: O estado do processo é independente do estado padrão de um documento (recebido, aceite, etc.). Serve exclusivamente para fins de organização interna e registo de operações.  Para consultar todos os estados de processo disponíveis na entidade em questão, deverá ser usado o método GET /apps/processstates, que retorna a lista completa de estados, juntamente com o seu identification_code. Para alterar o estado de processo de um documento, deverá ser usado o método PUT /apps/documents/{id}/processstates, usando o campo identification_code para atribuir o novo estado.  Os estados de processo são configurados diretamente pela equipa de apoio do ilink.  ","version":"Next","tagName":"h3"},{"title":"7. Casos de uso​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#7-casos-de-uso","content":" A seguinte secção exemplifica algumas situações comuns na criação de documentos CIUS-PT.  ","version":"Next","tagName":"h2"},{"title":"7.1 Criação de documentos por envio de dados​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#71-criação-de-documentos-por-envio-de-dados","content":" Indicar as condições de pagamento payment_terms[note]: 30 dias Indicar um local de consumo (CPE) numa das linhas do documento lines[0][additional_property][0][name]: CPE lines[0][additional_property][0][value]: PT1234567890 Envio do número de compromisso no cabeçalho do documento commitment_number: 2021/451 Envio do número de compromisso nas linhas do documento lines[0][commitment][number]: 2021/123 lines[0][commitment][line]: 1 Envio do número de encomenda references[0][document_type]: order references[0][number]: 1234 Envio do PDF anexado (UTF-8) file: (binary) Envio de outros anexos secundários files[0]: (binary) files[1]: (binary) Nota: O PDF de representação do documento deve ser sempre enviado no campo file. Desconto no cabeçalho do documento discounts_charges[0][type]: false // usar true para encargo discounts_charges[0][reason]: desconto comercial discounts_charges[0][percent]: 23.00 discounts_charges[0][tax_code]: NOR discounts_charges[0][amount]: 8.13 // refere-se ao valor sem imposto (ou seja, este desconto é de 10.00 EUR após a aplicação de IVA) discount_amount: 8.13 // refere-se ao total de descontos de cabeçalho aplicados ao documento (NÃO inclui descontos nas linhas) Desconto ou encargo na linha do documento lines[0][discounts_charges][0][type]: false // usar true para encargo lines[0][discounts_charges][0][reason]: desconto comercial // descrição textual do desconto lines[0][discounts_charges][0][amount]: 5.00 // refere-se ao valor sem IVA a descontar na linha lines[0][quantity]: 2.000 // quantidade de artigos na linha lines[0][price]: 10.00000000 // preço unitário do artigo lines[0][amount]: 15.00000000 // o total da linha do documento é afectado pelo desconto ( (10 * 2) - 5 = 15) lines[0][taxes][0][tax_percent]: 23.000 // taxa de IVA lines[0][taxes][0][tax_amount]: 3.45 // valor do IVA da linha (15 * 0.23) discount_amount: 0.00 // refere-se ao total de descontos de cabeçalho aplicados ao documento (NÃO inclui descontos nas linhas) Desconto no preço do artigo lines[0][price_discount][base_amount]: 10.00 // preço unitário original do artigo antes de aplicar o desconto lines[0][price_discount][amount]: 5.00 // refere-se ao valor sem IVA a descontar no preço do artigo lines[0][quantity]: 2.000 // quantidade de artigos na linha lines[0][price]: 5.00000000 // preço do artigo após aplicação do desconto (10 - 5 = 5) lines[0][amount]: 10.00000000 // o total da linha do documento é afectado pelo desconto ( (10 - 5) * 2 = 10) lines[0][taxes][0][tax_percent]: 23.000 // taxa de IVA lines[0][taxes][0][tax_amount]: 2.30 // valor do IVA da linha (10 * 0.23) discount_amount: 0.00 // refere-se ao total de descontos de cabeçalho aplicados ao documento (NÃO inclui descontos nas linhas) Retenção na fonte withholding_tax[0][type]: IRF withholding_tax[0][tax_amount]: 10.00 // valor da retenção withholding_tax[0][description]: Retenção IRS withholding_tax_amount: 10.00 // soma de todas as retenções do documento Nota: os totais do documento não são afetados pela retenção Isenção de IVA na linha lines[0][quantity]: 2.000 // quantidade lines[0][price]: 5.00000000 // preço unitário lines[0][amount]: 10.00000000 // total da linha sem IVA lines[0][taxes][0][tax_percent]: 0.00 // taxa de IVA lines[0][taxes][0][tax_amount]: 0.00 // valor do IVA da linha lines[0][taxes][0][tax_exemption_reason_code]: M08 // código de motivo da AT lines[0][taxes][0][tax_exemption_reason]: IVA - Autoliquidação // descritivo do motivo da AT Isenção de IVA no desconto ou encargo de cabeçalho discounts_charges[0][type]: false // usar true para encargo discounts_charges[0][reason]: desconto comercial // descritivo discounts_charges[0][percent]: 0.00 // percentagem (isento) discounts_charges[0][tax_code]: ISE // isento discounts_charges[0][amount]: 10.00 // valor do desconto discounts_charges[0][tax_exemption_reason]: M08 // código de motivo da AT discounts_charges[0][tax_exemption_reason_code]: IVA - Autoliquidação // descritivo do motivo da AT Envio da fatua por e-mail a um ou mais endereços send_by_email: 1, customer[email]: endereco1@email.com // enviado sempre para o email especificado no cliente additional_emails[0]: endereco2@email.com // também enviado para a lista adicional de endereços additional_emails[1]: endereco3@email.com Envio de código QR qr_code: A:500000000*B:123456789*C:PT*D:GT*E:N*F:20190720*G:GT G234CB/50987*H:GTVX4Y8B-50987*I1:0*N:0.00*O:0.00*Q:5uIg*R:9999   ","version":"Next","tagName":"h3"},{"title":"7.2 Criação de documentos por envio do CIUS-PT​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#72-criação-de-documentos-por-envio-do-cius-pt","content":" Envio do número de compromisso no cabeçalho do documento &lt;Invoice&gt; ... &lt;cbc:AccountingCost&gt;2021/156&lt;/cbc:AccountingCost&gt; &lt;/Invoice&gt; Envio do Capital Social do fornecedor: &lt;Invoice&gt; ... &lt;cac:AccountingSupplierParty&gt; &lt;cac:PartyLegalEntity&gt; &lt;cbc:CompanyLegalForm&gt;2.000.000 EUR&lt;/cbc:CompanyLegalForm&gt; &lt;/cac:PartyLegalEntity&gt; &lt;/cac:AccountingSupplierParty&gt; &lt;/Invoice&gt; Envio do GLN do cliente (usar o schemeID 0088): &lt;Invoice&gt; ... &lt;cac:AccountingCustomerParty&gt; &lt;cbc:EndpointID schemeID=&quot;0088&quot;&gt;123456789&lt;/cbc:EndpointID&gt; &lt;/cac:AccountingCustomerParty&gt; &lt;/Invoice&gt; Envio de ATCUD e QRCODE: &lt;Invoice&gt; ... &lt;cac:AdditionalDocumentReference&gt; &lt;cbc:ID schemeID=&quot;ANG&quot;&gt;AFHOFX-22&lt;/cbc:ID&gt; &lt;!-- Valor ATCUD --&gt; &lt;cbc:DocumentDescription&gt;QR_CODE&lt;/cbc:DocumentDescription&gt; &lt;cac:Attachment&gt; &lt;!-- Texto do QRCODE, em base64 (da sequência de carateres, NÃO da imagem) --&gt; &lt;cbc:EmbeddedDocumentBinaryObject mimeCode=&quot;text/plain&quot; filename=&quot;QR_CODE.txt&quot;&gt;UVJDT0RF=&lt;/cbc:EmbeddedDocumentBinaryObject&gt; &lt;/cac:Attachment&gt; &lt;/cac:AdditionalDocumentReference&gt; &lt;/Invoice&gt; Indicar o método de pagamento: &lt;Invoice&gt; ... &lt;cac:PaymentMeans&gt; &lt;cbc:PaymentMeansCode&gt;NU&lt;/cbc:PaymentMeansCode&gt; &lt;/cac:PaymentMeans&gt; &lt;/Invoice&gt; Valores permitidos: Código\tDescriçãoCC\tCartão crédito CD\tCartão débito CH\tCheque bancário CI\tCrédito documentário internacional CO\tCheque ou cartão oferta CS\tCompensação de saldos em conta corrente DE\tDinheiro eletrónico (ex.: cartões de fidelidade ou pontos) LC\tLetra comercial MB\tReferências de pagamento para Multibanco NU\tNumerário OU\tOutros meios não assinalados PR\tPermuta de bens TB\tTransferência bancária ou débito direto autorizado TR\tTítulos de compensação extrassalarial (ex.: refeição, educação, etc.) Indicar informações de pagamento de cartão de débito ou crédito: &lt;Invoice&gt; ... &lt;cac:PaymentMeans&gt; &lt;cbc:PaymentMeansCode&gt;CC&lt;/cbc:PaymentMeansCode&gt; &lt;cac:CardAccount&gt; &lt;cbc:PrimaryAccountNumberID&gt;4211456651233545687&lt;/cbc:PrimaryAccountNumberID&gt; &lt;!-- Número da conta --&gt; &lt;cbc:NetworkID&gt;04256&lt;/cbc:NetworkID&gt; &lt;!-- Identificador da rede bancária --&gt; &lt;cbc:HolderName&gt;João Ferreira&lt;/cbc:HolderName&gt; &lt;!-- Nome do titular --&gt; &lt;/cac:CardAccount&gt; &lt;/cac:PaymentMeans&gt; &lt;/Invoice&gt; Indicar método de pagamento por transferência bancária: &lt;Invoice&gt; ... &lt;cac:PaymentMeans&gt; &lt;cbc:PaymentMeansCode&gt;TB&lt;/cbc:PaymentMeansCode&gt; &lt;cac:PayeeFinancialAccount&gt; &lt;cbc:ID&gt;PT50000700230012345667899&lt;/cbc:ID&gt; &lt;!-- IBAN--&gt; &lt;cbc:Name&gt;João&lt;/cbc:Name&gt; &lt;!-- Nome do titular --&gt; &lt;cac:FinancialInstitutionBranch&gt; &lt;cbc:ID&gt;NBxxxx&lt;/cbc:ID&gt; &lt;!--SWIFT --&gt; &lt;/cac:FinancialInstitutionBranch&gt; &lt;/cac:PayeeFinancialAccount&gt; &lt;/cac:PaymentMeans&gt; &lt;/Invoice&gt; Indicar método de pagamento por referência multibanco: &lt;Invoice&gt; ... &lt;cac:PaymentMeans&gt; &lt;cbc:PaymentMeansCode name=&quot;#DESCRIPTION@ATMPAYMENT#156.22#&quot;&gt;#ENTITY@ATMPAYMENT#15652&lt;/cbc:PaymentMeansCode&gt; &lt;!-- Entidade e Valor --&gt; &lt;cbc:PaymentID&gt;#REFERENCE@ATMPAYMENT#156555145#&lt;/cbc:PaymentID&gt; &lt;!-- Referência --&gt; &lt;/cac:PaymentMeans&gt; &lt;/Invoice&gt; Indicar uma segunda referência multibanco: &lt;Invoice&gt; ... &lt;cbc:Note&gt;#ENTITY@ATMPAYMENT-001#12345#&lt;/cbc:Note&gt; &lt;!-- 2ª entidade --&gt; &lt;cbc:Note&gt;#REFERENCE@ATMPAYMENT-001#012345678#&lt;/cbc:Note&gt; &lt;!-- 2ª referência --&gt; &lt;cbc:Note&gt;#AMOUNT@ATMPAYMENT-001#3264.10#&lt;/cbc:Note&gt; &lt;!--Valor da 2ª referência --&gt; &lt;cbc:Note&gt;#DESCRIPTION@ATMPAYMENT-001#Valor total do documento, mais valores em atraso#&lt;/cbc:Note&gt; &lt;!-- Descrição da 2ª referência --&gt; &lt;/Invoice&gt; Indicar as condições de pagamento: &lt;Invoice&gt; ... &lt;PaymentTerms&gt; &lt;cbc:Note&gt;30 dias&lt;/cbc:Note&gt; &lt;/PaymentTerms&gt; &lt;/Invoice&gt; Indicar uma nota textual no cabeçalho do documento: &lt;Invoice&gt; ... &lt;cbc:Note&gt;Nota cabeçalho&lt;/cbc:Note&gt; &lt;/Invoice&gt; Indicar uma nota textual numa das linhas do documento: &lt;Invoice&gt; ... &lt;InvoiceLine&gt; &lt;cbc:Note&gt;Nota linha&lt;/cbc:Note&gt; &lt;/InvoiceLine&gt; &lt;/Invoice&gt; Indicar uma propriedade adicional no documento: &lt;Invoice&gt; ... &lt;cbc:Note&gt;#ADDITIONALPROPERTY#VOUCHER#123#&lt;/cbc:Note&gt; &lt;Invoice&gt; Indicar um local de consumo (CPE) numa das linhas do documento: &lt;cac:InvoiceLine&gt; ... &lt;cac:AdditionalItemProperty&gt; &lt;cbc:Name&gt;CPE&lt;/cbc:Name&gt; &lt;cbc:Value&gt;PT1234567890&lt;/cbc:Value&gt; &lt;/cac:AdditionalItemProperty&gt; &lt;/cac:InvoiceLine&gt; Envio do número de encomenda / número de requisição &lt;Invoice&gt; ... &lt;cac:OrderReference&gt; &lt;cbc:ID&gt;20159854587&lt;/cbc:ID&gt; &lt;/cac:OrderReference&gt; &lt;/Invoice&gt; Envio do número de compromisso nas linhas do documento &lt;cac:InvoiceLine&gt; &lt;cbc:AccountingCost&gt;2020/123&lt;/cbc:AccountingCost&gt; &lt;!-- número do compromisso da linha --&gt; ... &lt;cac:Item&gt; &lt;cac:AdditionalItemProperty&gt; &lt;cbc:Name&gt;#LINEID@COMMITMENTLINEREFERENCE#&lt;/cbc:Name&gt; &lt;cbc:Value&gt;1&lt;/cbc:Value&gt; &lt;!-- número da linha --&gt; &lt;/cac:AdditionalItemProperty&gt; &lt;/cac:Item&gt; &lt;/cac:InvoiceLine&gt; Envio do PDF anexado (o conteúdo deve estar em base64) &lt;Invoice&gt; ... &lt;cac:AdditionalDocumentReference&gt; &lt;cbc:ID&gt;1&lt;/cbc:ID&gt; &lt;cbc:DocumentDescription&gt;INVOICE_REPRESENTATION&lt;/cbc:DocumentDescription&gt; &lt;cac:Attachment&gt; &lt;cbc:EmbeddedDocumentBinaryObject mimeCode=&quot;application/pdf&quot; filename=&quot;document&quot;&gt;JVBERi0xLjUNCiW1tbW1DQoxIDAgb2JqDQo8PC9UeXBlL0NhdGFsb2cvUGIvTGF== &lt;/cbc:EmbeddedDocumentBinaryObject&gt; &lt;/cac:Attachment&gt; &lt;/cac:AdditionalDocumentReference&gt; &lt;/Invoice&gt; Ver exemplo Envio de múltiplos PDFs anexados &lt;Invoice&gt; ... &lt;cac:AdditionalDocumentReference&gt; &lt;cbc:ID&gt;1&lt;/cbc:ID&gt; &lt;!-- O anexo principal deve ter a descrição INVOICE_REPRESENTATION', ou 'CREDITNOTE_REPRESENTATION' --&gt; &lt;cbc:DocumentDescription&gt;INVOICE_REPRESENTATION&lt;/cbc:DocumentDescription&gt; &lt;cac:Attachment&gt; &lt;cbc:EmbeddedDocumentBinaryObject mimeCode=&quot;application/pdf&quot; filename=&quot;document.pdf&quot;&gt;JVBERi0xLjUNCiW1tbW1DQoxIDAgb2JqDQo8PC9UeXBlL0NhdGFsb2cvUGIvTGF== &lt;/cbc:EmbeddedDocumentBinaryObject&gt; &lt;/cac:Attachment&gt; &lt;/cac:AdditionalDocumentReference&gt; &lt;cac:AdditionalDocumentReference&gt; &lt;cbc:ID&gt;2&lt;/cbc:ID&gt; &lt;!-- Os anexos secundários (como a nota de encomenda, guias de pagamento, etc.) devem ter a descrição 'ATTACHMENT'. É possível incluir vários ATTACHMENTs num documento. --&gt; &lt;cbc:DocumentDescription&gt;ATTACHMENT&lt;/cbc:DocumentDescription&gt; &lt;cac:Attachment&gt; &lt;cbc:EmbeddedDocumentBinaryObject mimeCode=&quot;application/pdf&quot; filename=&quot;document2.pdf&quot;&gt;jUNCiW1tbW1DQoJVBERi0xLjUNCiW1tbW1DQo8PC9UeXBlL0NhUGIvTGF== &lt;/cbc:EmbeddedDocumentBinaryObject&gt; &lt;/cac:Attachment&gt; &lt;/cac:AdditionalDocumentReference&gt; &lt;/Invoice&gt; Envio de outros anexos (QR Code, etc.) (o conteúdo deve estar em base64) &lt;Invoice&gt; ... &lt;cac:AdditionalDocumentReference&gt; &lt;cbc:ID&gt;2&lt;/cbc:ID&gt; &lt;cbc:DocumentDescription&gt;ATTACHMENT&lt;/cbc:DocumentDescription&gt; &lt;!-- usar QR_CODE para o código QR --&gt; &lt;cac:Attachment&gt; &lt;cbc:EmbeddedDocumentBinaryObject mimeCode=&quot;application/txt&quot; filename=&quot;document&quot;&gt;JVBERi0xLjUNCiW1tbW1DQoxIDAgb2JqDQo8PC9UeXBlL0NhdGFsb2cvUGIvTGF== &lt;/cbc:EmbeddedDocumentBinaryObject&gt; &lt;/cac:Attachment&gt; &lt;/cac:AdditionalDocumentReference&gt; &lt;/Invoice&gt; Desconto ou encargo no cabeçalho do documentoVer exemplo Desconto ou encargo na linha do documentoVer exemplo Desconto ou encargo no preço do artigoVer exemplo Retenção na fonteVer exemplo Isenção de IVA na linha do documentoVer exemplo Isenção de IVA no desconto de cabeçalho do documentoVer exemplo Múltiplas isenções no documentoVer exemplo Vários descontos na linhaVer exemplo Ver lista completa de casos de uso CIUS-PT pela eSPap.  ","version":"Next","tagName":"h3"},{"title":"8. Fluxos API​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#8-fluxos-api","content":" A imagem abaixo consolida os fluxos de integração do API do ilink acima descritos:    ","version":"Next","tagName":"h2"},{"title":"9. Checklist pré-produção​","type":1,"pageTitle":"Integração via API REST","url":"/integracao-api-rest#9-checklist-pré-produção","content":" Antes de passar a integração a ambiente produtivo, devem validar os seguintes pontos:  Acordo de interoperabilidade (obrigatório)  Deverá ser assinado e devolvido à acin  Envio de documentos (no caso da implementação do fluxo de envio)  Verificar se é possível criar um documento entre ambas as entidades de teste sem erros de validação, contendo os seguintes campos: PDF anexadoNúmero de compromissoTodos os campos da morada do fornecedor (rua, cidade, código postal)Capital social do fornecedorNúmero de encomenda/requisiçãoGLN do clienteGLN do local de entrega No caso do envio de documentos para entidades não públicas (e.g envio de e-mail com PDF anexado), verificar se é enviado um e-mail com a fatura ao destinatário, e se a assinatura do documento XML é desativada (caso seja usada uma assinatura digital qualificada no ilink)No caso da consulta de estado de documentos emitidos, deverão testar se o software é capaz de receber e agir confirme o estado do documentoCaso o documento seja rejeitado/regularizado, deverá ser possível reenviar o mesmo com informação retificada.  Receção de documentos (no caso da implementação do fluxo de receção)  Devem verificar se um documento recebido é corretamente integrado no software, e se é comunicada a correta importação e aceitação do mesmo.  Passagem a produção (obrigatório)  Configurar o URL de produção no vosso softwareSolicitar à equipa do ilink o token de aplicação e chave(s) da(s) entidade(s) do ambiente de produçãoAssegurar-se que são efetuadas as autenticações necessárias em ambiente produtivoAssegurar-se que o cliente tem todas as ligações previamente configuradas no portal do ilink, assim como as transações necessárias ativas (solicitar ao serviço de apoio)Opcional: assegurar que o cliente tem a assinatura digital corretamente configurada no ambiente produtivo.Opcional: assegurar que o cliente tem o template de envio de e-mail de faturação configurado no ambiente produtivo. ","version":"Next","tagName":"h2"}],"options":{"id":"default"}}