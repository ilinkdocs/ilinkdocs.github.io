"use strict";(self.webpackChunkilink=self.webpackChunkilink||[]).push([[291],{566:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/20210417-111632-7d680ad6761f7607defd035c24e6cf22.png"},1795:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/20210417-111219-88f2f19a5ac787cdbef244dc05f8fb28.png"},1831:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/20210415-103711-9bb262490b5fe4a378b8e4edde60ea70.png"},1884:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"integrations/api/specification","title":"Especifica\xe7\xe3o t\xe9cnica","description":"Documenta\xe7\xe3o Swagger","source":"@site/docs/integrations/api/specification.md","sourceDirName":"integrations/api","slug":"/integrations/api/specification","permalink":"/docs/integrations/api/specification","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"ilinkSidebar","previous":{"title":"Introdu\xe7\xe3o ao API REST v1","permalink":"/docs/integrations/api/scope"},"next":{"title":"Emiss\xe3o de documentos","permalink":"/docs/integrations/api/issued"}}');var a=s(4848),o=s(8453);const t={},r="Especifica\xe7\xe3o t\xe9cnica",d={},c=[{value:"Documenta\xe7\xe3o Swagger",id:"documenta\xe7\xe3o-swagger",level:2},{value:"Autoriza\xe7\xe3o (OAuth2 Client Credentials)",id:"autoriza\xe7\xe3o-oauth2-client-credentials",level:2},{value:"Obten\xe7\xe3o do Token de Acesso",id:"obten\xe7\xe3o-do-token-de-acesso",level:3},{value:"Gera\xe7\xe3o da Assinatura",id:"gera\xe7\xe3o-da-assinatura",level:3},{value:"Exemplo Pr\xe1tico de Autentica\xe7\xe3o",id:"exemplo-pr\xe1tico-de-autentica\xe7\xe3o",level:3},{value:"Autoriza\xe7\xe3o (Legacy)",id:"autoriza\xe7\xe3o-legacy",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"especifica\xe7\xe3o-t\xe9cnica",children:"Especifica\xe7\xe3o t\xe9cnica"})}),"\n",(0,a.jsx)(n.h2,{id:"documenta\xe7\xe3o-swagger",children:"Documenta\xe7\xe3o Swagger"}),"\n",(0,a.jsxs)(n.p,{children:["O ilink utiliza uma especifica\xe7\xe3o OpenAPI 3 num cliente Swagger, dispon\xedvel ",(0,a.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html",children:"aqui"}),". Neste cliente web, pode efetuar chamadas de teste ao nosso API, analisar as respostas obtidas e verificar os dados a enviar para cada endpoint/m\xe9todo."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"O cliente swagger disponibilizado acima deve acompanhar o seu processo de desenvolvimento."})," \xc9 tamb\xe9m poss\xedvel verificar como as chamadas ao API s\xe3o constru\xeddas atrav\xe9s do ",(0,a.jsx)(n.a,{href:"https://curl.se/",children:"cURL"})," (consulte o exemplo abaixo):"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"img info",src:s(1795).A+"",width:"1400",height:"539"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Nota:"})," S\xe3o tamb\xe9m disponibilizados v\xe1rios ",(0,a.jsx)(n.a,{href:"https://ilink.acin.pt/resources/clients.zip",children:"clientes HTTP,"})," em mais de 50 linguagens e frameworks, gerados automaticamente a partir da nossa especifica\xe7\xe3o, que podem servir de suporte inicial ao processo de integra\xe7\xe3o."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"autoriza\xe7\xe3o-oauth2-client-credentials",children:"Autoriza\xe7\xe3o (OAuth2 Client Credentials)"}),"\n",(0,a.jsxs)(n.p,{children:["A API do ilink utiliza o fluxo ",(0,a.jsx)(n.strong,{children:"OAuth2 Client Credentials"})," para autentica\xe7\xe3o e autoriza\xe7\xe3o. Este \xe9 o m\xe9todo recomendado para todas as novas integra\xe7\xf5es."]}),"\n",(0,a.jsx)(n.h3,{id:"obten\xe7\xe3o-do-token-de-acesso",children:"Obten\xe7\xe3o do Token de Acesso"}),"\n",(0,a.jsxs)(n.p,{children:["Para aceder \xe0 API, \xe9 necess\xe1rio primeiro obter um token de acesso atrav\xe9s do endpoint ",(0,a.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Autentica%C3%A7%C3%A3o/postOauth2Token",children:(0,a.jsx)(n.strong,{children:"POST /oauth2/token"})}),". Este processo requer o envio de 5 par\xe2metros:"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Par\xe2metro"}),(0,a.jsx)(n.th,{children:"Valor"}),(0,a.jsx)(n.th,{children:"Descri\xe7\xe3o"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"grant_type"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"client_credentials"})}),(0,a.jsx)(n.td,{children:"Tipo de concess\xe3o OAuth2 (valor fixo)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"client_id"})}),(0,a.jsx)(n.td,{children:"Fornecido pela equipa ilink"}),(0,a.jsx)(n.td,{children:"Identificador \xfanico da sua aplica\xe7\xe3o"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"timestamp"})}),(0,a.jsx)(n.td,{children:"Timestamp UNIX atual"}),(0,a.jsxs)(n.td,{children:["Tempo atual em segundos. ",(0,a.jsx)(n.strong,{children:"Deve estar sincronizado ou muito pr\xf3ximo"})," da hora atual"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"nonce"})}),(0,a.jsx)(n.td,{children:"Valor aleat\xf3rio (at\xe9 20 caracteres)"}),(0,a.jsx)(n.td,{children:"Valor \xfanico alfanum\xe9rico gerado para cada requisi\xe7\xe3o"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"signature"})}),(0,a.jsx)(n.td,{children:"Assinatura HMAC-SHA256"}),(0,a.jsx)(n.td,{children:"Assinatura criptogr\xe1fica calculada (ver abaixo)"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"gera\xe7\xe3o-da-assinatura",children:"Gera\xe7\xe3o da Assinatura"}),"\n",(0,a.jsxs)(n.p,{children:["A assinatura \xe9 calculada usando o algoritmo ",(0,a.jsx)(n.strong,{children:"HMAC-SHA256"})," e deve seguir a f\xf3rmula"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"base64_encode(HMAC_SHA256(CLIENT_ID:TIMESTAMP:NONCE, CLIENT_SECRET))\n"})}),"\n",(0,a.jsx)(n.h3,{id:"exemplo-pr\xe1tico-de-autentica\xe7\xe3o",children:"Exemplo Pr\xe1tico de Autentica\xe7\xe3o"}),"\n",(0,a.jsx)(n.p,{children:"Suponha que recebeu as seguintes credenciais da equipa ilink:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"client_id:"})," ",(0,a.jsx)(n.code,{children:"demoapp"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"client_secret:"})," ",(0,a.jsx)(n.code,{children:"qwerty"})]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Passo a passo:"})}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Obter timestamp UNIX atual"}),". Exemplo: ",(0,a.jsx)(n.code,{children:"1765812050"})," (segundos desde 1 de janeiro de 1970)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Gerar nonce aleat\xf3rio"}),". Exemplo: ",(0,a.jsx)(n.code,{children:"aYb89a8yf10"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:'Concatenar os valores com ":"'}),". Resultado: ",(0,a.jsx)(n.code,{children:"demoapp:1765812050:aYb89a8yf10"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Aplicar HMAC-SHA256"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Usar a chave privada (client_secret): ",(0,a.jsx)(n.code,{children:"qwerty"})]}),"\n",(0,a.jsxs)(n.li,{children:["Ferramenta online: ",(0,a.jsx)(n.a,{href:"https://www.devglan.com/online-tools/hmac-sha256-online",children:"HMAC-SHA256 Generator"})]}),"\n",(0,a.jsxs)(n.li,{children:["Resultado: ",(0,a.jsx)(n.code,{children:"ff293edc63f0134ffa44ae04a6900e2ee43060aff620413b003c4e5eefbea949"})]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Codificar em Base64"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Ferramenta online: ",(0,a.jsx)(n.a,{href:"https://www.base64encode.org/",children:"Base64 Encoder"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Assinatura final:"})," ",(0,a.jsx)(n.code,{children:"ZmYyOTNlZGM2M2YwMTM0ZmZhNDRhZTA0YTY5MDBlMmVlNDMwNjBhZmY2MjA0MTNiMDAzYzRlNWVlZmJlYTk0OQ=="})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Dados finais a enviar:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'POST /oauth2/token\n\n{\n    "grant_type": "client_credentials",\n    "client_id": "demoapp",\n    "timestamp": 1765812050,\n    "nonce": "aYb89a8yf10",\n    "signature": "ZmYyOTNlZGM2M2YwMTM0ZmZhNDRhZTA0YTY5MDBlMmVlNDMwNjBhZmY2MjA0MTNiMDAzYzRlNWVlZmJlYTk0OQ=="\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Ap\xf3s enviar os dados acima, ser\xe1 devolvida a resposta abaixo, que cont\xe9m um token de acesso ao API:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'HTTP status: 200 OK\n\n{\n    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.vv6zhqgZYACxyALv03AplewBVgDgXq_9vOI4iLcAxWY",\n    "token_type": "Bearer",\n    "expires_in": 1800,\n    "scope": "document_create,document_read,states_read"\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Este token de acesso tem uma dura\xe7\xe3o de ",(0,a.jsx)(n.strong,{children:"30 minutos"})," e deve ser inclu\xeddo em todos os pedidos ao API no header abaixo:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Authorization"}),": Bearer {ACCESS_TOKEN}"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["No cliente ",(0,a.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/",children:"Swagger"}),", o processo de autoriza\xe7\xe3o \xe9 efetuado inserindo o token de acesso ap\xf3s clicar no bot\xe3o ",(0,a.jsx)(n.strong,{children:"Authorize"}),"."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"img info",src:s(8629).A+"",width:"1132",height:"384"})}),"\n",(0,a.jsxs)(n.p,{children:["Ap\xf3s esta opera\xe7\xe3o, deve notar que todos os pedidos subsequentes ao API incluem o header ",(0,a.jsx)(n.em,{children:"Authorization"}),":"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"img info",src:s(566).A+"",width:"1402",height:"204"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Importante"}),": Quando o token de acesso expirar, \xe9 devolvida a seguinte resposta em todos os pedidos, e ser\xe1 necess\xe1rio renovar o token de acesso repetindo o processo acima descrito:"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'HTTP status: 401 Unauthorized\n\n{\n  "success": false,\n  "errors": [\n    {\n      "code": "e069",\n      "msg": "Autentica\xe7\xe3o inv\xe1lida"\n    }\n  ]\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"autoriza\xe7\xe3o-legacy",children:"Autoriza\xe7\xe3o (Legacy)"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Nota: Novas integra\xe7\xf5es devem seguir o m\xe9todo OAuth2 descrito na se\xe7\xe3o anterior."})," Para refer\xeancia, o m\xe9todo Legacy de Autoriza\xe7\xe3o \xe9 detalhado nesta se\xe7\xe3o."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Todos os pedidos efetuados ao API devem conter obrigatoriamente o header de autoriza\xe7\xe3o abaixo:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Authorization"}),": Bearer {TOKEN_PLATAFORMA}"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["No cliente ",(0,a.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/",children:"Swagger"}),", o processo de autoriza\xe7\xe3o \xe9 efetuado inserindo o token de plataforma ap\xf3s clicar no bot\xe3o ",(0,a.jsx)(n.strong,{children:"Authorize"}),"."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"img info",src:s(8629).A+"",width:"1132",height:"384"})}),"\n",(0,a.jsxs)(n.p,{children:["Ap\xf3s esta opera\xe7\xe3o, deve notar que todos os pedidos subsequentes ao API incluem o header ",(0,a.jsx)(n.em,{children:"Authorization"}),":"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"img info",src:s(566).A+"",width:"1402",height:"204"})}),"\n",(0,a.jsxs)(n.p,{children:["Antes de efetuar a primeira consulta ao API do ilink, ",(0,a.jsx)(n.strong,{children:"\xe9 obrigat\xf3rio efetuar uma autentica\xe7\xe3o por cliente/NIF"}),". Esta autentica\xe7\xe3o serve de ",(0,a.jsx)(n.em,{children:"handshake"})," inicial entre o cliente e o ilink e \xe9 efetuada atrav\xe9s do endpoint ",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Autentica%C3%A7%C3%A3o/postAuthentications",children:"POST /apps/authentications"})}),":"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"img info",src:s(8278).A+"",width:"1485",height:"510"})}),"\n",(0,a.jsx)(n.p,{children:"Uma autentica\xe7\xe3o v\xe1lida deve retornar esta resposta:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'HTTP status: 200 OK\n\n{\n  "success": true,\n  "message": {\n    "code":"e123",\n    "msg":"Integra\xe7\xe3o realizada com sucesso."\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["A autentica\xe7\xe3o tem dura\xe7\xe3o ilimitada (s\xf3 precisa de ser invocada 1 vez por cliente/NIF que acede ao API). Pode tamb\xe9m ser revogada atrav\xe9s do m\xe9todo ",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Autentica%C3%A7%C3%A3o/deleteAuthentications",children:"DELETE /apps/authentications"})}),":"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"img info",src:s(1831).A+"",width:"1495",height:"328"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Se o processo de autentica\xe7\xe3o n\xe3o for conclu\xeddo, ou o header Authorization n\xe3o for enviado nos pedidos ao API, todas as chamadas ser\xe3o recusadas para esse NIF com o seguinte erro"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'HTTP status: 401 Unauthorized\n\n{\n  "success": false,\n  "errors": [\n    {\n      "code": "e069",\n      "msg": "Autentica\xe7\xe3o inv\xe1lida"\n    }\n  ]\n}\n'})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Nota: Em ambiente de produ\xe7\xe3o \xe9 necess\xe1rio autenticar novamente cada cliente/NIF."})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8278:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/20210415-103008-471d454f32df88fc66d0645e76b47275.png"},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>r});var i=s(6540);const a={},o=i.createContext(a);function t(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),i.createElement(o.Provider,{value:n},e.children)}},8629:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/20210415-103308-1912980fe8ad281c1559aadfa9901e69.png"}}]);