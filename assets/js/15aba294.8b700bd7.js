"use strict";(self.webpackChunkilink=self.webpackChunkilink||[]).push([[78],{73:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/files/isencao_desconto-649e8711f6de2bd714ad7a37c1d7d8b8.xml"},900:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/images/20230420-132629-75cc0fe2123c068f396e1ac5ffbb7543.png"},2266:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/files/desconto_preco-4a3e7203c3e558d6acd18480febb0d63.xml"},2624:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/files/varios_descontos-378c454a1a128c0264b25ee26656f839.xml"},2815:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/files/xml_com_pdf-5cf4add52a31cb42942fd7d18eee4113.xml"},2825:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/images/20230426-125316-0840655190d4733e042ef2069dda297b.png"},2867:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/images/20210415-103008-471d454f32df88fc66d0645e76b47275.png"},3845:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/images/20210415-123923-45dc58da575be97ec00b5f16d9c8da41.png"},3960:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/files/multiplas_isencoes-ea8cb719d2368087c201300a30f434e9.xml"},4304:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/images/20210415-103308-1912980fe8ad281c1559aadfa9901e69.png"},5086:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/files/retencao-c90ddcc404e0ff8258e6f60d49740639.xml"},5386:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/files/desconto_global-7f962577f9178b4e4050a61354d84ad5.xml"},5635:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/images/20230420-133607-c5d03a751653d102acc0ed60c783eee4.png"},7084:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/images/20230420-133914-c96ee4049998eb70825f7dcb46b5c6fb.png"},7216:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/files/isencao_linha-2f81199b8bcfb1faacdd8ee195a47a10.xml"},7434:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/images/20210417-111219-88f2f19a5ac787cdbef244dc05f8fb28.png"},8123:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/files/desconto_linha-ef6ab1a5bf162d00117e0172d1eb7153.xml"},8453:(e,o,n)=>{n.d(o,{R:()=>d,x:()=>c});var s=n(6540);const a={},i=s.createContext(a);function d(e){const o=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function c(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),s.createElement(i.Provider,{value:o},e.children)}},9051:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/images/20210417-111632-7d680ad6761f7607defd035c24e6cf22.png"},9054:(e,o,n)=>{n.d(o,{A:()=>s});const s=n.p+"assets/images/20210415-103711-9bb262490b5fe4a378b8e4edde60ea70.png"},9500:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>t,contentTitle:()=>c,default:()=>m,frontMatter:()=>d,metadata:()=>s,toc:()=>r});const s=JSON.parse('{"id":"integracao-api-rest","title":"Integra\xe7\xe3o via API REST","description":"1. \xc2mbito","source":"@site/docs/integracao-api-rest.md","sourceDirName":".","slug":"/integracao-api-rest","permalink":"/docs/integracao-api-rest","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"integracao-api-rest","sidebar_position":4},"sidebar":"ilinkSidebar","previous":{"title":"Lista de Integra\xe7\xf5es","permalink":"/docs/integracoes-ilink"},"next":{"title":"Integra\xe7\xe3o via AS2","permalink":"/docs/integracao-as2"}}');var a=n(4848),i=n(8453);const d={id:"integracao-api-rest",sidebar_position:4},c="Integra\xe7\xe3o via API REST",t={},r=[{value:"1. \xc2mbito",id:"1-\xe2mbito",level:2},{value:"2. Notas T\xe9cnicas",id:"2-notas-t\xe9cnicas",level:2},{value:"3. Pr\xe9 requisitos",id:"3-pr\xe9-requisitos",level:2},{value:"4. Especifica\xe7\xe3o t\xe9cnica",id:"4-especifica\xe7\xe3o-t\xe9cnica",level:2},{value:"4.1 Autoriza\xe7\xe3o",id:"41-autoriza\xe7\xe3o",level:3},{value:"4.2 Autentica\xe7\xe3o",id:"42-autentica\xe7\xe3o",level:3},{value:"5. Emiss\xe3o de documentos",id:"5-emiss\xe3o-de-documentos",level:2},{value:"5.1 \xc2mbito",id:"51-\xe2mbito",level:3},{value:"5.2 Assinatura digital",id:"52-assinatura-digital",level:3},{value:"5.3 M\xe9todos de envio",id:"53-m\xe9todos-de-envio",level:3},{value:"a) Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)",id:"a-envio-do-xml-em-formato-ubl-21-cius-pt-ou-ubl-21-peppolbis3---encomendas",level:4},{value:"b) Envio dos dados estruturados do documento",id:"b-envio-dos-dados-estruturados-do-documento",level:4},{value:"5.4 Envio do documento",id:"54-envio-do-documento",level:3},{value:"5.4.1 Envio via EDI",id:"541-envio-via-edi",level:4},{value:"5.4.2 Envio via e-mail",id:"542-envio-via-e-mail",level:4},{value:"5.4.3 Cria\xe7\xe3o de documentos e consumo de assinaturas digitais qualificadas",id:"543-cria\xe7\xe3o-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas",level:4},{value:"5.5 Valida\xe7\xf5es adicionais",id:"55-valida\xe7\xf5es-adicionais",level:3},{value:"5.6 Criar/editar documento",id:"56-criareditar-documento",level:3},{value:"5.7 Acesso a documentos emitidos",id:"57-acesso-a-documentos-emitidos",level:3},{value:"5.8 Consulta de documentos emitidos no portal (opcional)",id:"58-consulta-de-documentos-emitidos-no-portal-opcional",level:3},{value:"5.9 Consulta de estado de documentos emitidos",id:"59-consulta-de-estado-de-documentos-emitidos",level:3},{value:"5.9.1 Consulta de estado de documento enviado via EDI",id:"591-consulta-de-estado-de-documento-enviado-via-edi",level:4},{value:"5.9.2 Consulta de estado de documento enviado via e-mail",id:"592-consulta-de-estado-de-documento-enviado-via-e-mail",level:4},{value:"6. Rece\xe7\xe3o de documentos",id:"6-rece\xe7\xe3o-de-documentos",level:2},{value:"6.1 \xc2mbito",id:"61-\xe2mbito",level:3},{value:"6.2 M\xe9todos de rece\xe7\xe3o",id:"62-m\xe9todos-de-rece\xe7\xe3o",level:3},{value:"6.3 Importa\xe7\xe3o e aceita\xe7\xe3o",id:"63-importa\xe7\xe3o-e-aceita\xe7\xe3o",level:3},{value:"6.4 Estados de Processo (opcional)",id:"64-estados-de-processo-opcional",level:3},{value:"7. Casos de uso",id:"7-casos-de-uso",level:2},{value:"7.1 Cria\xe7\xe3o de documentos por envio de dados",id:"71-cria\xe7\xe3o-de-documentos-por-envio-de-dados",level:3},{value:"7.2 Cria\xe7\xe3o de documentos por envio do CIUS-PT",id:"72-cria\xe7\xe3o-de-documentos-por-envio-do-cius-pt",level:3},{value:"8. Fluxos API",id:"8-fluxos-api",level:2},{value:"9. Checklist pr\xe9-produ\xe7\xe3o",id:"9-checklist-pr\xe9-produ\xe7\xe3o",level:2}];function l(e){const o={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.header,{children:(0,a.jsx)(o.h1,{id:"integra\xe7\xe3o-via-api-rest",children:"Integra\xe7\xe3o via API REST"})}),"\n",(0,a.jsx)(o.h2,{id:"1-\xe2mbito",children:"1. \xc2mbito"}),"\n",(0,a.jsx)(o.p,{children:"O API REST do ilink permite um controlo program\xe1tico das principais opera\xe7\xf5es de documentos presentes no ilink, facilitando a integra\xe7\xe3o com programas externos."}),"\n",(0,a.jsxs)(o.p,{children:["O ilink distingue 2 fluxos principais de integra\xe7\xe3o: ",(0,a.jsx)(o.strong,{children:"rece\xe7\xe3o e emiss\xe3o de documentos"}),", com respetivo reporte de estados, dos quais poder\xe3o ser implementados ambos ou apenas um, dependendo das necessidades do software a integrar."]}),"\n",(0,a.jsx)(o.h2,{id:"2-notas-t\xe9cnicas",children:"2. Notas T\xe9cnicas"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["O webservice segue a estrutura ",(0,a.jsx)(o.a,{href:"https://en.wikipedia.org/wiki/Representational_state_transfer",children:"REST"})]}),"\n",(0,a.jsxs)(o.li,{children:["Os HTTP status codes devolvidos respeitam o ",(0,a.jsx)(o.a,{href:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes",children:"RFC 7231"})]}),"\n",(0,a.jsxs)(o.li,{children:["Todos os dados enviados (incluindo anexos XML) dever\xe3o ser representados em ",(0,a.jsx)(o.strong,{children:"UTF-8"}),". Formatos como ANSI, UTF-8 BOM e ISO 8859-1 devem ser evitados de modo a garantir compatibilidade com todos os sistemas recetores"]}),"\n",(0,a.jsxs)(o.li,{children:["As respostas (payloads) s\xe3o devolvidas em formato ",(0,a.jsx)(o.strong,{children:"JSON"})]}),"\n",(0,a.jsxs)(o.li,{children:["Os servidores do ilink funcionam exclusivamente por ",(0,a.jsx)(o.strong,{children:"HTTPS, com vers\xe3o TLS 1.2"})," (em caso de problemas com a comunica\xe7\xe3o, ver poss\xedveis resolu\xe7\xf5es para ",(0,a.jsx)(o.a,{href:"https://www.google.com/search?q=enable%20tls%201.2%20java&oq=enable%20tls%201.2%20java&aqs=chrome..69i57j0i19i395l4j0i19i22i30l5.5771j1j7&sourceid=chrome&ie=UTF-8",children:"Java"})," e ",(0,a.jsx)(o.a,{href:"https://www.google.com/search?q=enable%20tls%201.2%20c#&sxsrf=ALeKk00pvMlLTAafzUGlqvul3udFWBE-Xw:1622739135091&ei=vwi5YLeWBYmIlwTJyT8&oq=enable%20tls%201.2%20c#&gs_lcp=Cgdnd3Mtd2l6EAMyBQgAEMsBMgYIABAWEB4yBggAEBYQHjoHCCMQsAMQJzoHCAAQRxCwAzoCCABQgaQFWKinBWC5qQVoA3ACeACAAXiIAb4CkgEDMS4ymAEAoAEBqgEHZ3dzLXdpesgBCcABAQ&sclient=gws-wiz&ved=0ahUKEwj38dat9vvwAhUJxIUKHcnkDwAQ4dUDCBE&uact=5",children:"C#"}),")"]}),"\n",(0,a.jsxs)(o.li,{children:["A especifica\xe7\xe3o e cliente de demonstra\xe7\xe3o swagger est\xe1 dispon\xedvel ",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html",children:"aqui"})]}),"\n",(0,a.jsxs)(o.li,{children:["Existem 2 ambientes distintos, com URLs base diferentes:","\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Testes/pr\xe9-produ\xe7\xe3o"}),": ",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/ilinktests-api/api/v1/pt",children:"https://ilink.acin.pt/ilinktests-api/api/v1/pt"})]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Produ\xe7\xe3o"}),": ",(0,a.jsx)(o.a,{href:"https://ilink.pt/ilink-api/api/v1/pt",children:"https://ilink.pt/ilink-api/api/v1/pt"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," Os documentos emitidos e recebidos via API podem ser consultados no ",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt",children:"portal de testes do ilink"})," usando as credenciais que vos foram enviadas."]}),"\n"]}),"\n",(0,a.jsx)(o.h2,{id:"3-pr\xe9-requisitos",children:"3. Pr\xe9 requisitos"}),"\n",(0,a.jsxs)(o.p,{children:["De modo a integrar via API, ser\xe1 necess\xe1rio primeiro entrar em contacto com a nossa equipa (",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"mailto:apoio@ilink.pt",children:"apoio@ilink.pt"})}),") de modo a pedir acessos ao nosso ambiente de testes/qualidade."]}),"\n",(0,a.jsx)(o.p,{children:"Os acessos disponibilizados ser\xe3o os seguintes:"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["Um ",(0,a.jsx)(o.strong,{children:"token de plataforma"}),", que identifica o sistema/plataforma a aceder ao webservice"]}),"\n",(0,a.jsxs)(o.li,{children:["Uma ",(0,a.jsx)(o.strong,{children:"chave p\xfablica"}),", que identifica o cliente/NIF que pretende aceder ao webservice"]}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["Isto significa que ",(0,a.jsx)(o.strong,{children:"cada cliente que permite emitir ou receber documentos necessita de um pr\xe9-registo com a nossa equipa, de modo a ser gerada a sua chave p\xfablica"}),". O token de plataforma ser\xe1 \xfanico para o sistema a integrar (comum a todos os clientes que utilizam o vosso sistema), e dever\xe1 ser usado em todas as chamadas ao API."]}),"\n",(0,a.jsx)(o.p,{children:"Nos acessos de teste, tamb\xe9m s\xe3o disponibilizados 2 clientes/NIFs, juntamente com os seus logins de acesso ao portal do ilink. Dever\xe3o usar estas entidades para transacionar documentos entre si, e opcionalmente aceder ao portal para consulta dos mesmos. Os NIFs atribu\xeddos podem ser alterados se necess\xe1rio."}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota"}),": Ser\xe3o enviados novos acessos (token de plataforma e chave p\xfablica por NIF) mediante entrada em produ\xe7\xe3o."]}),"\n"]}),"\n",(0,a.jsx)(o.h2,{id:"4-especifica\xe7\xe3o-t\xe9cnica",children:"4. Especifica\xe7\xe3o t\xe9cnica"}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html",children:"Aceder \xe0 especifica\xe7\xe3o swagger"})}),"\n",(0,a.jsxs)(o.p,{children:["O ilink utiliza uma especifica\xe7\xe3o OpenApi 3, e est\xe1 dispon\xedvel ",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html",children:"aqui"}),". Neste cliente web, poder\xe1 efetuar chamadas de teste ao nosso API, analisar as respostas obtidas bem como os dados a enviar para cada endpoint/m\xe9todo."]}),"\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"O cliente swagger disponibilizado acima dever\xe1 acompanhar o vosso processo de desenvolvimento."})," \xc9 tamb\xe9m poss\xedvel verificar como as chamadas ao API s\xe3o constru\xeddas via ",(0,a.jsx)(o.a,{href:"https://curl.se/",children:"cURL"})," (ver exemplo abaixo):"]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{alt:"img info",src:n(7434).A+"",width:"1400",height:"539"})}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," S\xe3o tamb\xe9m disponibilizados v\xe1rios ",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/resources/clients.zip",children:"clientes HTTP,"})," em mais de 50 linguagens e frameworks, gerados automaticamente a partir da nossa especifica\xe7\xe3o, que poder\xe3o servir de suporte inicial ao processo de integra\xe7\xe3o."]}),"\n"]}),"\n",(0,a.jsx)(o.h3,{id:"41-autoriza\xe7\xe3o",children:"4.1 Autoriza\xe7\xe3o"}),"\n",(0,a.jsx)(o.p,{children:"Todos os pedidos a efetuar ao API t\xeam de conter obrigatoriamente o header de autoriza\xe7\xe3o abaixo:"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Authorization"}),": Bearer {TOKEN_PLATAFORMA}"]}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["No cliente ",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/",children:"Swagger"}),", o processo de autoriza\xe7\xe3o \xe9 feito inserindo o token de plataforma ap\xf3s clicar no bot\xe3o ",(0,a.jsx)(o.strong,{children:"Authorize"}),"."]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{alt:"img info",src:n(4304).A+"",width:"1132",height:"384"})}),"\n",(0,a.jsxs)(o.p,{children:["Ap\xf3s esta opera\xe7\xe3o, dever\xe3o notar que todos os pedidos subsequentes ao API incluem o header ",(0,a.jsx)(o.em,{children:"Authorization"}),":"]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{alt:"img info",src:n(9051).A+"",width:"1402",height:"204"})}),"\n",(0,a.jsx)(o.h3,{id:"42-autentica\xe7\xe3o",children:"4.2 Autentica\xe7\xe3o"}),"\n",(0,a.jsxs)(o.p,{children:["Antes de efetuar a primeira consulta ao API do ilink, ",(0,a.jsx)(o.strong,{children:"\xe9 obrigat\xf3rio efetuar uma autentica\xe7\xe3o por cliente/NIF"}),". Esta autentica\xe7\xe3o serve de ",(0,a.jsx)(o.em,{children:"handshake"})," inicial entre o cliente e o ilink \xe9 feita com recurso ao endpoint ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Autentica%C3%A7%C3%A3o/postAuthentications",children:"POST /apps/authentications"})}),":"]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{alt:"img info",src:n(2867).A+"",width:"1485",height:"510"})}),"\n",(0,a.jsx)(o.p,{children:"Uma autentica\xe7\xe3o v\xe1lida dever\xe1 retornar esta resposta:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 200 OK\n\n{\n  "success": true,\n  "message": {\n    "code":"e123",\n    "msg":"Integra\xe7\xe3o realizada com sucesso."\n  }\n}\n'})}),"\n",(0,a.jsxs)(o.p,{children:["A autentica\xe7\xe3o tem dura\xe7\xe3o ilimitada (s\xf3 precisa de ser invocada 1 vez por cliente/NIF que acede ao API). Pode tamb\xe9m ser revogada atrav\xe9s do m\xe9todo ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Autentica%C3%A7%C3%A3o/deleteAuthentications",children:"DELETE /apps/authentications"})}),":"]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{alt:"img info",src:n(9054).A+"",width:"1495",height:"328"})}),"\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Se o processo de autentica\xe7\xe3o n\xe3o for conclu\xeddo, ou o header Authorization n\xe3o for enviado nos pedidos ao API, todas as chamadas ser\xe3o recusadas para esse NIF com um erro"}),":"]}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 401 Unauthorized\n\n{\n  "success": false,\n  "errors": [\n    {\n      "code": "e069",\n      "msg": "Autentica\xe7\xe3o inv\xe1lida"\n    }\n  ]\n}\n'})}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.strong,{children:"Nota: Em ambiente de produ\xe7\xe3o \xe9 necess\xe1rio autenticar novamente cada cliente/NIF."})}),"\n"]}),"\n",(0,a.jsx)(o.h2,{id:"5-emiss\xe3o-de-documentos",children:"5. Emiss\xe3o de documentos"}),"\n",(0,a.jsx)(o.h3,{id:"51-\xe2mbito",children:"5.1 \xc2mbito"}),"\n",(0,a.jsx)(o.p,{children:"Permite \xe0 plataforma integradora emitir documentos no ilink, que s\xe3o posteriormente enviados para o seu destinat\xe1rio. O destinat\xe1rio dos documentos tem configurado no portal do ilink para que sistemas externos os documentos devem ser remetidos. Isto significa que o processo de envio de documentos aos ERPs e EDIs adequados de cada cliente \xe9 transparente ao API e fica \xe0 responsabilidade do ilink. Estas configura\xe7\xf5es s\xe3o efetuadas pela equipa de apoio do ilink antes da passagem a produ\xe7\xe3o."}),"\n",(0,a.jsx)(o.p,{children:"A plataforma ilink permite o envio de faturas eletr\xf3nicas em 2 cen\xe1rios distintos:"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Envio de PDF assinado via e-mail para consumidores finais ou empresas privadas"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["Neste cen\xe1rio, n\xe3o ser\xe1 necess\xe1rio criar liga\xe7\xf5es entre outros EDIs para o envio de documentos. Basta indicar ao endpoint de cria\xe7\xe3o de documento o(s) endere\xe7o(s) de e-mail a remeter o mesmo. Para mais informa\xe7\xf5es, consulte a sec\xe7\xe3o ",(0,a.jsx)(o.a,{href:"#53-m%C3%A9todos-de-envio",children:"M\xe9todos de envio"}),"."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Envio de XML CIUS-PT para entidades p\xfablicas (obrigat\xf3rio nos contratos p\xfablicos)"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsx)(o.li,{children:"Neste cen\xe1rio, ser\xe1 necess\xe1rio configurar previamente as liga\xe7\xf5es entre NIFs e possivelmente entre outros brokers EDI externos."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Como s\xe3o enviados os documentos para outros brokers EDI?"}),"\nNa fase de passagem a produ\xe7\xe3o, dever\xe1 ser feito um levantamento de todas as entidades que ir\xe3o receber documentos via EDI, bem como os seus brokers EDI em uso. De seguida, a equipa de apoio (",(0,a.jsx)(o.a,{href:"mailto:apoio@ilink.pt",children:"apoio@ilink.pt"}),") ir\xe1 configurar as liga\xe7\xf5es necess\xe1rias de modo a que os documentos sejam integrados automaticamente no sistema de cada recetor. Antes de enviar documentos para a solu\xe7\xe3o FE-AP da eSPap, ser\xe1 tamb\xe9m necess\xe1rio cada emissor de faturas completar o ",(0,a.jsx)(o.a,{href:"onboarding-feap",children:"processo de ades\xe3o de fornecedores FE-AP"}),"."]}),"\n"]}),"\n",(0,a.jsx)(o.p,{children:"Todos os documentos emitidos ficam dispon\xedveis no portal do ilink tanto na entidade emissora como na entidade recetora dos mesmos."}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota: No nosso ambiente de testes, devem emitir documentos apenas entre as 2 entidades que receberam acessos."})," Caso pretendam verificar o funcionamento do envio de documentos para um consumidor final (NIF arbitr\xe1rio), dever\xe3o sempre emitir o mesmo por uma das entidades que receberam acessos."]}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"IMPORTANTE:"})," Para o envio de documentos a ",(0,a.jsx)(o.strong,{children:"entidades p\xfablicas"}),", recomendamos fortemente implementar os seguintes campos, sob pena de n\xe3o integrar os documentos com certos sistemas:"]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsx)(o.li,{children:"Envio do n\xfamero de compromisso"}),"\n",(0,a.jsx)(o.li,{children:"Envio do ficheiro PDF original da fatura"}),"\n",(0,a.jsx)(o.li,{children:"Envio do n\xfamero de encomenda ou requisi\xe7\xe3o (se aplic\xe1vel)"}),"\n",(0,a.jsx)(o.li,{children:"Envio do Capital Social do fornecedor"}),"\n",(0,a.jsx)(o.li,{children:"Envio do endere\xe7o de e-mail do cliente (apenas para as secretarias do Governo Regional da Madeira)"}),"\n",(0,a.jsx)(o.li,{children:"Envio de todos os dados da morada do fornecedor (rua, c\xf3digo-postal, cidade, etc.)"}),"\n",(0,a.jsx)(o.li,{children:"Envio do GLN do cliente (se aplic\xe1vel)"}),"\n",(0,a.jsx)(o.li,{children:"Possibilidade de reenvio do documento mediante o estado obtido (\xfatil para corrigir e reenviar um documento previamente rejeitado)"}),"\n"]}),"\n",(0,a.jsx)(o.h3,{id:"52-assinatura-digital",children:"5.2 Assinatura digital"}),"\n",(0,a.jsxs)(o.p,{children:["O ilink permite assinar automaticamente os anexos dos documentos emitidos na plataforma (XML e PDF), desde que a entidade emissora tenha adquirido e configurado o selo de um dos provedores de assinaturas digitais qualificadas. Neste momento, apenas o ",(0,a.jsx)(o.a,{href:"https://globaltrustedsign.com/",children:"GTS - Global Trusted Sign"})," \xe9 suportado, mas existem planos de suportar os restantes provedores em Portugal (",(0,a.jsx)(o.a,{href:"https://www.multicert.com/pt/",children:"Multicert"})," e ",(0,a.jsx)(o.a,{href:"https://www.digitalsign.pt/pt",children:"DigitalSign"}),")."]}),"\n",(0,a.jsx)(o.p,{children:"Isto significa que o ERP n\xe3o \xe9 obrigado a integrar com um provedor de assinaturas, deixando (opcionalmente) o processo de certifica\xe7\xe3o \xe0 responsabilidade do ilink. A outra alternativa ser\xe1 o pr\xf3prio ERP efetuar o processo de certifica\xe7\xe3o e enviar os documentos previamente assinados para o ilink."}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," ",(0,a.jsx)(o.strong,{children:"No cen\xe1rio de assinatura via ilink, por defeito, todos os ficheiros resultantes ser\xe3o assinados no momento de entrada (xml e pdf)"}),", e s\xf3 depois remetidos ao cliente. Este processo \xe9 configurado no portal web, ficando fora da responsabilidade do API."]}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"No caso de assinatura via ERP, a assinatura digital do documento ser\xe1 validada a n\xedvel criptogr\xe1fico para todos os documentos que entram no sistema"}),", e um documento com assinatura inv\xe1lida, tanto no XML como no PDF n\xe3o ir\xe1 integrar e retorna sempre um erro via API como o seguinte:"]}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "document": {\n      "code": "e217",\n      "msg": "A assinatura do documento n\xe3o \xe9 v\xe1lida."\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(o.p,{children:["O erro anterior indica que o documento sofreu altera\xe7\xf5es desde o momento que foi assinado, ou que a assinatura do mesmo foi gerada incorretamente. O seguinte ",(0,a.jsx)(o.a,{href:"https://ec.europa.eu/cefdigital/DSS/webapp-demo/validation",children:"validador"})," pode ser utilizado para verificar a validade da assinatura dos documentos. Os formatos de assinatura reconhecidos pelo ilink s\xe3o ",(0,a.jsx)(o.a,{href:"https://www.adobe.com/uk/acrobat/resources/document-files/pdf-types/pades.html",children:"PADES"})," e PKCS7-B (PDF), ou XMLDSig e ",(0,a.jsx)(o.a,{href:"https://en.wikipedia.org/wiki/XAdES",children:"XADES-BES"})," (XML)."]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," Os requisitos legais de assinatura das faturas eletr\xf3nicas est\xe3o dispon\xedveis no ",(0,a.jsx)(o.a,{href:"https://dre.pt/home/-/dre/119622094/details/maximized",children:"Decreto-Lei 28/2019, sec\xe7\xe3o II, artigo 12\xba"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," O ilink assina os documentos PDF em ",(0,a.jsx)(o.a,{href:"https://www.adobe.com/uk/acrobat/resources/document-files/pdf-types/pades.html",children:"PADES"})," e os documentos XML em ",(0,a.jsx)(o.a,{href:"https://en.wikipedia.org/wiki/XAdES",children:"XADES-BES"})," ",(0,a.jsx)(o.a,{href:"https://docs.microsoft.com/en-us/previous-versions/windows/desktop/ms767623%28v=vs.85%29",children:"enveloped"}),"."]}),"\n"]}),"\n",(0,a.jsx)(o.h3,{id:"53-m\xe9todos-de-envio",children:"5.3 M\xe9todos de envio"}),"\n",(0,a.jsx)(o.p,{children:"Ap\xf3s efetuada a autentica\xe7\xe3o com sucesso, estamos em condi\xe7\xf5es de come\xe7ar a enviar documentos.\nO API do ilink possibilita 2 m\xe9todos de envio de documentos:"}),"\n",(0,a.jsx)(o.h4,{id:"a-envio-do-xml-em-formato-ubl-21-cius-pt-ou-ubl-21-peppolbis3---encomendas",children:"a) Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)"}),"\n",(0,a.jsxs)(o.p,{children:["Neste m\xe9todo, o sistema a integrar tem de gerar corretamente o ficheiro XML antes de enviar o mesmo ao ilink. Todos os ficheiros XML enviados por este m\xe9todo ",(0,a.jsx)(o.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"s\xe3o verificados de acordo com o validador oficial da eSPap, vers\xe3o 2.1.2"}),", e o API ir\xe1 retornar um erro caso se verifiquem inconsist\xeancias sint\xe1ticas. A eSPap disponibiliza um ",(0,a.jsx)(o.a,{href:"https://www.espap.gov.pt/Documents/servicos/sp_fin/urn_feap.gov.pt_CIUS-PT_schematron.zip",children:"validador Schematron"})," que implementa todas as valida\xe7\xf5es da ",(0,a.jsx)(o.a,{href:"https://ec.europa.eu/digital-building-blocks/sites/spaces/DIGITAL/pages/467108950/EN+16931+compliance",children:"Norma Europeia EN16931 CIUS"})," e as valida\xe7\xf5es adicionais do CIUS-PT, e est\xe1 dispon\xedvel online ",(0,a.jsx)(o.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"neste link"}),". ",(0,a.jsxs)(o.strong,{children:["Se os ficheiros validam sintaticamente no ",(0,a.jsx)(o.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"validador online"}),", ent\xe3o dever\xe3o validar no ilink, com a exce\xe7\xe3o de valida\xe7\xf5es adicionais colocadas pelo destinat\xe1rio do documento."]})]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," Para incluir um ficheiro ",(0,a.jsx)(o.strong,{children:"PDF"})," na fatura eletr\xf3nica e consultar outros casos de uso, consultar a sec\xe7\xe3o ",(0,a.jsx)(o.a,{href:"#72-cria%C3%A7%C3%A3o-de-documentos-por-envio-do-cius-pt",children:"casos de uso"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," Podem consultar v\xe1rios ",(0,a.jsx)(o.a,{href:"https://www.espap.gov.pt/Imagens/Documento.ashx?id=254",children:"exemplos do CIUS-PT"}),", bem como toda a especifica\xe7\xe3o do CIUS-PT  ",(0,a.jsx)(o.a,{href:"https://www.espap.gov.pt/spfin/normas/Paginas/normas.aspx",children:"aqui"}),"."]}),"\n"]}),"\n",(0,a.jsx)(o.p,{children:"Alguns exemplos de erros  no processo de valida\xe7\xe3o XML:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "document": {\n      "code": "e217",\n      "msg": "[BR-CO-25]-Caso o valor a pagar (BT-115) seja positivo, deve indicar a data de vencimento (BT-9) ou a nota da condi\xe7\xe3o de pagamento (BT-20)."\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "document": {\n      "code": "e217",\n      "msg": "[DT-CIUS-PT-166]-Amount due for payment (BT-115) = Invoice total amount with VAT (BT-112) -Paid amount (BT-113) +Rounding amount (BT-114), with an acceptance range of 1.00 \u20ac (it does not mean that this tolerance is accepted by the customer)."\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(o.p,{children:["O m\xe9todo a utilizar para envio do XML \xe9 o ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"POST /apps/documentsUBL"})}),".  Neste contexto, ",(0,a.jsx)(o.strong,{children:"a chave p\xfablica identifica o emissor do documento"})," e tem de ser a chave associada ao NIF do emissor do documento especificado no XML (",(0,a.jsx)(o.code,{children:"AccountingSupplierParty>Party>PartyTaxScheme>CompanyID"})," para faturas/notas de cr\xe9dito, ou ",(0,a.jsx)(o.code,{children:"AccountingCustomerParty>Party>PartyTaxScheme>CompanyID"})," para encomendas). Caso isto n\xe3o se verifique, o API ir\xe1 retornar o seguinte erro:"]}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "supplier": {\n      "code": "e199",\n      "msg": "A entidade criadora do documento deve ser cliente ou fornecedor do novo documento."\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(o.p,{children:["Se o XML for v\xe1lido e respeitar todas as valida\xe7\xf5es da norma, bem como todas as ",(0,a.jsx)(o.a,{href:"#55-valida%C3%A7%C3%B5es-adicionais",children:"regras de neg\xf3cio adicionais do recetor"}),", o API devolve uma resposta de sucesso, juntamente com os dados principais do documento criado:"]}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 201 Created\n\n{\n  "success": true,\n  "message": {\n    "code": "s011",\n    "msg": "Documento criado com sucesso"\n  },\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016",\n      "number": "7411111",\n      "emission_date": "2021-04-15",\n      "type_document_fact": {\n        "id": "5c9cb870a5ef57.36583702",\n        "code": "380",\n        "alias": "invoice",\n        "type": "FT",\n        "description": "Fatura"\n      },\n      "type_document": {\n        "alias": "issued",\n        "description": "Emitido"\n      },\n      "state_document": {\n        "id": "5c9cb878745b16.4225687",\n        "alias": "sent",\n        "description": "Enviado ao cliente."\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," Um documento \xe9 enviado com sucesso ao destinat\xe1rio via EDI quando o campo ",(0,a.jsx)(o.code,{children:"state_document.alias"})," tem o valor ",(0,a.jsx)(o.code,{children:"sent"})," ou ",(0,a.jsx)(o.code,{children:"accepted"}),". Caso se apenas pretenda que o documento seja enviado via e-mail, o estado do documento deve ser ignorado, e devemos alternativamente consultar os e-mails enviados atrav\xe9s da ",(0,a.jsx)(o.a,{href:"#59-consulta-de-estado-de-documentos-emitidos",children:"consulta de estado"})," do mesmo."]}),"\n"]}),"\n",(0,a.jsx)(o.h4,{id:"b-envio-dos-dados-estruturados-do-documento",children:"b) Envio dos dados estruturados do documento"}),"\n",(0,a.jsxs)(o.p,{children:["Ao adotar esta op\xe7\xe3o, o ERP dispensa de efetuar a gera\xe7\xe3o completa do XML, ficando assim o ilink respons\xe1vel por gerar o XML final. Assim, o ERP apenas necessita de enviar ao ilink todos os dados referentes ao documento. O endpoint a adotar aqui ser\xe1 o ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"POST /apps/documents"})})]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{alt:"img info",src:n(3845).A+"",width:"1490",height:"895"})}),"\n",(0,a.jsxs)(o.p,{children:["A especifica\xe7\xe3o deste m\xe9todo \xe9 extensa, pois cobre todos os campos poss\xedveis de uma fatura/encomenda, que est\xe3o devidamente documentados acima. Todos os documentos criados por este endpoint est\xe3o sujeitos \xe0s mesmas valida\xe7\xf5es que os documentos enviados pelo m\xe9todo ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"POST /apps/documentsUBL"})}),", ou seja, o XML resultante dos dados inseridos ser\xe1 validado de acordo com o ",(0,a.jsx)(o.a,{href:"https://www.espap.gov.pt/spfin/normas/Paginas/normas.aspx",children:"validador oficial da eSPap"}),", que pode ser consultado online ",(0,a.jsx)(o.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"neste link"}),", e segundo as ",(0,a.jsx)(o.a,{href:"#55-valida%C3%A7%C3%B5es-adicionais",children:"regras de neg\xf3cio adicionais"})," do recetor do documento, caso existam."]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," Para incluir um ficheiro ",(0,a.jsx)(o.strong,{children:"PDF"})," e outras situa\xe7\xf5es habituais, consultar a sec\xe7\xe3o ",(0,a.jsx)(o.a,{href:"#71-cria%C3%A7%C3%A3o-de-documentos-por-envio-de-dados",children:"casos de uso"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," \xc9 poss\xedvel enviar v\xe1rios anexos num documento atrav\xe9s do campo ",(0,a.jsx)(o.code,{children:"files[]"})," (ver especifica\xe7\xe3o acima). Contudo, a representa\xe7\xe3o visual do documento (i.e PDF original da fatura usado na impress\xe3o) deve ser enviado sempre no campo ",(0,a.jsx)(o.code,{children:"file"}),", sendo o campo ",(0,a.jsx)(o.code,{children:"files[]"})," reservado para ficheiros adicionais (notas de encomenda, avisos de despacho, guias de transporte, etc.). ",(0,a.jsx)(o.strong,{children:"Se o emissor do documento tem uma assinatura digital ativa no ilink, todos os anexos ser\xe3o assinados por defeito."})]}),"\n"]}),"\n",(0,a.jsx)(o.h3,{id:"54-envio-do-documento",children:"5.4 Envio do documento"}),"\n",(0,a.jsx)(o.h4,{id:"541-envio-via-edi",children:"5.4.1 Envio via EDI"}),"\n",(0,a.jsxs)(o.p,{children:["Um documento, ap\xf3s cria\xe7\xe3o com sucesso por qualquer um dos m\xe9todos acima  (",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"envio de XML"})," ou ",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"envio de dados"}),"), ser\xe1 enviado automaticamente ao destinat\xe1rio por EDI. Contudo, em casos pontuais, este poder\xe1 n\xe3o ser entregue imediatamente ao destinat\xe1rio via EDI devido a configura\xe7\xf5es em falta e/ou outras anomalias na plataforma ilink ou no sistema do recetor. Caso isto se verifique, ser\xe1 devolvido um campo ",(0,a.jsx)(o.code,{children:"to_send_status"})," na resposta do documento a detalhar a situa\xe7\xe3o:"]}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 201 OK\n\n{\n  "success": true,\n  "message": {\n    "code": "s011",\n    "msg": "Documento criado com sucesso"\n  },\n  "response": {\n    "data": {\n      "id":"60796c3c2a6fa2.53909016",\n      "state_document": {\n        "id": "5c9cb870f34b16.42025494",\n        "alias": "tosend",\n        "description": "Por enviar ao cliente."\n      },\n      "to_send_status": {\n        "code": "sent_connection",\n        "title": "Aguardar a aceita\xe7\xe3o de liga\xe7\xe3o com o destinat\xe1rio do documento."\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," Pode-se verificar que o documento ",(0,a.jsx)(o.strong,{children:"N\xc3O"})," foi entregue via EDI pois o campo ",(0,a.jsx)(o.code,{children:"state_document.alias"})," assume o valor ",(0,a.jsx)(o.code,{children:"tosend"})," e o motivo de erro encontra-se descrito no campo ",(0,a.jsx)(o.code,{children:"to_send_status"}),". Nesta situa\xe7\xe3o, \xe9 necess\xe1rio primeiro concluir a liga\xe7\xe3o EDI com o destinat\xe1rio e depois proceder ao reenvio."]}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["Os motivos poss\xedveis (",(0,a.jsx)(o.code,{children:"code"}),") para um documento n\xe3o ser entregue s\xe3o:"]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.code,{children:"sent_connection"}),", ",(0,a.jsx)(o.code,{children:"no_connection"}),": Liga\xe7\xe3o com o destinat\xe1rio em falta"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.code,{children:"registered_entity"}),": O destinat\xe1rio n\xe3o est\xe1 registado no ilink"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.code,{children:"received_pay_transactions"}),": O destinat\xe1rio suporta os custos dos documentos recebidos mas n\xe3o disp\xf5e de transa\xe7\xf5es suficientes para o envio do documento"]}),"\n"]}),"\n",(0,a.jsx)(o.p,{children:"Ap\xf3s regularizar a situa\xe7\xe3o de erro, ser\xe1 poss\xedvel enviar o documento novamente (ver sec\xe7\xe3o de [reenvio de documentos]#56-criareditar-documento)."}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota"}),": O estado do documento (",(0,a.jsx)(o.code,{children:"state_document"}),") \xe9 apenas aplic\xe1vel a envios EDI. Caso o documento seja enviado para um cliente arbitr\xe1rio via e-mail (PDF), o estado de envio n\xe3o reflete o envio do e-mail (ver sec\xe7\xe3o seguinte)."]}),"\n"]}),"\n",(0,a.jsx)(o.h4,{id:"542-envio-via-e-mail",children:"5.4.2 Envio via e-mail"}),"\n",(0,a.jsxs)(o.p,{children:["Um documento, ap\xf3s cria\xe7\xe3o com sucesso (HTTP status 201) por qualquer um dos m\xe9todos acima (",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"envio de XML"})," ou ",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"envio de dados"}),"), ser\xe1 remetido via e-mail ao destinat\xe1rio caso seja especificado o campo ",(0,a.jsx)(o.code,{children:"send_by_email"})," com o valor ",(0,a.jsx)(o.code,{children:"1"}),". O(s) endere\xe7o(s) do(s) recetor(es) do documento pode(m) ser especificado(s) de 3 modos:"]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["no campo ",(0,a.jsx)(o.code,{children:"additional_emails[]"})," (em ambos os m\xe9todos de envio)"]}),"\n",(0,a.jsxs)(o.li,{children:["no campo ",(0,a.jsx)(o.code,{children:"customer[email]"})," (apenas no m\xe9todo de envio de dados)"]}),"\n",(0,a.jsxs)(o.li,{children:["no elemento ",(0,a.jsx)(o.code,{children:"cac:AccountingCustomerParty/cac:Party/cac:Contact/cbc:ElectronicMail"})," do XML (apenas no m\xe9todo de envio de XML)."]}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["Para consultar o envio dos e-mails e leitura dos mesmos para o cliente, ver sec\xe7\xe3o b) de ",(0,a.jsx)(o.a,{href:"#59-consulta-de-estado-de-documentos-emitidos",children:"consulta de estado de documentos emitidos"}),"."]}),"\n",(0,a.jsx)(o.h4,{id:"543-cria\xe7\xe3o-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas",children:"5.4.3 Cria\xe7\xe3o de documentos e consumo de assinaturas digitais qualificadas"}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsxs)(o.strong,{children:["Esta sec\xe7\xe3o \xe9 apenas relevante para clientes que utilizam o ilink para assinar digitalmente os documentos. ",(0,a.jsx)(o.a,{href:"#52-assinatura-digital",children:"Ver detalhes"}),"."]})}),"\n",(0,a.jsxs)(o.p,{children:["Caso esteja configurada uma assinatura digital qualificada no ilink, todos os documentos ser\xe3o assinados no momento da sua cria\xe7\xe3o, incluindo todos os ficheiros resultantes da fatura eletr\xf3nica (xml e pdf). Dado que a assinatura dos documentos n\xe3o \xe9 obrigat\xf3ria por lei em todos os cen\xe1rios de utiliza\xe7\xe3o, \xe9 poss\xedvel controlar individualmente a assinatura dos ficheiros xml e pdf no momento da cria\xe7\xe3o do documento com recurso aos os campos ",(0,a.jsx)(o.code,{children:"disable_xml_sign"})," e ",(0,a.jsx)(o.code,{children:"disable_pdf_sign"}),", dispon\xedveis em ambos os m\xe9todos de cria\xe7\xe3o de documento (",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"XML"})," ou ",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"dados"}),"). Isto permite reduzir o consumo de assinaturas, bem como otimizar o processo de cria\xe7\xe3o de documentos."]}),"\n",(0,a.jsx)(o.p,{children:"Ou seja:"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["No envio de fatura digital via ",(0,a.jsx)(o.strong,{children:"PDF assinado para um consumidor final ou cliente privado"}),", n\xe3o ser\xe1 obrigat\xf3rio assinar o ficheiro XML resultante, pelo que recomendamos a utiliza\xe7\xe3o do campo ",(0,a.jsx)(o.code,{children:"disable_xml_sign: 1"}),"."]}),"\n",(0,a.jsxs)(o.li,{children:["No envio de fatura eletr\xf3nica para a ",(0,a.jsx)(o.strong,{children:"Administra\xe7\xe3o P\xfablica via EDI"})," (exemplo eSPap), n\xe3o \xe9 obrigat\xf3rio assinar o documento, no entanto recomenda-se a assinatura de ambos os ficheiros por motivos de seguran\xe7a adicional e integridade."]}),"\n",(0,a.jsx)(o.li,{children:(0,a.jsx)(o.strong,{children:"Os campos acima apenas t\xeam efeito quando o emissor do documento usa uma assinatura digital qualificada no ilink."})}),"\n"]}),"\n",(0,a.jsx)(o.h3,{id:"55-valida\xe7\xf5es-adicionais",children:"5.5 Valida\xe7\xf5es adicionais"}),"\n",(0,a.jsx)(o.p,{children:"O recetor da fatura pode configurar no ilink requisitos adicionais para determinados campos (regras de neg\xf3cio), mesmo quando estes n\xe3o s\xe3o obrigat\xf3rios na especifica\xe7\xe3o CIUS-PT. Por exemplo, um cliente pode definir que apenas aceita faturas com o ficheiro PDF em anexo ou com o n\xfamero de compromisso especificado. \xc9 fundamental que estes requisitos sejam acordados previamente com o cliente/destinat\xe1rio antes da entrada em produ\xe7\xe3o, de forma a evitar erros de integra\xe7\xe3o."}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.strong,{children:"Caso o recetor do documento obrigue a presen\xe7a de algum campo n\xe3o especificado no XML, o API ir\xe1 retornar um erro como abaixo e o documento n\xe3o ser\xe1 gerado:"})}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "commitment_number": {\n      "code": "e048",\n      "msg": "O n\xfamero de compromisso \xe9 obrigat\xf3rio."\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(o.h3,{id:"56-criareditar-documento",children:"5.6 Criar/editar documento"}),"\n",(0,a.jsx)(o.p,{children:"Um documento pode ser editado e reenviado ao destinat\xe1rio"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["se ",(0,a.jsx)(o.strong,{children:"ainda n\xe3o foi enviado"})," ao cliente final"]}),"\n",(0,a.jsxs)(o.li,{children:["ou se ",(0,a.jsx)(o.strong,{children:"j\xe1 foi enviado ao cliente e o cliente pediu uma regulariza\xe7\xe3o"})," do mesmo"]}),"\n"]}),"\n",(0,a.jsx)(o.p,{children:"Em termos pr\xe1ticos, a possibilidade de reenvio pode ser consultada atrav\xe9s do campo de resposta seguinte do documento:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:"\"state_edi_document\": {\n  \"alias\": <estado> // estados poss\xedveis de reenvio: 'regularization' ou 'reception' ou 'error'\n}\n"})}),"\n",(0,a.jsxs)(o.p,{children:["Para consultar o estado de um documento, ver sec\xe7\xe3o de ",(0,a.jsx)(o.a,{href:"#59-consulta-de-estado-de-documentos-emitidos",children:"consulta de estado de documentos emitidos"}),"."]}),"\n",(0,a.jsxs)(o.p,{children:["Para editar um documento existente, basta repetir o pedido ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"POST /apps/documentsUBL"})})," ou ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"POST /apps/documents"})})," com os dados corrigidos, mantendo o ",(0,a.jsx)(o.strong,{children:"n\xfamero, tipo e data de emiss\xe3o"})," do documento anterior:"]}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-javascript",children:'HTTP status: 200 OK\n\n{\n  "success": true,\n  "message": {\n    "code": "s012",\n    "msg": "Documento editado com sucesso"\n  },\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016",\n      "number": "7411111",\n      "emission_date": "2021-04-16",\n      "type_document_fact": {\n        "id": "5c9cb870a5ef57.36583702",\n        "code": "380",\n        "alias": "invoice",\n        "type": "FT",\n        "description": "Fatura"\n      },\n      "type_document": {\n        "alias": "issued",\n        "description": "Emitido"\n      },\n      "state_document": {\n        "id": "5c9cb870f34b16.42025494",\n        "alias": "tosend",\n        "description": "Por enviar ao cliente."\n      }\n    }\n  }\n}\n\n'})}),"\n",(0,a.jsx)(o.p,{children:"Caso o documento n\xe3o seja eleg\xedvel para edi\xe7\xe3o (i.e j\xe1 foi enviado ou foi aceite pelo cliente final), ser\xe1 apresentado um erro ao tentar reenviar:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "number": {\n      "code": "e200",\n      "msg": "Documento j\xe1 existe."\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(o.h3,{id:"57-acesso-a-documentos-emitidos",children:"5.7 Acesso a documentos emitidos"}),"\n",(0,a.jsxs)(o.p,{children:["Quando um documento \xe9 registado com sucesso, ser\xe1 sempre devolvido um ",(0,a.jsx)(o.code,{children:"id"})," nas respostas, que identifica o mesmo perante o ilink. \xc9 \xfatil guardar este identificador para consultas futuras ao documento."]}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 201 Created\n\n{\n  "success": true,\n  "message": {\n    "code": "s011",\n    "msg": "Documento criado com sucesso"\n  },\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016"\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(o.p,{children:["O API permite tamb\xe9m aceder a todos os dados (inclusive ao XML e PDF gerados) de todos os documentos previamente emitidos. Para tal, dever\xe3o usar o m\xe9todo ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument",children:"GET /apps/documents/{id}"})}),". O ",(0,a.jsx)(o.code,{children:"id"})," recebido na cria\xe7\xe3o do documento deve ser usado como par\xe2metro aqui para aceder ao documento em quest\xe3o."]}),"\n",(0,a.jsx)(o.p,{children:"Todos os dados retornados por este m\xe9todo est\xe3o dispon\xedveis na especifica\xe7\xe3o acima."}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota"}),": Caso a entidade emissora do documento tenha configurado a assinatura autom\xe1tica de documentos no ilink, os URLs de acesso ao XML e ao PDF j\xe1 retornam os ficheiros assinados."]}),"\n"]}),"\n",(0,a.jsx)(o.h3,{id:"58-consulta-de-documentos-emitidos-no-portal-opcional",children:"5.8 Consulta de documentos emitidos no portal (opcional)"}),"\n",(0,a.jsxs)(o.p,{children:["Os documentos podem tamb\xe9m ser consultados no ",(0,a.jsx)(o.a,{href:"https://ilink.acin.pt",children:"portal de testes do ilink"})," usando as credenciais das entidades que vos foram enviadas. Aqui podem validar visualmente se a informa\xe7\xe3o apresentada est\xe1 coerente com os dados enviados via API:"]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{alt:"img info",src:n(5635).A+"",width:"1596",height:"839"})}),"\n",(0,a.jsx)(o.p,{children:"Para aceder aos anexos de um documento, dever\xe3o aceder ao documento da tabela acima, e aceder ao \xedcone da lupa:"}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{alt:"img info",src:n(7084).A+"",width:"1605",height:"838"})}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," Os documentos dever\xe3o estar presentes tanto na entidade emissora (sec\xe7\xe3o de documentos emitidos), bem como na entidade recetora (sec\xe7\xe3o de documentos recebidos)."]}),"\n"]}),"\n",(0,a.jsx)(o.h3,{id:"59-consulta-de-estado-de-documentos-emitidos",children:"5.9 Consulta de estado de documentos emitidos"}),"\n",(0,a.jsx)(o.p,{children:"\xc9 tamb\xe9m poss\xedvel aceder ao estado atual dos documentos previamente emitidos. Esta opera\xe7\xe3o permite ao emissor do documento consultar se o documento foi aceite pelo cliente, ou se est\xe1 pendente de reenvio/regulariza\xe7\xe3o, bem como os motivos que levaram a tal."}),"\n",(0,a.jsx)(o.h4,{id:"591-consulta-de-estado-de-documento-enviado-via-edi",children:"5.9.1 Consulta de estado de documento enviado via EDI"}),"\n",(0,a.jsxs)(o.p,{children:["O ilink contempla 4 estados simplificados  de documento na propriedade ",(0,a.jsx)(o.code,{children:"state_document"}),":"]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Por enviar"})," (",(0,a.jsx)(o.code,{children:"tosend"}),") - o documento n\xe3o foi enviado ao cliente. Provavelmente significa que falta alguma configura\xe7\xe3o no ilink, emissor/recetor n\xe3o autorizam liga\xe7\xe3o entre eles, ou que alguma das entidades presentes no documento n\xe3o tem transa\xe7\xf5es suficientes para proceder ao envio."]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Enviado"})," (",(0,a.jsx)(o.code,{children:"sent"}),") - o documento foi enviado ao cliente e est\xe1 pendente de aceita\xe7\xe3o."]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Aceite"})," (",(0,a.jsx)(o.code,{children:"accepted"}),") - o documento foi enviado e o cliente aceitou o mesmo. ",(0,a.jsx)(o.strong,{children:"Estado final"}),"."]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Recusado"})," (",(0,a.jsx)(o.code,{children:"rejected"}),") - o documento foi enviado e o cliente rejeitou o mesmo devido a uma incoer\xeancia. O motivo de recusa \xe9 disponibilizado na resposta no campo ",(0,a.jsx)(o.code,{children:"reasons"}),". ",(0,a.jsx)(o.a,{href:"public:integrations-api#criar_editar_documento",children:"O documento poder\xe1 ser enviado novamente"})," caso seja solicitada uma regulariza\xe7\xe3o do mesmo."]}),"\n"]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," O ilink devolve tamb\xe9m o ",(0,a.jsx)(o.strong,{children:"estado de processamento EDI"})," atual do documento (",(0,a.jsx)(o.code,{children:"state_edi_document"}),"), que \xe9 independente dos estados acima. Para mais informa\xe7\xe3o, consultar o ",(0,a.jsx)(o.a,{href:"https://www.espap.gov.pt/Imagens/Documento.ashx?id=269",children:"Guia de Transmiss\xe3o de Documentos FE-AP, p\xe1gina 7"}),". Contudo, a leitura do estado EDI nem sempre \xe9 relevante para os softwares de fatura\xe7\xe3o."]}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["Existem 3 abordagens para aceder ao estado de um documento previamente emitido: ",(0,a.jsx)(o.strong,{children:"Consulta individual"}),", ",(0,a.jsx)(o.strong,{children:"Webhook de mudan\xe7a de estado"})," e ",(0,a.jsx)(o.strong,{children:"Reporte de estados"}),"."]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["Na ",(0,a.jsx)(o.strong,{children:"Consulta individual de estado"}),", basta efetuar a chamada ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument",children:"GET /apps/documents/{id}"})}),". O ",(0,a.jsx)(o.code,{children:"id"})," recebido na cria\xe7\xe3o do documento deve ser usado como par\xe2metro para aceder ao documento em quest\xe3o. O estado \xe9 devolvido no campo ",(0,a.jsx)(o.code,{children:"state_document"})," (ver especifica\xe7\xe3o acima). Este m\xe9todo apenas permite consultar o estado de um documento de cada vez, e como tal n\xe3o \xe9 recomendado para clientes que emitem um volume elevado de documentos."]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["No ",(0,a.jsx)(o.strong,{children:"Webhook de mudan\xe7a de estado"}),", o ilink tem a iniciativa de informar ao emissor do documento cada vez que o mesmo muda de estado. Esta \xe9 a op\xe7\xe3o recomendada em termos de desempenho e rapidez, mas pode n\xe3o ser vi\xe1vel caso o sistema a integrar perten\xe7a a numa rede n\xe3o exposta publicamente ao ilink. Para mais informa\xe7\xe3o, consultar a sec\xe7\xe3o ",(0,a.jsx)(o.a,{href:"webhooks-ilink",children:"Webhooks"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["No ",(0,a.jsx)(o.strong,{children:"Reporte de estados"}),", a aplica\xe7\xe3o a integrar tem a iniciativa de consultar os diversos eventos que levaram \xe0s altera\xe7\xf5es de estado dos documentos emitidos. Para tal, basta efetuar a chamada ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Hist%C3%B3rico%20de%20estados/getStatesReport",children:"GET /apps/states-report/documents"})}),". Cada evento identifica o documento e o estado alterados. \xc9 poss\xedvel filtrar os eventos retornados por ",(0,a.jsx)(o.code,{children:"id"})," de documento, n\xfamero de documento, intervalos de datas, entre outros (ver especifica\xe7\xe3o acima). Este m\xe9todo permite a aplica\xe7\xe3o consultar o estado de v\xe1rios documentos em simult\xe2neo."]}),"\n",(0,a.jsxs)(o.p,{children:["De modo a facilitar a utiliza\xe7\xe3o do reporte de estados, \xe9 adicionalmente disponibilizado o endpoint de leitura de eventos ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Hist%C3%B3rico%20de%20estados/postStatesReportRead",children:"POST /apps/states-report/documents/read"})}),", que permite marcar um ou mais ",(0,a.jsx)(o.code,{children:"id"}),"s de evento obtidos acima como lido(s). Os eventos marcados como lidos n\xe3o s\xe3o retornados novamente no endpoint de reporte de estados, facilitando a consulta futura. Esta op\xe7\xe3o \xe9 uma alternativa escal\xe1vel para os sistemas que n\xe3o podem implementar Webhooks."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(o.h4,{id:"592-consulta-de-estado-de-documento-enviado-via-e-mail",children:"5.9.2 Consulta de estado de documento enviado via e-mail"}),"\n",(0,a.jsxs)(o.p,{children:["No cen\xe1rio de envio de documentos por e-mail, \xe9 poss\xedvel consultar o registo de envio e de leitura dos e-mails enviados ao cliente. ",(0,a.jsxs)(o.strong,{children:["Note-se que o estado do documento retornado (",(0,a.jsx)(o.code,{children:"state_document"}),") n\xe3o \xe9 aplic\xe1vel neste cen\xe1rio"]}),", pois o documento por norma n\xe3o \xe9 enviado via EDI, e como tal, o seu estado de envio ser\xe1 habitualmente ",(0,a.jsx)(o.code,{children:"to_send"}),". Este estado deve ser ignorado a favor das abordagens abaixo."]}),"\n",(0,a.jsxs)(o.p,{children:["Existem duas abordagens para aceder ao registo de e-mails enviados de um documento: ",(0,a.jsx)(o.strong,{children:"Consulta individual"}),"  e  ",(0,a.jsx)(o.strong,{children:"Consulta de hist\xf3rico de documento"}),"."]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["Na ",(0,a.jsx)(o.strong,{children:"Consulta individual"}),", basta efetuar a chamada ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument",children:"GET /apps/documents/{id}"})}),". O ",(0,a.jsx)(o.code,{children:"id"})," recebido na cria\xe7\xe3o do documento deve ser usado como par\xe2metro para aceder ao documento em quest\xe3o. Na resposta, devem aceder \xe0 propriedade ",(0,a.jsx)(o.code,{children:"emails"}),", que retorna uma lista das mensagens enviadas e o seu estado de rece\xe7\xe3o e leitura.  Este m\xe9todo apenas permite consultar o estado de um documento de cada vez e tem as mesmas limita\xe7\xf5es que a consulta individual de documentos da sec\xe7\xe3o anterior:"]}),"\n"]}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'HTTP status: 200 OK\n\n{\n  "success": true,\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016",\n      ...\n      "emails": [\n        {\n          "id": "634672bab0f3b8.40302642",\n          "b_open": true, // true caso o email tenha sido lido pelo recetor\n          "b_sent": true, // true caso o email tenha sido enviado com sucesso\n          "created_at": "2022-10-12 08:54:34", // data e hora de envio do email\n          "opened_at": "2022-10-12 09:14:16", // data e hora de leitura do email\n          "address": {\n            "emails": ["joao.freitas@email.com"], // endere\xe7o de envio\n          }\n        }\n      ]\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," Certos clientes de e-mail (Outlook, etc.) podem bloquear o registo de leitura dos e-mails, ficando o ",(0,a.jsx)(o.code,{children:"b_open"})," a false mesmo que o e-mail tenha sido aberto em algumas situa\xe7\xf5es."]}),"\n"]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["Na ",(0,a.jsx)(o.strong,{children:"Consulta de hist\xf3rico de documento"})," \xe9 poss\xedvel consultar todas as altera\xe7\xf5es processuais de um determinado documento. Este hist\xf3rico ir\xe1 listar todas as altera\xe7\xf5es de estado que ocorreram no documento por ordem cronol\xf3gica, bem como os registos dos envios de e-mail para o destinat\xe1rio, o que permite um rastreio completo de auditoria. Pode ser acedido atrav\xe9s de ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocumentHistory",children:"GET /apps/documents/{id}/history"})}),"."]}),"\n"]}),"\n",(0,a.jsx)(o.h2,{id:"6-rece\xe7\xe3o-de-documentos",children:"6. Rece\xe7\xe3o de documentos"}),"\n",(0,a.jsx)(o.h3,{id:"61-\xe2mbito",children:"6.1 \xc2mbito"}),"\n",(0,a.jsx)(o.p,{children:"Esta funcionalidade permite dar entrada autom\xe1tica aos documentos de fatura\xe7\xe3o no sistema ERP do recetor, facilitando a integra\xe7\xe3o direta nos sistemas contabil\xedsticos. Adicionalmente, possibilita a comunica\xe7\xe3o dos estados de aceita\xe7\xe3o dos documentos ao respetivo emissor (pago, aceite, recusado, entre outros)."}),"\n",(0,a.jsx)(o.p,{children:"Neste fluxo de integra\xe7\xe3o, recomendamos que sejam implementados os seguintes aspetos:"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Leitura e processamento de dados"}),": Extrair informa\xe7\xf5es do XML ou dados estruturados do documento para registar corretamente as informa\xe7\xf5es necess\xe1rias no ERP"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Comunica\xe7\xe3o do estado de integra\xe7\xe3o"}),": Informar o ilink sobre o estado do processo de integra\xe7\xe3o do documento"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Gest\xe3o do estado de aceita\xe7\xe3o"}),": Comunicar o estado de aceita\xe7\xe3o do documento, incluindo o envio de mensagens detalhadas em caso de erro ou rejei\xe7\xe3o"]}),"\n"]}),"\n",(0,a.jsx)(o.h3,{id:"62-m\xe9todos-de-rece\xe7\xe3o",children:"6.2 M\xe9todos de rece\xe7\xe3o"}),"\n",(0,a.jsxs)(o.p,{children:["Permite consultar e integrar documentos no sistema em quest\xe3o.  A rece\xe7\xe3o de documentos pode ser efetuada por 2 m\xe9todos: ",(0,a.jsx)(o.strong,{children:"Consulta manual de documentos"})," ou ",(0,a.jsx)(o.strong,{children:"Webhook de rece\xe7\xe3o"}),"."]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsx)(o.li,{children:(0,a.jsx)(o.strong,{children:"a) Consulta manual de documentos"})}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["Neste modo, \xe9 necess\xe1rio aceder ao endpoint ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocuments",children:"GET /apps/documents"})}),". \xc9 poss\xedvel especificar diversos par\xe2metros de pesquisa de modo a filtrar os resultados obtidos. A resposta deste m\xe9todo inclui os dados principais dos documentos, e adicionalmente a pagina\xe7\xe3o atrav\xe9s das propriedades ",(0,a.jsx)(o.code,{children:"rows"})," (n\xfamero de elementos por p\xe1gina) e ",(0,a.jsx)(o.code,{children:"page"})," (n\xfamero da p\xe1gina a consultar). Consulte a especifica\xe7\xe3o acima para mais detalhes."]}),"\n",(0,a.jsxs)(o.p,{children:["Para consultar os detalhes de um documento, bem como os links para os ficheiros XML e PDF do mesmo, dever\xe1 ser utilizado o m\xe9todo  ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument",children:"GET /apps/documents/{id}"})}),", usando um dos ",(0,a.jsx)(o.strong,{children:"IDs"})," retornados na lista de documentos anterior."]}),"\n",(0,a.jsx)(o.p,{children:"O endpoint de consulta pode ser acedido periodicamente (num processo em segundo plano), ou mediante a consulta de um utilizador no sistema (em tempo real)."}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota: Aqui, a chave p\xfablica \xe9 usada no contexto da entidade recetora dos documentos"}),", ou seja, dever\xe3o utilizar a chave p\xfablica que identifica a entidade que acede os documentos recebidos."]}),"\n"]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.strong,{children:"Importante: Recomendamos uma utiliza\xe7\xe3o respons\xe1vel deste endpoint. Chamadas excessivas a este recurso s\xe3o de evitar, e poder\xe3o levar a 'time-outs' e restri\xe7\xf5es de acesso, consoante o nosso acordo de interoperabilidade."})}),"\n"]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsx)(o.li,{children:(0,a.jsx)(o.strong,{children:"b) Webhook de rece\xe7\xe3o (recomendado)"})}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["Neste modo, o ilink toma a iniciativa de comunicar ao ERP quando chega um novo documento ao cliente, dispensando consultas frequentes ao endpoint ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocuments",children:"GET /apps/documents"})}),". Para mais informa\xe7\xe3o, consultar a sec\xe7\xe3o ",(0,a.jsx)(o.a,{href:"webhooks-ilink",children:"Webhooks"}),"."]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," Segundo especifica\xe7\xe3o, ser\xe3o retornados os dados dos documentos recebidos num formato estruturado, bem como os URLs p\xfablicos para o acesso aos ficheiros XML e PDF do documento."]}),"\n"]}),"\n",(0,a.jsx)(o.h3,{id:"63-importa\xe7\xe3o-e-aceita\xe7\xe3o",children:"6.3 Importa\xe7\xe3o e aceita\xe7\xe3o"}),"\n",(0,a.jsx)(o.p,{children:"Ap\xf3s consultar o documento pretendido, \xe9 recomendado que o ERP comunique o estado de processamento do mesmo ao ilink, ou seja, se este integrou corretamete no sistema ou se \xe9 necess\xe1rio retificar/regularizar o documento. Para tal, s\xe3o necess\xe1rios 2 passos:"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.strong,{children:"1. Comunicar o estado do documento"})}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["\xc9 feito com o pedido ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentsAccepted",children:"POST /apps/documents/{id}/accepted"})}),". Aqui \xe9 indicado se o documento foi aceite ou n\xe3o, e caso contr\xe1rio, o motivo que levou \xe0 sua rejei\xe7\xe3o"]}),"\n",(0,a.jsx)(o.li,{children:"\xc9 obrigat\xf3rio indicar o motivo de rejei\xe7\xe3o de um documento caso n\xe3o seja aceite"}),"\n",(0,a.jsx)(o.li,{children:"Um documento rejeitado poder\xe1 ser reenviado pelo emissor com os dados corrigidos"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.strong,{children:"2. Comunicar a importa\xe7\xe3o do documento (apenas na aceita\xe7\xe3o com sucesso)"})}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["Caso o passo anterior seja conclu\xeddo com sucesso (i.e. o documento est\xe1 em condi\xe7\xf5es de ser integrado no ERP), dever\xe3o invocar o m\xe9todo ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocuments",children:"POST /apps/documents/{id}"})})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," N\xe3o \xe9 necess\xe1rio importar um documento rejeitado."]}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["A correta comunica\xe7\xe3o de documentos aceites e/ou importados cria um hist\xf3rico de auditoria e facilita o consumo do API, dado que, caso estejam a adotar a rece\xe7\xe3o de documentos pelo m\xe9todo de consulta manual, quaisquer documentos que tenham sido importados ou rejeitados n\xe3o s\xe3o devolvidos novamente em consultas futuras. ",(0,a.jsxs)(o.strong,{children:["Ou seja, as chamadas a ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocuments",children:"GET /apps/documents"})})," n\xe3o devolvem documentos previamente rejeitados ou importados"]}),"."]}),"\n",(0,a.jsx)(o.p,{children:"A imagem abaixo demonstra como as opera\xe7\xf5es realizadas pelo ERP s\xe3o registadas no portal do ilink:"}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{alt:"img info",src:n(2825).A+"",width:"1468",height:"500"})}),"\n",(0,a.jsx)(o.h3,{id:"64-estados-de-processo-opcional",children:"6.4 Estados de Processo (opcional)"}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota"}),": Esta funcionalidade \xe9 opcional e tem car\xe1cter meramente informativo, n\xe3o afectando o processo de recep\xe7\xe3o de documentos."]}),"\n"]}),"\n",(0,a.jsx)(o.p,{children:"O ilink permite criar estados de documento personaliz\xe1veis para os documentos recebidos. Quando esta funcionalidade est\xe1 ativa na entidade, \xe9 poss\xedvel consultar e modificar o estado de um documento atrav\xe9s da API."}),"\n",(0,a.jsx)(o.p,{children:"Esta capacidade permite que software externo (como sistemas de gest\xe3o documental) altere o estado processual do documento no ilink de forma integrada. Todas as altera\xe7\xf5es de estado ficam registadas no hist\xf3rico do documento."}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Importante"}),": O estado do processo \xe9 independente do estado padr\xe3o de um documento (recebido, aceite, etc.). Serve exclusivamente para fins de organiza\xe7\xe3o interna e registo de opera\xe7\xf5es."]}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["Para consultar todos os estados de processo dispon\xedveis na entidade em quest\xe3o, dever\xe1 ser usado o m\xe9todo ",(0,a.jsxs)(o.strong,{children:[(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Estados%20de%20processamento%20de%20documentos/getProcessStates",children:"GET /apps/processstates"}),","]})," que retorna a lista completa de estados, juntamente com o seu ",(0,a.jsx)(o.code,{children:"identification_code"}),". Para alterar o estado de processo de um documento, dever\xe1 ser usado o m\xe9todo ",(0,a.jsx)(o.strong,{children:(0,a.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Estados%20de%20processamento%20de%20documentos/postDocumentsProcessState",children:"PUT /apps/documents/{id}/processstates"})}),", usando o campo ",(0,a.jsx)(o.code,{children:"identification_code"})," para atribuir o novo estado."]}),"\n",(0,a.jsx)(o.p,{children:"Os estados de processo s\xe3o configurados diretamente pela equipa de apoio do ilink."}),"\n",(0,a.jsx)(o.h2,{id:"7-casos-de-uso",children:"7. Casos de uso"}),"\n",(0,a.jsx)(o.p,{children:"A seguinte sec\xe7\xe3o exemplifica algumas situa\xe7\xf5es comuns na cria\xe7\xe3o de documentos CIUS-PT."}),"\n",(0,a.jsx)(o.h3,{id:"71-cria\xe7\xe3o-de-documentos-por-envio-de-dados",children:"7.1 Cria\xe7\xe3o de documentos por envio de dados"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar as condi\xe7\xf5es de pagamento"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"payment_terms[note]: 30 dias\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar um local de consumo (CPE) numa das linhas do documento"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"lines[0][additional_property][0][name]: CPE\nlines[0][additional_property][0][value]: PT1234567890\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio do n\xfamero de compromisso no cabe\xe7alho do documento"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"commitment_number: 2021/451\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio do n\xfamero de compromisso nas linhas do documento"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"lines[0][commitment][number]: 2021/123\nlines[0][commitment][line]: 1\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio do n\xfamero de encomenda"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"references[0][document_type]: order\nreferences[0][number]: 1234\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio do PDF anexado (UTF-8)"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"file: (binary)\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio de outros anexos secund\xe1rios"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"files[0]: (binary)\nfiles[1]: (binary)\n"})}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," O PDF de representa\xe7\xe3o do documento deve ser sempre enviado no campo ",(0,a.jsx)(o.strong,{children:"file"}),"."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Desconto no cabe\xe7alho do documento"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"discounts_charges[0][type]: false // usar true para encargo\ndiscounts_charges[0][reason]: desconto comercial\ndiscounts_charges[0][percent]: 23.00\ndiscounts_charges[0][tax_code]: NOR\ndiscounts_charges[0][amount]: 8.13 // refere-se ao valor sem imposto (ou seja, este desconto \xe9 de 10.00 EUR ap\xf3s a aplica\xe7\xe3o de IVA)\ndiscount_amount: 8.13 // refere-se ao total de descontos de cabe\xe7alho aplicados ao documento (N\xc3O inclui descontos nas linhas)\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Desconto ou encargo na linha do documento"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"lines[0][discounts_charges][0][type]: false // usar true para encargo\nlines[0][discounts_charges][0][reason]: desconto comercial // descri\xe7\xe3o textual do desconto\nlines[0][discounts_charges][0][amount]: 5.00 // refere-se ao valor sem IVA a descontar na linha\nlines[0][quantity]: 2.000 // quantidade de artigos na linha\nlines[0][price]: 10.00000000 // pre\xe7o unit\xe1rio do artigo\nlines[0][amount]: 15.00000000 // o total da linha do documento \xe9 afectado pelo desconto ( (10 * 2) - 5 = 15)\nlines[0][taxes][0][tax_percent]: 23.000 // taxa de IVA\nlines[0][taxes][0][tax_amount]: 3.45 // valor do IVA da linha (15 * 0.23)\ndiscount_amount: 0.00 // refere-se ao total de descontos de cabe\xe7alho aplicados ao documento (N\xc3O inclui descontos nas linhas)\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Desconto no pre\xe7o do artigo"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"lines[0][price_discount][base_amount]: 10.00 // pre\xe7o unit\xe1rio original do artigo antes de aplicar o desconto\nlines[0][price_discount][amount]: 5.00 // refere-se ao valor sem IVA a descontar no pre\xe7o do artigo\nlines[0][quantity]: 2.000 // quantidade de artigos na linha\nlines[0][price]: 5.00000000 // pre\xe7o do artigo ap\xf3s aplica\xe7\xe3o do desconto (10 - 5 = 5)\nlines[0][amount]: 10.00000000 // o total da linha do documento \xe9 afectado pelo desconto ( (10 - 5) * 2 = 10)\nlines[0][taxes][0][tax_percent]: 23.000 // taxa de IVA\nlines[0][taxes][0][tax_amount]: 2.30 // valor do IVA da linha (10 * 0.23)\ndiscount_amount: 0.00 // refere-se ao total de descontos de cabe\xe7alho aplicados ao documento (N\xc3O inclui descontos nas linhas)\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Reten\xe7\xe3o na fonte"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"withholding_tax[0][type]: IRF\nwithholding_tax[0][tax_amount]: 10.00 // valor da reten\xe7\xe3o\nwithholding_tax[0][description]: Reten\xe7\xe3o IRS\nwithholding_tax_amount: 10.00 // soma de todas as reten\xe7\xf5es do documento\n"})}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Nota:"})," os totais do documento n\xe3o s\xe3o afetados pela reten\xe7\xe3o"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Isen\xe7\xe3o de IVA na linha"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"lines[0][quantity]: 2.000 // quantidade\nlines[0][price]: 5.00000000 // pre\xe7o unit\xe1rio\nlines[0][amount]: 10.00000000 // total da linha sem IVA\nlines[0][taxes][0][tax_percent]: 0.00 // taxa de IVA\nlines[0][taxes][0][tax_amount]: 0.00 // valor do IVA da linha\nlines[0][taxes][0][tax_exemption_reason_code]: M08 // c\xf3digo de motivo da AT\nlines[0][taxes][0][tax_exemption_reason]: IVA - Autoliquida\xe7\xe3o // descritivo do motivo da AT\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Isen\xe7\xe3o de IVA no desconto ou encargo de cabe\xe7alho"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"discounts_charges[0][type]: false // usar true para encargo\ndiscounts_charges[0][reason]: desconto comercial // descritivo\ndiscounts_charges[0][percent]: 0.00 // percentagem (isento)\ndiscounts_charges[0][tax_code]: ISE // isento\ndiscounts_charges[0][amount]: 10.00 // valor do desconto\ndiscounts_charges[0][tax_exemption_reason]: M08 // c\xf3digo de motivo da AT\ndiscounts_charges[0][tax_exemption_reason_code]: IVA - Autoliquida\xe7\xe3o // descritivo do motivo da AT\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio da fatua por e-mail a um ou mais endere\xe7os"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"send_by_email: 1,\ncustomer[email]: endereco1@email.com // enviado sempre para o email especificado no cliente\nadditional_emails[0]: endereco2@email.com // tamb\xe9m enviado para a lista adicional de endere\xe7os\nadditional_emails[1]: endereco3@email.com\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio de c\xf3digo QR"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-php",children:"qr_code: A:500000000*B:123456789*C:PT*D:GT*E:N*F:20190720*G:GT G234CB/50987*H:GTVX4Y8B-50987*I1:0*N:0.00*O:0.00*Q:5uIg*R:9999\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(o.h3,{id:"72-cria\xe7\xe3o-de-documentos-por-envio-do-cius-pt",children:"7.2 Cria\xe7\xe3o de documentos por envio do CIUS-PT"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio do n\xfamero de compromisso no cabe\xe7alho do documento"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<Invoice>\n  ...\n  <cbc:AccountingCost>2021/156</cbc:AccountingCost>\n</Invoice>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio do Capital Social do fornecedor:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<Invoice>\n  ...\n  <cac:AccountingSupplierParty>\n    <cac:PartyLegalEntity>\n      <cbc:CompanyLegalForm>2.000.000 EUR</cbc:CompanyLegalForm>\n    </cac:PartyLegalEntity>\n  </cac:AccountingSupplierParty>\n</Invoice>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio do GLN do cliente (usar o schemeID 0088):"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:'<Invoice>\n  ...\n  <cac:AccountingCustomerParty>\n    <cbc:EndpointID schemeID="0088">123456789</cbc:EndpointID>\n  </cac:AccountingCustomerParty>\n</Invoice>\n'})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio de ATCUD e QRCODE:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:'<Invoice>\n  ...\n  <cac:AdditionalDocumentReference>\n    <cbc:ID schemeID="ANG">AFHOFX-22</cbc:ID> \x3c!-- Valor ATCUD --\x3e\n    <cbc:DocumentDescription>QR_CODE</cbc:DocumentDescription>\n    <cac:Attachment> \x3c!-- Texto do QRCODE, em base64 (da sequ\xeancia de carateres, N\xc3O da imagem) --\x3e\n        <cbc:EmbeddedDocumentBinaryObject mimeCode="text/plain" filename="QR_CODE.txt">UVJDT0RF=</cbc:EmbeddedDocumentBinaryObject>\n    </cac:Attachment>\n  </cac:AdditionalDocumentReference>\n</Invoice>\n'})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar o m\xe9todo de pagamento:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<Invoice>\n  ...\n  <cac:PaymentMeans>\n    <cbc:PaymentMeansCode>NU</cbc:PaymentMeansCode>\n  </cac:PaymentMeans>\n</Invoice>\n"})}),"\n",(0,a.jsx)(o.p,{children:"Valores permitidos:"}),"\n",(0,a.jsxs)(o.table,{children:[(0,a.jsx)(o.thead,{children:(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.th,{children:"C\xf3digo"}),(0,a.jsx)(o.th,{children:"Descri\xe7\xe3o"})]})}),(0,a.jsxs)(o.tbody,{children:[(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"CC"})}),(0,a.jsx)(o.td,{children:"Cart\xe3o cr\xe9dito"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"CD"})}),(0,a.jsx)(o.td,{children:"Cart\xe3o d\xe9bito"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"CH"})}),(0,a.jsx)(o.td,{children:"Cheque banc\xe1rio"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"CI"})}),(0,a.jsx)(o.td,{children:"Cr\xe9dito document\xe1rio internacional"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"CO"})}),(0,a.jsx)(o.td,{children:"Cheque ou cart\xe3o oferta"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"CS"})}),(0,a.jsx)(o.td,{children:"Compensa\xe7\xe3o de saldos em conta corrente"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"DE"})}),(0,a.jsx)(o.td,{children:"Dinheiro eletr\xf3nico (ex.: cart\xf5es de fidelidade ou pontos)"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"LC"})}),(0,a.jsx)(o.td,{children:"Letra comercial"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"MB"})}),(0,a.jsx)(o.td,{children:"Refer\xeancias de pagamento para Multibanco"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"NU"})}),(0,a.jsx)(o.td,{children:"Numer\xe1rio"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"OU"})}),(0,a.jsx)(o.td,{children:"Outros meios n\xe3o assinalados"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"PR"})}),(0,a.jsx)(o.td,{children:"Permuta de bens"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"TB"})}),(0,a.jsx)(o.td,{children:"Transfer\xeancia banc\xe1ria ou d\xe9bito direto autorizado"})]}),(0,a.jsxs)(o.tr,{children:[(0,a.jsx)(o.td,{children:(0,a.jsx)(o.strong,{children:"TR"})}),(0,a.jsx)(o.td,{children:"T\xedtulos de compensa\xe7\xe3o extrassalarial (ex.: refei\xe7\xe3o, educa\xe7\xe3o, etc.)"})]})]})]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar informa\xe7\xf5es de pagamento de cart\xe3o de d\xe9bito ou cr\xe9dito:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<Invoice>\n  ...\n  <cac:PaymentMeans>\n    <cbc:PaymentMeansCode>CC</cbc:PaymentMeansCode>\n    <cac:CardAccount>\n      <cbc:PrimaryAccountNumberID>4211456651233545687</cbc:PrimaryAccountNumberID> \x3c!-- N\xfamero da conta --\x3e\n      <cbc:NetworkID>04256</cbc:NetworkID> \x3c!-- Identificador da rede banc\xe1ria --\x3e\n      <cbc:HolderName>Jo\xe3o Ferreira</cbc:HolderName> \x3c!-- Nome do titular --\x3e\n    </cac:CardAccount>\n  </cac:PaymentMeans>\n</Invoice>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar m\xe9todo de pagamento por transfer\xeancia banc\xe1ria:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<Invoice>\n  ...\n  <cac:PaymentMeans>\n    <cbc:PaymentMeansCode>TB</cbc:PaymentMeansCode>\n    <cac:PayeeFinancialAccount>\n      <cbc:ID>PT50000700230012345667899</cbc:ID> \x3c!-- IBAN--\x3e\n      <cbc:Name>Jo\xe3o</cbc:Name> \x3c!-- Nome do titular --\x3e\n      <cac:FinancialInstitutionBranch>\n        <cbc:ID>NBxxxx</cbc:ID> \x3c!--SWIFT --\x3e\n      </cac:FinancialInstitutionBranch>\n    </cac:PayeeFinancialAccount>\n  </cac:PaymentMeans>\n</Invoice>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar m\xe9todo de pagamento por refer\xeancia multibanco:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:'<Invoice>\n  ...\n  <cac:PaymentMeans>\n    <cbc:PaymentMeansCode name="#DESCRIPTION@ATMPAYMENT#156.22#">#ENTITY@ATMPAYMENT#15652</cbc:PaymentMeansCode> \x3c!-- Entidade e Valor --\x3e\n    <cbc:PaymentID>#REFERENCE@ATMPAYMENT#156555145#</cbc:PaymentID> \x3c!-- Refer\xeancia --\x3e\n  </cac:PaymentMeans>\n</Invoice>\n'})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar uma segunda refer\xeancia multibanco:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<Invoice>\n  ...\n  <cbc:Note>#ENTITY@ATMPAYMENT-001#12345#</cbc:Note> \x3c!-- 2\xaa entidade --\x3e\n  <cbc:Note>#REFERENCE@ATMPAYMENT-001#012345678#</cbc:Note> \x3c!-- 2\xaa refer\xeancia --\x3e\n  <cbc:Note>#AMOUNT@ATMPAYMENT-001#3264.10#</cbc:Note> \x3c!--Valor da 2\xaa refer\xeancia --\x3e\n  <cbc:Note>#DESCRIPTION@ATMPAYMENT-001#Valor total do documento, mais valores em atraso#</cbc:Note> \x3c!-- Descri\xe7\xe3o da 2\xaa refer\xeancia --\x3e\n</Invoice>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar as condi\xe7\xf5es de pagamento:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<Invoice>\n  ...\n  <PaymentTerms>\n    <cbc:Note>30 dias</cbc:Note>\n  </PaymentTerms>\n</Invoice>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar uma nota textual no cabe\xe7alho do documento:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<Invoice>\n  ...\n  <cbc:Note>Nota cabe\xe7alho</cbc:Note>\n</Invoice>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar uma nota textual numa das linhas do documento:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<Invoice>\n  ...\n  <InvoiceLine>\n    <cbc:Note>Nota linha</cbc:Note>\n  </InvoiceLine>\n</Invoice>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar uma propriedade adicional no documento:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<Invoice>\n  ...\n  <cbc:Note>#ADDITIONALPROPERTY#VOUCHER#123#</cbc:Note>\n<Invoice>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Indicar um local de consumo (CPE) numa das linhas do documento:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<cac:InvoiceLine>\n  ...\n  <cac:AdditionalItemProperty>\n    <cbc:Name>CPE</cbc:Name>\n    <cbc:Value>PT1234567890</cbc:Value>\n  </cac:AdditionalItemProperty>\n</cac:InvoiceLine>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio do n\xfamero de encomenda / n\xfamero de requisi\xe7\xe3o"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<Invoice>\n  ...\n  <cac:OrderReference>\n    <cbc:ID>20159854587</cbc:ID>\n  </cac:OrderReference>\n</Invoice>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio do n\xfamero de compromisso nas linhas do documento"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:"<cac:InvoiceLine>\n  <cbc:AccountingCost>2020/123</cbc:AccountingCost> \x3c!-- n\xfamero do compromisso da linha --\x3e\n  ...\n  <cac:Item>\n    <cac:AdditionalItemProperty>\n      <cbc:Name>#LINEID@COMMITMENTLINEREFERENCE#</cbc:Name>\n      <cbc:Value>1</cbc:Value> \x3c!-- n\xfamero da linha --\x3e\n    </cac:AdditionalItemProperty>\n  </cac:Item>\n</cac:InvoiceLine>\n"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["Envio do PDF anexado (o conte\xfado deve estar em ",(0,a.jsx)(o.a,{href:"https://www.base64decode.org/",children:"base64"}),")"]}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:'<Invoice>\n  ...\n  <cac:AdditionalDocumentReference>\n    <cbc:ID>1</cbc:ID>\n    <cbc:DocumentDescription>INVOICE_REPRESENTATION</cbc:DocumentDescription>\n    <cac:Attachment>\n      <cbc:EmbeddedDocumentBinaryObject mimeCode="application/pdf" filename="document">JVBERi0xLjUNCiW1tbW1DQoxIDAgb2JqDQo8PC9UeXBlL0NhdGFsb2cvUGIvTGF==\n      </cbc:EmbeddedDocumentBinaryObject>\n    </cac:Attachment>\n  </cac:AdditionalDocumentReference>\n</Invoice>\n'})}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(2815).A+"",children:"Ver exemplo"})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsx)(o.p,{children:"Envio de m\xfaltiplos PDFs anexados"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:'<Invoice>\n  ...\n  <cac:AdditionalDocumentReference>\n    <cbc:ID>1</cbc:ID> \x3c!-- O anexo principal deve ter a descri\xe7\xe3o INVOICE_REPRESENTATION\', ou \'CREDITNOTE_REPRESENTATION\' --\x3e\n    <cbc:DocumentDescription>INVOICE_REPRESENTATION</cbc:DocumentDescription>\n    <cac:Attachment>\n      <cbc:EmbeddedDocumentBinaryObject mimeCode="application/pdf" filename="document.pdf">JVBERi0xLjUNCiW1tbW1DQoxIDAgb2JqDQo8PC9UeXBlL0NhdGFsb2cvUGIvTGF==\n      </cbc:EmbeddedDocumentBinaryObject>\n    </cac:Attachment>\n  </cac:AdditionalDocumentReference>\n\n  <cac:AdditionalDocumentReference>\n    <cbc:ID>2</cbc:ID> \x3c!-- Os anexos secund\xe1rios (como a nota de encomenda, guias de pagamento, etc.) devem ter a descri\xe7\xe3o \'ATTACHMENT\'. \xc9 poss\xedvel incluir v\xe1rios ATTACHMENTs num documento. --\x3e\n    <cbc:DocumentDescription>ATTACHMENT</cbc:DocumentDescription>\n    <cac:Attachment>\n      <cbc:EmbeddedDocumentBinaryObject mimeCode="application/pdf" filename="document2.pdf">jUNCiW1tbW1DQoJVBERi0xLjUNCiW1tbW1DQo8PC9UeXBlL0NhUGIvTGF==\n      </cbc:EmbeddedDocumentBinaryObject>\n    </cac:Attachment>\n  </cac:AdditionalDocumentReference>\n</Invoice>\n'})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["Envio de outros anexos (QR Code, etc.) (o conte\xfado deve estar em ",(0,a.jsx)(o.a,{href:"https://www.base64decode.org/",children:"base64"}),")"]}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-xml",children:'<Invoice>\n  ...\n  <cac:AdditionalDocumentReference>\n    <cbc:ID>2</cbc:ID>\n    <cbc:DocumentDescription>ATTACHMENT</cbc:DocumentDescription> \x3c!-- usar QR_CODE para o c\xf3digo QR --\x3e\n    <cac:Attachment>\n      <cbc:EmbeddedDocumentBinaryObject mimeCode="application/txt" filename="document">JVBERi0xLjUNCiW1tbW1DQoxIDAgb2JqDQo8PC9UeXBlL0NhdGFsb2cvUGIvTGF==\n      </cbc:EmbeddedDocumentBinaryObject>\n    </cac:Attachment>\n  </cac:AdditionalDocumentReference>\n</Invoice>\n'})}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["Desconto ou encargo no cabe\xe7alho do documento\n",(0,a.jsx)(o.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(5386).A+"",children:"Ver exemplo"})]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["Desconto ou encargo na linha do documento\n",(0,a.jsx)(o.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(8123).A+"",children:"Ver exemplo"})]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["Desconto ou encargo no pre\xe7o do artigo\n",(0,a.jsx)(o.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(2266).A+"",children:"Ver exemplo"})]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["Reten\xe7\xe3o na fonte\n",(0,a.jsx)(o.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(5086).A+"",children:"Ver exemplo"})]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["Isen\xe7\xe3o de IVA na linha do documento\n",(0,a.jsx)(o.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(7216).A+"",children:"Ver exemplo"})]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["Isen\xe7\xe3o de IVA no desconto de cabe\xe7alho do documento\n",(0,a.jsx)(o.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(73).A+"",children:"Ver exemplo"})]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["M\xfaltiplas isen\xe7\xf5es no documento\n",(0,a.jsx)(o.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(3960).A+"",children:"Ver exemplo"})]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["V\xe1rios descontos na linha\n",(0,a.jsx)(o.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(2624).A+"",children:"Ver exemplo"})]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["\n",(0,a.jsxs)(o.p,{children:["Ver ",(0,a.jsx)(o.a,{href:"https://www.espap.gov.pt/Imagens/Documento.ashx?id=254",children:"lista completa de casos de uso CIUS-PT"})," pela eSPap."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(o.h2,{id:"8-fluxos-api",children:"8. Fluxos API"}),"\n",(0,a.jsx)(o.p,{children:"A imagem abaixo consolida os fluxos de integra\xe7\xe3o do API do ilink acima descritos:"}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{alt:"img info",src:n(900).A+"",width:"882",height:"683"})}),"\n",(0,a.jsx)(o.h2,{id:"9-checklist-pr\xe9-produ\xe7\xe3o",children:"9. Checklist pr\xe9-produ\xe7\xe3o"}),"\n",(0,a.jsx)(o.p,{children:"Antes de passar a integra\xe7\xe3o a ambiente produtivo, devem validar os seguintes pontos:"}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.strong,{children:"Acordo de interoperabilidade (obrigat\xf3rio)"})}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsx)(o.li,{children:"Dever\xe1 ser assinado e devolvido \xe0 acin"}),"\n"]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.strong,{children:"Envio de documentos (no caso da implementa\xe7\xe3o do fluxo de envio)"})}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["Verificar se \xe9 poss\xedvel criar um documento entre ambas as entidades de teste sem erros de valida\xe7\xe3o, contendo os seguintes campos:","\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsx)(o.li,{children:"PDF anexado"}),"\n",(0,a.jsx)(o.li,{children:"N\xfamero de compromisso"}),"\n",(0,a.jsx)(o.li,{children:"Todos os campos da morada do fornecedor (rua, cidade, c\xf3digo postal)"}),"\n",(0,a.jsx)(o.li,{children:"Capital social do fornecedor"}),"\n",(0,a.jsx)(o.li,{children:"N\xfamero de encomenda/requisi\xe7\xe3o"}),"\n",(0,a.jsx)(o.li,{children:"GLN do cliente"}),"\n",(0,a.jsx)(o.li,{children:"GLN do local de entrega"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(o.li,{children:["No caso do envio de documentos para ",(0,a.jsx)(o.strong,{children:"entidades n\xe3o p\xfablicas"})," (e.g envio de e-mail com PDF anexado), verificar se \xe9 enviado um e-mail com a fatura ao destinat\xe1rio, ",(0,a.jsx)(o.a,{href:"#54-envio-do-documento",children:"e se a assinatura do documento XML \xe9 desativada"})," (caso seja usada uma assinatura digital qualificada no ilink)"]}),"\n",(0,a.jsxs)(o.li,{children:["No caso da ",(0,a.jsx)(o.a,{href:"#59-consulta-de-estado-de-documentos-emitidos",children:"consulta de estado de documentos emitidos"}),", dever\xe3o testar se o software \xe9 capaz de receber e agir confirme o estado do documento"]}),"\n",(0,a.jsxs)(o.li,{children:["Caso o documento seja rejeitado/regularizado, ",(0,a.jsx)(o.a,{href:"#56-criareditar-documento",children:"dever\xe1 ser poss\xedvel reenviar o mesmo"})," com informa\xe7\xe3o retificada."]}),"\n"]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.strong,{children:"Rece\xe7\xe3o de documentos (no caso da implementa\xe7\xe3o do fluxo de rece\xe7\xe3o)"})}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["Devem verificar se um documento recebido \xe9 corretamente integrado no software, ",(0,a.jsx)(o.a,{href:"#63-importa%C3%A7%C3%A3o-e-aceita%C3%A7%C3%A3o",children:"e se \xe9 comunicada a correta importa\xe7\xe3o e aceita\xe7\xe3o do mesmo"}),"."]}),"\n"]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.strong,{children:"Passagem a produ\xe7\xe3o (obrigat\xf3rio)"})}),"\n",(0,a.jsxs)(o.ol,{children:["\n",(0,a.jsxs)(o.li,{children:["Configurar o ",(0,a.jsx)(o.a,{href:"#2-notas-t%C3%A9cnicas",children:"URL de produ\xe7\xe3o"})," no vosso software"]}),"\n",(0,a.jsx)(o.li,{children:"Solicitar \xe0 equipa do ilink o token de aplica\xe7\xe3o e chave(s) da(s) entidade(s) do ambiente de produ\xe7\xe3o"}),"\n",(0,a.jsxs)(o.li,{children:["Assegurar-se que s\xe3o efetuadas as ",(0,a.jsx)(o.a,{href:"#42-autentica%C3%A7%C3%A3o",children:"autentica\xe7\xf5es"})," necess\xe1rias em ambiente produtivo"]}),"\n",(0,a.jsx)(o.li,{children:"Assegurar-se que o cliente tem todas as liga\xe7\xf5es previamente configuradas no portal do ilink, assim como as transa\xe7\xf5es necess\xe1rias ativas (solicitar ao servi\xe7o de apoio)"}),"\n",(0,a.jsx)(o.li,{children:"Opcional: assegurar que o cliente tem a assinatura digital corretamente configurada no ambiente produtivo."}),"\n",(0,a.jsx)(o.li,{children:"Opcional: assegurar que o cliente tem o template de envio de e-mail de fatura\xe7\xe3o configurado no ambiente produtivo."}),"\n"]})]})}function m(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,a.jsx)(o,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);