"use strict";(self.webpackChunkilink=self.webpackChunkilink||[]).push([[861],{3262:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/20230420-133607-c5d03a751653d102acc0ed60c783eee4.png"},5756:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/20210415-123923-45dc58da575be97ec00b5f16d9c8da41.png"},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>d});var s=t(6540);const i={},o=s.createContext(i);function a(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}},8985:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"integrations/api/issued","title":"Issuing documents","description":"Scope","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/integrations/api/issued.md","sourceDirName":"integrations/api","slug":"/integrations/api/issued","permalink":"/en/docs/integrations/api/issued","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"ilinkSidebar","previous":{"title":"Technical Specification","permalink":"/en/docs/integrations/api/specification"},"next":{"title":"Receiving documents","permalink":"/en/docs/integrations/api/received"}}');var i=t(4848),o=t(8453);const a={},d="Issuing documents",r={},c=[{value:"Scope",id:"scope",level:2},{value:"Digital signature",id:"assinatura-digital",level:2},{value:"Sending methods",id:"m\xe9todos-de-envio",level:2},{value:"Sending XML in UBL 2.1 CIUS-PT format (or UBL 2.1 PEPPOLBIS3 - Orders)",id:"sending-xml-in-ubl-21-cius-pt-format-or-ubl-21-peppolbis3---orders",level:3},{value:"Sending structured document data",id:"sending-structured-document-data",level:3},{value:"Sending the document",id:"envio-do-documento",level:2},{value:"Sending via EDI",id:"sending-via-edi",level:3},{value:"Sending via email",id:"sending-via-email",level:3},{value:"Creation of documents and use of qualified digital signatures",id:"cria\xe7\xe3o-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas",level:3},{value:"Additional validations",id:"valida\xe7\xf5es-adicionais",level:2},{value:"Create/edit document",id:"criareditar-documento",level:2},{value:"Access to issued documents",id:"access-to-issued-documents",level:2},{value:"Consultation of documents issued on the portal (optional)",id:"consultation-of-documents-issued-on-the-portal-optional",level:2},{value:"Consultation of state of issued documents",id:"consulta-de-estado-de-documentos-emitidos",level:2},{value:"Consultation of the state of documents sent via EDI",id:"consultation-of-the-state-of-documents-sent-via-edi",level:3},{value:"Consultation of the state of documents sent via e-mail",id:"consulta-de-estado-de-documento-enviado-via-e-mail",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"issuing-documents",children:"Issuing documents"})}),"\n",(0,i.jsx)(n.h2,{id:"scope",children:"Scope"}),"\n",(0,i.jsx)(n.p,{children:"The ilink platform allows integrator systems to issue documents that are automatically sent to their respective recipients. ilink manages the entire sending process for the ERPs and EDIs configured for each customer, making this process transparent for the API. These configurations are carried out by the ilink support team before before deployment to production."}),"\n",(0,i.jsx)(n.p,{children:"The ilink platform supports the sending of electronic invoices in two different scenarios:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sending signed PDFs via e-mail to end consumers or private companies"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In this scenario, it is not necessary to create connections with other EDIs. Simply indicate the destination e-mail address(es) in the document creation endpoint. For more information, see the section ",(0,i.jsx)(n.a,{href:"issued#m%C3%A9todos-de-envio",children:"Sending methods"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sending CIUS-PT XML to public entities (mandatory in public contracts)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In this scenario, it is necessary to configure the connections between TINs in advance and, possibly, between other external EDI brokers."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How are documents sent to other EDI brokers?"}),"\nDuring the production deployment phase, a survey of all entities that will receive documents via EDI, as well as their respective EDI brokers, must be carried out. Subsequently, the support team (",(0,i.jsx)(n.a,{href:"mailto:apoio@ilink.pt",children:"apoio@ilink.pt"}),") will configure the necessary connections to ensure that the documents are automatically integrated into each recipient\u2019s system. Before sending documents to the FE-AP solution of eSPap, each issuer must also complete the ",(0,i.jsx)(n.a,{href:"/docs/onboarding-feap",children:"FE-AP supplier enrolment process"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"All documents issued are available on the ilink portal, both for the issuing entity and for the receiving entity."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note: In the test environment, you should only issue documents between the two entities that have been granted access"}),". If you wish to verify the functioning of document sending to an end consumer (arbitrary TIN), you should always issue the document through one of the entities that have been granted access."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"IMPORTANT:"})," When sending documents to ",(0,i.jsx)(n.strong,{children:"public entities"}),", we strongly recommend implementing the following aspects, otherwise you may not be able to integrate the documents with certain systems:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Commitment number"}),"\n",(0,i.jsx)(n.li,{children:"Original PDF file of the invoice"}),"\n",(0,i.jsx)(n.li,{children:"Order or requisition number (if applicable)"}),"\n",(0,i.jsx)(n.li,{children:"Supplier's share capital"}),"\n",(0,i.jsx)(n.li,{children:"Customer's e-mail address (only for the offices of the Regional Government of Madeira)"}),"\n",(0,i.jsx)(n.li,{children:"All supplier address details (street, postal code, city, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"Customer GLN (if applicable)"}),"\n",(0,i.jsx)(n.li,{children:"Possibility of resending the document based on the state obtained (useful for correcting and resending a previously rejected document)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"assinatura-digital",children:"Digital signature"}),"\n",(0,i.jsxs)(n.p,{children:["Ilink allows you to automatically sign attachments to issued documents (XML and PDF), provided that the issuing entity has purchased and configured a seal from one of the qualified digital signature providers. Currently, only ",(0,i.jsx)(n.a,{href:"https://globaltrustedsign.com/",children:"GTS - Global Trusted Sign"})," is supported, but there are plans to support the remaining providers in Portugal."]}),"\n",(0,i.jsx)(n.p,{children:"This means that the ERP is not required to integrate with a signature provider and can (optionally) delegate the certification process to ilink. Alternatively, the ERP itself can perform the certification process and send the signed documents to ilink."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," ",(0,i.jsx)(n.strong,{children:"In the ilink signature scenario, by default, all resulting files are signed upon entry (xml and pdf)"})," and subsequently sent to the customer. This behaviour can be changed, allowing you to define which files are signed. For more information, see the section on ",(0,i.jsx)(n.a,{href:"issued#cria%C3%A7%C3%A3o-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas",children:"signature consumption"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"In the case of signing via ERP, the digital signature of the document is always cryptographically validated for all documents entering the system"}),". A document with an invalid signature, both in XML and PDF, will not integrate and will always return an error via API as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "document": {\n      "code": "e217",\n      "msg": "The signature on the document is not valid."\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The previous error indicates that the document has been altered since it was signed, or that the signature was generated incorrectly. The following ",(0,i.jsx)(n.a,{href:"https://ec.europa.eu/cefdigital/DSS/webapp-demo/validation",children:"validator"})," can be used to verify the validity of document signatures. The signature formats recognised by ilink are  ",(0,i.jsx)(n.a,{href:"https://www.adobe.com/uk/acrobat/resources/document-files/pdf-types/pades.html",children:"PADES"})," and PKCS7-B (PDF), or XMLDSig and ",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/XAdES",children:"XADES-BES"})," (XML)."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," The legal requirements for the signature of electronic invoices are available in ",(0,i.jsx)(n.a,{href:"https://dre.pt/home/-/dre/119622094/details/maximized",children:"Decree-Law 28/2019, section II, article 12"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," Ilink signs PDF documents in ",(0,i.jsx)(n.a,{href:"https://www.adobe.com/uk/acrobat/resources/document-files/pdf-types/pades.html",children:"PADES"})," and XML documents in ",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/XAdES",children:"XADES-BES"})," ",(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/previous-versions/windows/desktop/ms767623%28v=vs.85%29",children:"enveloped"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"m\xe9todos-de-envio",children:"Sending methods"}),"\n",(0,i.jsx)(n.p,{children:"Once authentication has been successfully completed, we are ready to start sending documents.\nThe ilink API provides two approaches for sending documents:"}),"\n",(0,i.jsx)(n.h3,{id:"sending-xml-in-ubl-21-cius-pt-format-or-ubl-21-peppolbis3---orders",children:"Sending XML in UBL 2.1 CIUS-PT format (or UBL 2.1 PEPPOLBIS3 - Orders)"}),"\n",(0,i.jsxs)(n.p,{children:["In this method, the integrator system must correctly generate the XML file before sending it to ilink. eSPap provides the technical specification for the CIUS-PT format ",(0,i.jsx)(n.a,{href:"https://www.espap.gov.pt/Imagens/Documento.ashx?id=265",children:"here"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["All XML files sent using this method ",(0,i.jsx)(n.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"are validated according to the official eSPap validator, version 2.1.2"}),", and the API will return an error if syntactic inconsistencies are found. eSPap provides a ",(0,i.jsx)(n.a,{href:"https://www.espap.gov.pt/Imagens/Documento.ashx?id=267",children:"Schematron validator"})," that implements all the validations of ",(0,i.jsx)(n.a,{href:"https://ec.europa.eu/digital-building-blocks/sites/spaces/DIGITAL/pages/467108950/EN+16931+compliance",children:"European Standard EN16931 CIUS"})," and the additional validations of CIUS-PT, available online ",(0,i.jsx)(n.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"at this link"}),". ",(0,i.jsxs)(n.strong,{children:["If the files validate syntactically in the ",(0,i.jsx)(n.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"online validator"}),", then they should validate in ilink, with the exception of any ",(0,i.jsx)(n.a,{href:"issued#additional-validations",children:"additional validations"})," defined by the document recipient."]})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," To add a ",(0,i.jsx)(n.strong,{children:"PDF"})," file to your electronic invoice and view other use cases, see the [use cases] section(usecases#cria\xe7\xe3o-de-documentos-por-envio-do-cius-pt)."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," eSPap also provides several ",(0,i.jsx)(n.a,{href:"https://www.espap.gov.pt/Imagens/Documento.ashx?id=254",children:"CIUS-PT examples"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Some examples of errors in the XML validation process:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "document": {\n      "code": "e217",\n      "msg": "[BR-CO-25]-If the amount payable (BT-115) is positive, you must indicate the due date (BT-9) or the payment terms note(BT-20)."\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "document": {\n      "code": "e217",\n      "msg": "[DT-CIUS-PT-166]-Amount due for payment (BT-115) = Invoice total amount with VAT (BT-112) -Paid amount (BT-113) +Rounding amount (BT-114), with an acceptance range of 1.00 \u20ac (it does not mean that this tolerance is accepted by the customer)."\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The method to be used for sending the XML is ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"POST /apps/documentsUBL"})}),". In this context, ",(0,i.jsx)(n.strong,{children:"the public key identifies the issuer of the document"})," and must correspond to the key associated with the issuer's TIN specified in the XML (",(0,i.jsx)(n.code,{children:"AccountingSupplierParty>Party>PartyTaxScheme>CompanyID"})," for invoices/credit notes, or ",(0,i.jsx)(n.code,{children:"AccountingCustomerParty>Party>PartyTaxScheme>CompanyID"})," for orders). If this does not occur, the API will return the following error:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "supplier": {\n      "code": "e199",\n      "msg": "The entity creating the document must be a customer or supplier of the new document."\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If the XML is valid and complies with all the standard validations, as well as all ",(0,i.jsx)(n.a,{href:"issued#valida%C3%A7%C3%B5es-adicionais",children:"additional business rules of the recipient"}),", the API returns a successful response, along with the main data from the created document:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'HTTP status: 201 Created\n\n{\n  "success": true,\n  "message": {\n    "code": "s011",\n    "msg": "Document successfully created"\n  },\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016",\n      "number": "7411111",\n      "emission_date": "2021-04-15",\n      "type_document_fact": {\n        "id": "5c9cb870a5ef57.36583702",\n        "code": "380",\n        "alias": "invoice",\n        "type": "FT",\n        "description": "Invoice"\n      },\n      "type_document": {\n        "alias": "issued",\n        "description": "Issued"\n      },\n      "state_document": {\n        "id": "5c9cb878745b16.4225687",\n        "alias": "sent",\n        "description": "Sent to customer."\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," A document is successfully sent to the recipient via EDI when the ",(0,i.jsx)(n.code,{children:"state_document.alias"})," field has the value ",(0,i.jsx)(n.code,{children:"sent"})," or ",(0,i.jsx)(n.code,{children:"accepted"}),". If you only want the document to be sent by email, the document state should be ignored. Instead, you should consult the record of e-mails sent via ",(0,i.jsx)(n.a,{href:"issued#consulta-de-estado-de-documento-enviado-via-e-mail",children:"state consultation"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"sending-structured-document-data",children:"Sending structured document data"}),"\n",(0,i.jsxs)(n.p,{children:["When using this option, the ERP does not need to generate the entire XML file, as ilink is responsible for generating the final XML file. Thus, the ERP only needs to send all data related to the document to ilink. The endpoint to use here is ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"POST /apps/documents"})})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img info",src:t(5756).A+"",width:"1490",height:"895"})}),"\n",(0,i.jsxs)(n.p,{children:["The specification for this method is extensive, as it covers all possible fields in an invoice/order, which are duly documented in the specification. All documents created by this endpoint are subject to the same validations as documents sent by the method ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"POST /apps/documentsUBL"})}),", in other words, the XML resulting from the data entered will be validated according to the official eSPap validator, which can be consulted online ",(0,i.jsx)(n.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"at this link"}),", and according to the ",(0,i.jsx)(n.a,{href:"issued#valida%C3%A7%C3%B5es-adicionais",children:"additional business rules"})," of the document recipient, if any."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," To add a ",(0,i.jsx)(n.strong,{children:"PDF"})," file to an electronic invoice and other common situations, see the [use cases] section(usecases#cria\xe7\xe3o-de-documentos-por-envio-de-dados)."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," It is possible to send multiple attachments in a document using the ",(0,i.jsx)(n.code,{children:"files[]"})," field (see specification above). However, the visual representation of the document (i.e. the original PDF of the invoice used for printing) must always be sent in the ",(0,i.jsx)(n.code,{children:"file"})," field, with the ",(0,i.jsx)(n.code,{children:"files[]"})," field reserved for additional files (order notes, dispatch notices, transport guides, etc.). **If the document issuer has an active digital signature on ilink, all attachments will be signed by default, and transaction consumption will take into account the total size of all attachments sent (1 transaction is debited for every 1MB of attachments sent)."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"envio-do-documento",children:"Sending the document"}),"\n",(0,i.jsx)(n.h3,{id:"sending-via-edi",children:"Sending via EDI"}),"\n",(0,i.jsxs)(n.p,{children:["A document, after being successfully created by any of the methods described (",(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"XML sending"})," or ",(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"data sending"}),"), will be automatically sent to the recipient by EDI. However, in specific cases, it may not be sent immediately via EDI due to missing configurations and/or other anomalies in the ilink platform or the recipient's system. If this occurs, a ",(0,i.jsx)(n.code,{children:"to_send_status"})," field will be returned in the document response to detail the situation:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'HTTP status: 201 OK\n\n{\n  "success": true,\n  "message": {\n    "code": "s011",\n    "msg": "Document successfully created"\n  },\n  "response": {\n    "data": {\n      "id":"60796c3c2a6fa2.53909016",\n      "state_document": {\n        "id": "5c9cb870f34b16.42025494",\n        "alias": "tosend",\n        "description": "To be sent to the customer."\n      },\n      "to_send_status": {\n        "code": "sent_connection",\n        "title": "Await acceptance of connection with the recipient of the document."\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," You can verify that the document was ",(0,i.jsx)(n.strong,{children:"NOT"})," delivered via EDI because the ",(0,i.jsx)(n.code,{children:"state_document.alias"})," field assumes the value ",(0,i.jsx)(n.code,{children:"tosend"})," and the reason for the error is described in the ",(0,i.jsx)(n.code,{children:"to_send_state"})," field. In this situation, you must first complete the EDI connection with the recipient and then resend the document."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The possible reasons (",(0,i.jsx)(n.code,{children:"code"}),") for a document not being sent are:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sent_connection"}),", ",(0,i.jsx)(n.code,{children:"no_connection"}),": Missing connection with recipient"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"registered_entity"}),": The recipient is not registered with ilink"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"received_pay_transactions"}),": The recipient bears the costs of the documents received but does not have sufficient transactions to send the document"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"After rectifying the error, you will be able to resend the document (see section on [resending documents])(issued#criareditar-documento))."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note"}),": The document state (",(0,i.jsx)(n.code,{children:"state_document"}),") only applies to EDI sendings. If the document is only sent to an arbitrary customer via e-mail (PDF), the sending state does not reflect the sending of the e-mail. See the following ",(0,i.jsx)(n.a,{href:"issued#consulta-de-estado-de-documento-enviado-via-e-mail",children:"section"})," for more information."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"sending-via-email",children:"Sending via email"}),"\n",(0,i.jsxs)(n.p,{children:["After a document has been successfully created (HTTP status 201) using any of the methods described (",(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"sending XML"})," or ",(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"sending data"}),"), it will be sent via email to the recipient if the ",(0,i.jsx)(n.code,{children:"send_by_email"})," field is specified with the value ",(0,i.jsx)(n.code,{children:"1"}),". The address(es) of the recipient(s) of the document can be specified in three ways:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["in the ",(0,i.jsx)(n.code,{children:"additional_emails[]"})," field (in both sending methods)"]}),"\n",(0,i.jsxs)(n.li,{children:["in the ",(0,i.jsx)(n.code,{children:"customer[email]"})," field (only in the sending data method)"]}),"\n",(0,i.jsxs)(n.li,{children:["in the ",(0,i.jsx)(n.code,{children:"cac:AccountingCustomerParty/cac:Party/cac:Contact/cbc:ElectronicMail"})," XML element (only in the sending XML method)."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["To check the sending of emails and their reading by the customer, see the section on ",(0,i.jsx)(n.a,{href:"issued#consulta-de-estado-de-documentos-emitidos",children:"checking the state of issued documents"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"cria\xe7\xe3o-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas",children:"Creation of documents and use of qualified digital signatures"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note"}),": This section is only relevant for customers who use ilink to digitally sign issued documents. ",(0,i.jsx)(n.a,{href:"issued#assinatura-digital",children:"See details"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If a qualified digital signature is configured in ilink, all documents will be signed at the time of creation, including all files resulting from the electronic invoice (xml and pdf). Given that document signature is not required by law in all usage scenarios, it is possible to individually control the signature of xml and pdf files at the time of document creation using the ",(0,i.jsx)(n.code,{children:"disable_xml_sign"})," and ",(0,i.jsx)(n.code,{children:"disable_pdf_sign"})," fields, available in both document creation methods ( ",(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"XML"})," or ",(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"data"}),"). This reduces the consumption of digital signatures and optimises the document creation process."]}),"\n",(0,i.jsx)(n.p,{children:"In other words:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When sending a digital invoice via ",(0,i.jsx)(n.strong,{children:"signed PDF to an end consumer or private customer"}),", it will not be mandatory to sign the resulting XML file, so we recommend using the field ",(0,i.jsx)(n.code,{children:"disable_xml_sign: 1"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["When sending electronic invoices to the ",(0,i.jsx)(n.strong,{children:"Public Administration via EDI"})," (e.g. eSPap), it is not mandatory to sign the document; however, it is always possible to sign both files for additional security and integrity reasons. If, for example, you wish to disable the digital signature on the PDF attachment, simply use the option ",(0,i.jsx)(n.code,{children:"disable_pdf_sign: 1"}),"."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"The fields described above only take effect when the document issuer uses a qualified digital signature in ilink."})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"valida\xe7\xf5es-adicionais",children:"Additional validations"}),"\n",(0,i.jsx)(n.p,{children:"The invoice recipient can configure additional requirements for certain fields (business rules) in ilink, even when these are not mandatory in the CIUS-PT specification. For example, a customer may specify that he or she only accepts invoices with a PDF file attached or with a specific commitment number. It is essential that these requirements are agreed in advance with the customer/recipient before going into production, in order to avoid integration errors."}),"\n",(0,i.jsx)(n.p,{children:"If the document recipient requires the presence of a field not specified in the XML, the API will return an error as shown below and the document will not be generated:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "commitment_number": {\n      "code": "e048",\n      "msg": "The commitment number is mandatory."\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Please note that errors are only returned in this format when the document recipient is an ilink customer and has the appropriate business rules configured on the platform. When a document is sent to an external EDI system, any failure in the validation process is normally communicated at a later time via a state change to ",(0,i.jsx)(n.strong,{children:"Rejected"}),", with the appropriate error message. It is important to note that not all EDI systems support the sending of state messages."]}),"\n",(0,i.jsx)(n.h2,{id:"criareditar-documento",children:"Create/edit document"}),"\n",(0,i.jsx)(n.p,{children:"A document can be edited and resent to the recipient:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["if ",(0,i.jsx)(n.strong,{children:"it has not yet been sent"})," to the end customer"]}),"\n",(0,i.jsxs)(n.li,{children:["or if ",(0,i.jsx)(n.strong,{children:"it has already been sent to the customer and the customer has requested a correction"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"In practical terms, the possibility of resending can be checked using the following response field in the document:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:"\"state_edi_document\": {\n  \"alias\": <state> // possible resend states: 'regularization' ou 'reception' ou 'error'\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To check the state of a document, see the section on ",(0,i.jsx)(n.a,{href:"issued#consulta-de-estado-de-documentos-emitidos",children:"checking the state of issued documents"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["To edit an existing document, simply repeat the request ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"POST /apps/documentsUBL"})})," or ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"POST /apps/documents"})})," with the corrected data, keeping the ",(0,i.jsx)(n.strong,{children:"number, type and date of issue"})," of the previous document:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'HTTP status: 200 OK\n\n{\n  "success": true,\n  "message": {\n    "code": "s012",\n    "msg": "Document successfully created"\n  },\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016",\n      "number": "7411111",\n      "emission_date": "2021-04-16",\n      "type_document_fact": {\n        "id": "5c9cb870a5ef57.36583702",\n        "code": "380",\n        "alias": "invoice",\n        "type": "FT",\n        "description": "Invoice"\n      },\n      "type_document": {\n        "alias": "issued",\n        "description": "Issued"\n      },\n      "state_document": {\n        "id": "5c9cb870f34b16.42025494",\n        "alias": "tosend",\n        "description": "To be sent to the customer."\n      }\n    }\n  }\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"If the document is not eligible for editing (i.e. it has already been sent or accepted by the end customer), an error will be displayed when attempting to resend it:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "number": {\n      "code": "e200",\n      "msg": "Document already exists."\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"access-to-issued-documents",children:"Access to issued documents"}),"\n",(0,i.jsxs)(n.p,{children:["When a document is successfully registered, an ",(0,i.jsx)(n.code,{children:"id"})," will always be returned in the responses, which identifies it to ilink. It is useful to save this identifier for future queries to the document."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'HTTP status: 201 Created\n\n{\n  "success": true,\n  "message": {\n    "code": "s011",\n    "msg": "Document successfully created"\n  },\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016"\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The API also allows you to access all data (including generated XML and PDF) from all previously issued documents. To do so, use the ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument",children:"GET /apps/documents/{id}"})})," method. The ",(0,i.jsx)(n.code,{children:"id"})," received when creating the document must be used as a parameter here to access the corresponding document."]}),"\n",(0,i.jsx)(n.p,{children:"All data returned by this method is available in the specification."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note"}),": If the entity issuing the document has configured automatic document signature in ilink, the URLs for accessing the XML and PDF files will already return the signed files."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"consultation-of-documents-issued-on-the-portal-optional",children:"Consultation of documents issued on the portal (optional)"}),"\n",(0,i.jsxs)(n.p,{children:["The documents can also be consulted on the ",(0,i.jsx)(n.a,{href:"https://ilink.acin.pt",children:"ilink test portal"})," using the credentials provided by the entities. Here you can visually validate whether the information presented is consistent with the data sent via API:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img info",src:t(3262).A+"",width:"1596",height:"839"})}),"\n",(0,i.jsx)(n.p,{children:"To access the attachments of a document, you must access the document in the table and click on the magnifying glass icon:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"img info",src:t(9741).A+"",width:"1605",height:"838"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," The documents must be present both at the issuing entity (issued documents section) and at the receiving entity (received documents section)."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"consulta-de-estado-de-documentos-emitidos",children:"Consultation of state of issued documents"}),"\n",(0,i.jsx)(n.p,{children:"It is also possible to access the current state of previously issued documents. This operation allows the issuer of the document to check whether the document has been accepted by the customer, or whether it is pending resending/regularisation, as well as the reasons that led to this."}),"\n",(0,i.jsx)(n.h3,{id:"consultation-of-the-state-of-documents-sent-via-edi",children:"Consultation of the state of documents sent via EDI"}),"\n",(0,i.jsxs)(n.p,{children:["Ilink provides four simplified document states in the ",(0,i.jsx)(n.code,{children:"state_document"})," property:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"State"}),(0,i.jsx)(n.th,{children:"alias"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"To be sent"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"tosend"})}),(0,i.jsx)(n.td,{children:"the document has not been sent to the customer. This probably means that some configuration is missing in ilink, the sender/recipient does not authorise a connection between them, or that some of the entities in the document do not have sufficient transactions to proceed with the sending. If you only want the document to be sent via email, this state should be ignored."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Sent"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sent"})}),(0,i.jsx)(n.td,{children:"The document has been sent to the customer and is awaiting acceptance. Please note that not all recipient systems support state communication, so some documents may never leave this state."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Accepted"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"accepted"})}),(0,i.jsxs)(n.td,{children:["The document has been sent and the customer has approved it. ",(0,i.jsx)(n.strong,{children:"Final state"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Rejected"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"rejected"})}),(0,i.jsxs)(n.td,{children:["The document was sent and the customer rejected it due to an inconsistency. The reason for rejection is provided in the response in the ",(0,i.jsx)(n.code,{children:"reasons"})," field. ",(0,i.jsx)(n.a,{href:"issued#criareditar-documento",children:"The document can be sent again"})," if a regularisation is requested."]})]})]})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," Ilink also returns the ",(0,i.jsx)(n.strong,{children:"EDI processing state"})," of the document (",(0,i.jsx)(n.code,{children:"state_edi_document"}),"), which is independent of the above states. For more information, see the ",(0,i.jsx)(n.a,{href:"https://www.espap.gov.pt/Imagens/Documento.ashx?id=269",children:"FE-AP Document Transmission Guide, page 7"}),". However, reading the EDI state is not always relevant for invoicing software."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["There are 3 approaches to accessing the state of a previously issued document: ",(0,i.jsx)(n.strong,{children:"Individual state consultation"}),", ",(0,i.jsx)(n.strong,{children:"State change webhook"}),", and ",(0,i.jsx)(n.strong,{children:"State report"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In ",(0,i.jsx)(n.strong,{children:"Individual state consultation"}),", simply make the call ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument",children:"GET /apps/documents/{id}"})}),". The ",(0,i.jsx)(n.code,{children:"id"})," received when creating the document must be used as a parameter to access the document in question. The state is returned in the ",(0,i.jsx)(n.code,{children:"state_document"})," field (see specification). This method only allows you to check the state of one document at a time, and as such is not recommended for customers who process a high volume of documents."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In the ",(0,i.jsx)(n.strong,{children:"State change webhook"}),", ilink takes the initiative to inform the document issuer whenever the document changes state. This is the recommended option in terms of performance and speed, but it may not be feasible if the system to be integrated belongs to a network that is not publicly exposed to ilink. For more information, see the ",(0,i.jsx)(n.a,{href:"/docs/integrations/webhooks/intro",children:"Webhooks"})," section."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In ",(0,i.jsx)(n.strong,{children:"State report"}),", the integrator application takes the initiative to consult the various events that led to changes in the state of the documents issued. To do so, simply make the call ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Hist%C3%B3rico%20de%20estados/getStatesReport",children:"GET /apps/states-report/documents"})}),". Each event identifies the document and the changed state. It is possible to filter the returned events by document ",(0,i.jsx)(n.code,{children:"id"}),", document number, date ranges, among others (see specification). This method allows the application to check the state of several documents simultaneously."]}),"\n",(0,i.jsxs)(n.p,{children:["In order to facilitate the use of state reporting, an event read endpoint is also available ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Hist%C3%B3rico%20de%20estados/postStatesReportRead",children:"POST /apps/states-report/documents/read"})}),", which allows one or more previously obtained event ",(0,i.jsx)(n.code,{children:"id"}),"s to be marked as read. Events marked as read are not returned again in the state reporting endpoint, facilitating future queries of the previous method. This option is a scalable alternative for systems that cannot implement Webhooks."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"consulta-de-estado-de-documento-enviado-via-e-mail",children:"Consultation of the state of documents sent via e-mail"}),"\n",(0,i.jsxs)(n.p,{children:["When sending documents by email, it is possible to consult the record of e-mails sent to the customer and their read state. ",(0,i.jsxs)(n.strong,{children:["Please note that the state of the returned document (",(0,i.jsx)(n.code,{children:"state_document"}),") is not applicable in this scenario"]}),", as these documents are not normally sent via EDI, and as such, their sending state will usually be ",(0,i.jsx)(n.code,{children:"to_send"}),". This state should be ignored in favour of the approaches described below:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In ",(0,i.jsx)(n.strong,{children:"Individual state consultation"}),", simply make the call ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument",children:"GET /apps/documents/{id}"})}),". The ",(0,i.jsx)(n.code,{children:"id"})," received when creating the document must be used as a parameter to access the document in question. In the response, you must access the ",(0,i.jsx)(n.code,{children:"emails"})," property, which returns a list of sent messages and their reception and reading state. This method only allows you to query the state of one document at a time and has the same limitations as the individual document query in the previous section:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'HTTP status: 200 OK\n\n{\n  "success": true,\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016",\n      ...\n      "emails": [\n        {\n          "id": "634672bab0f3b8.40302642",\n          "b_open": true, // true if the e-mail has been read by the recipient\n          "b_sent": true, // true if the e-mail was successfully sent\n          "created_at": "2022-10-12 08:54:34", // date and time of e-mail sending\n          "opened_at": "2022-10-12 09:14:16", // date and time of email reading\n          "address": {\n            "emails": ["joao.freitas@email.com"], // sending address\n          }\n        }\n      ]\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," Some email clients (Outlook, etc.) may block the reading of emails, leaving ",(0,i.jsx)(n.code,{children:"b_open"})," as false even if the email has been opened in some situations. Ilink also has the ability to detect if an email has been returned by the e-mail server, taking responsibility for successive attempts to resend it over time."]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In ",(0,i.jsx)(n.strong,{children:"Document history consultation"}),", you can consult all procedural changes to a given document. This history will list all state changes that have occurred in the document in chronological order, as well as records of e-mails sent to the recipient, allowing for complete audit tracking. It can be accessed via ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocumentHistory",children:"GET /apps/documents/{id}/history"})}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},9741:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/20230420-133914-c96ee4049998eb70825f7dcb46b5c6fb.png"}}]);