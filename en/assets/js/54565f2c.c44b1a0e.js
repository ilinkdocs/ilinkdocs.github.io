"use strict";(self.webpackChunkilink=self.webpackChunkilink||[]).push([[861],{3262:(e,o,s)=>{s.d(o,{A:()=>a});const a=s.p+"assets/images/20230420-133607-c5d03a751653d102acc0ed60c783eee4.png"},5756:(e,o,s)=>{s.d(o,{A:()=>a});const a=s.p+"assets/images/20210415-123923-45dc58da575be97ec00b5f16d9c8da41.png"},8453:(e,o,s)=>{s.d(o,{R:()=>d,x:()=>t});var a=s(6540);const n={},i=a.createContext(n);function d(e){const o=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),a.createElement(i.Provider,{value:o},e.children)}},8985:(e,o,s)=>{s.r(o),s.d(o,{assets:()=>r,contentTitle:()=>t,default:()=>m,frontMatter:()=>d,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"integrations/api/issued","title":"Emiss\xe3o de documentos","description":"\xc2mbito","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/integrations/api/issued.md","sourceDirName":"integrations/api","slug":"/integrations/api/issued","permalink":"/en/docs/integrations/api/issued","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"ilinkSidebar","previous":{"title":"Especifica\xe7\xe3o t\xe9cnica","permalink":"/en/docs/integrations/api/specification"},"next":{"title":"Rece\xe7\xe3o de documentos","permalink":"/en/docs/integrations/api/received"}}');var n=s(4848),i=s(8453);const d={},t="Emiss\xe3o de documentos",r={},c=[{value:"\xc2mbito",id:"\xe2mbito",level:2},{value:"Assinatura digital",id:"assinatura-digital",level:2},{value:"M\xe9todos de envio",id:"m\xe9todos-de-envio",level:2},{value:"Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)",id:"envio-do-xml-em-formato-ubl-21-cius-pt-ou-ubl-21-peppolbis3---encomendas",level:3},{value:"Envio dos dados estruturados do documento",id:"envio-dos-dados-estruturados-do-documento",level:3},{value:"Envio do documento",id:"envio-do-documento",level:2},{value:"Envio via EDI",id:"envio-via-edi",level:3},{value:"Envio via e-mail",id:"envio-via-e-mail",level:3},{value:"Cria\xe7\xe3o de documentos e consumo de assinaturas digitais qualificadas",id:"cria\xe7\xe3o-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas",level:3},{value:"Valida\xe7\xf5es adicionais",id:"valida\xe7\xf5es-adicionais",level:2},{value:"Criar/editar documento",id:"criareditar-documento",level:2},{value:"Acesso a documentos emitidos",id:"acesso-a-documentos-emitidos",level:2},{value:"Consulta de documentos emitidos no portal (opcional)",id:"consulta-de-documentos-emitidos-no-portal-opcional",level:2},{value:"Consulta de estado de documentos emitidos",id:"consulta-de-estado-de-documentos-emitidos",level:2},{value:"Consulta de estado de documento enviado via EDI",id:"consulta-de-estado-de-documento-enviado-via-edi",level:3},{value:"Consulta de estado de documento enviado via e-mail",id:"consulta-de-estado-de-documento-enviado-via-e-mail",level:3}];function l(e){const o={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.header,{children:(0,n.jsx)(o.h1,{id:"emiss\xe3o-de-documentos",children:"Emiss\xe3o de documentos"})}),"\n",(0,n.jsx)(o.h2,{id:"\xe2mbito",children:"\xc2mbito"}),"\n",(0,n.jsx)(o.p,{children:"A plataforma ilink permite aos sistemas integradores emitir documentos que s\xe3o automaticamente enviados aos respetivos destinat\xe1rios. O ilink gere todo o processo de envio para os ERPs e EDIs configurados para cada cliente, tornando este processo transparente para o API. Estas configura\xe7\xf5es s\xe3o realizadas pela equipa de apoio do ilink antes da entrada em produ\xe7\xe3o."}),"\n",(0,n.jsx)(o.p,{children:"A plataforma ilink suporta o envio de faturas eletr\xf3nicas em 2 cen\xe1rios distintos:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Envio de PDF assinado via e-mail para consumidores finais ou empresas privadas"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["Neste cen\xe1rio, n\xe3o \xe9 necess\xe1rio criar liga\xe7\xf5es com outros EDIs. Basta indicar no endpoint de cria\xe7\xe3o de documento o(s) endere\xe7o(s) de e-mail de destino. Para mais informa\xe7\xf5es, consulte a sec\xe7\xe3o ",(0,n.jsx)(o.a,{href:"issued#m%C3%A9todos-de-envio",children:"M\xe9todos de envio"}),"."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Envio de XML CIUS-PT para entidades p\xfablicas (obrigat\xf3rio nos contratos p\xfablicos)"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"Neste cen\xe1rio, \xe9 necess\xe1rio configurar previamente as liga\xe7\xf5es entre NIFs e, possivelmente, entre outros brokers EDI externos."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Como s\xe3o enviados os documentos para outros brokers EDI?"}),"\nDurante a fase de passagem a produ\xe7\xe3o, deve ser feito um levantamento de todas as entidades que ir\xe3o receber documentos via EDI, bem como os respetivos brokers EDI. Posteriormente, a equipa de apoio (",(0,n.jsx)(o.a,{href:"mailto:apoio@ilink.pt",children:"apoio@ilink.pt"}),") configurar\xe1 as liga\xe7\xf5es necess\xe1rias para que os documentos sejam automaticamente integrados no sistema de cada recetor. Antes de enviar documentos para a solu\xe7\xe3o FE-AP da eSPap, \xe9 tamb\xe9m necess\xe1rio que cada emissor complete o ",(0,n.jsx)(o.a,{href:"/docs/onboarding-feap",children:"processo de ades\xe3o de fornecedores FE-AP"}),"."]}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"Todos os documentos emitidos ficam dispon\xedveis no portal do ilink, tanto para a entidade emissora como para a entidade recetora."}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota: No ambiente de testes, deve emitir documentos apenas entre as 2 entidades que receberam acessos."})," Caso pretenda verificar o funcionamento do envio de documentos para um consumidor final (NIF arbitr\xe1rio), deve sempre emitir o documento atrav\xe9s de uma das entidades que receberam acessos."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"IMPORTANTE:"})," Para o envio de documentos a ",(0,n.jsx)(o.strong,{children:"entidades p\xfablicas"}),", recomendamos vivamente a implementa\xe7\xe3o dos seguintes aspetos, sob pena de n\xe3o conseguir integrar os documentos com determinados sistemas:"]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"N\xfamero de compromisso"}),"\n",(0,n.jsx)(o.li,{children:"Ficheiro PDF original da fatura"}),"\n",(0,n.jsx)(o.li,{children:"N\xfamero de encomenda ou requisi\xe7\xe3o (se aplic\xe1vel)"}),"\n",(0,n.jsx)(o.li,{children:"Capital Social do fornecedor"}),"\n",(0,n.jsx)(o.li,{children:"Endere\xe7o de e-mail do cliente (apenas para as secretarias do Governo Regional da Madeira)"}),"\n",(0,n.jsx)(o.li,{children:"Todos os dados da morada do fornecedor (rua, c\xf3digo postal, cidade, etc.)"}),"\n",(0,n.jsx)(o.li,{children:"GLN do cliente (se aplic\xe1vel)"}),"\n",(0,n.jsx)(o.li,{children:"Possibilidade de reenvio do documento mediante o estado obtido (\xfatil para corrigir e reenviar um documento previamente rejeitado)"}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"assinatura-digital",children:"Assinatura digital"}),"\n",(0,n.jsxs)(o.p,{children:["O ilink permite assinar automaticamente os anexos dos documentos emitidos (XML e PDF), desde que a entidade emissora tenha adquirido e configurado um selo de um dos provedores de assinaturas digitais qualificadas. Atualmente, apenas o ",(0,n.jsx)(o.a,{href:"https://globaltrustedsign.com/",children:"GTS - Global Trusted Sign"})," \xe9 suportado, mas existem planos para suportar os restantes provedores em Portugal."]}),"\n",(0,n.jsx)(o.p,{children:"Isto significa que o ERP n\xe3o \xe9 obrigado a integrar com um provedor de assinaturas, podendo delegar (opcionalmente) o processo de certifica\xe7\xe3o ao ilink. A alternativa ser\xe1 o pr\xf3prio ERP efetuar o processo de certifica\xe7\xe3o e enviar os documentos j\xe1 assinados para o ilink."}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," ",(0,n.jsx)(o.strong,{children:"No cen\xe1rio de assinatura via ilink, por defeito, todos os ficheiros resultantes s\xe3o assinados no momento de entrada (xml e pdf)"}),", sendo posteriormente enviados ao cliente. Este comportamento pode ser alterado, permitindo definir que ficheiros s\xe3o assinados. Para mais informa\xe7\xf5es, consulte a se\xe7\xe3o sobre o ",(0,n.jsx)(o.a,{href:"issued#cria%C3%A7%C3%A3o-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas",children:"consumo de assinaturas"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"No caso de assinatura via ERP, a assinatura digital do documento \xe9 sempre validada criptograficamente para todos os documentos que entram no sistema"}),". Um documento com assinatura inv\xe1lida, tanto no XML como no PDF, n\xe3o integrar\xe1 e retornar\xe1 sempre um erro via API como o seguinte:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "document": {\n      "code": "e217",\n      "msg": "A assinatura do documento n\xe3o \xe9 v\xe1lida."\n    }\n  }\n}\n'})}),"\n",(0,n.jsxs)(o.p,{children:["O erro anterior indica que o documento sofreu altera\xe7\xf5es desde o momento da assinatura, ou que a assinatura foi gerada incorretamente. O seguinte ",(0,n.jsx)(o.a,{href:"https://ec.europa.eu/cefdigital/DSS/webapp-demo/validation",children:"validador"})," pode ser utilizado para verificar a validade da assinatura dos documentos. Os formatos de assinatura reconhecidos pelo ilink s\xe3o ",(0,n.jsx)(o.a,{href:"https://www.adobe.com/uk/acrobat/resources/document-files/pdf-types/pades.html",children:"PADES"})," e PKCS7-B (PDF), ou XMLDSig e ",(0,n.jsx)(o.a,{href:"https://en.wikipedia.org/wiki/XAdES",children:"XADES-BES"})," (XML)."]}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," Os requisitos legais de assinatura das faturas eletr\xf3nicas est\xe3o dispon\xedveis no ",(0,n.jsx)(o.a,{href:"https://dre.pt/home/-/dre/119622094/details/maximized",children:"Decreto-Lei 28/2019, sec\xe7\xe3o II, artigo 12\xba"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," O ilink assina os documentos PDF em ",(0,n.jsx)(o.a,{href:"https://www.adobe.com/uk/acrobat/resources/document-files/pdf-types/pades.html",children:"PADES"})," e os documentos XML em ",(0,n.jsx)(o.a,{href:"https://en.wikipedia.org/wiki/XAdES",children:"XADES-BES"})," ",(0,n.jsx)(o.a,{href:"https://docs.microsoft.com/en-us/previous-versions/windows/desktop/ms767623%28v=vs.85%29",children:"enveloped"}),"."]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"m\xe9todos-de-envio",children:"M\xe9todos de envio"}),"\n",(0,n.jsx)(o.p,{children:"Ap\xf3s efetuada a autentica\xe7\xe3o com sucesso, estamos em condi\xe7\xf5es de come\xe7ar a enviar documentos.\nO API do ilink disponibiliza duas abordagens para o envio de documentos:"}),"\n",(0,n.jsx)(o.h3,{id:"envio-do-xml-em-formato-ubl-21-cius-pt-ou-ubl-21-peppolbis3---encomendas",children:"Envio do XML em formato UBL 2.1 CIUS-PT (ou UBL 2.1 PEPPOLBIS3 - Encomendas)"}),"\n",(0,n.jsxs)(o.p,{children:["Neste m\xe9todo, o sistema integrador deve gerar corretamente o ficheiro XML antes de envi\xe1-lo para o ilink. A eSPap disponibiliza a especifica\xe7\xe3o t\xe9cnica do formato CIUS-PT ",(0,n.jsx)(o.a,{href:"https://www.espap.gov.pt/Imagens/Documento.ashx?id=265",children:"aqui"}),"."]}),"\n",(0,n.jsxs)(o.p,{children:["Todos os ficheiros XML enviados por este m\xe9todo ",(0,n.jsx)(o.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"s\xe3o validados de acordo com o validador oficial da eSPap, vers\xe3o 2.1.2"}),", e o API retornar\xe1 um erro caso se verifiquem inconsist\xeancias sint\xe1ticas. A eSPap disponibiliza um ",(0,n.jsx)(o.a,{href:"https://www.espap.gov.pt/Imagens/Documento.ashx?id=267",children:"validador Schematron"})," que implementa todas as valida\xe7\xf5es da ",(0,n.jsx)(o.a,{href:"https://ec.europa.eu/digital-building-blocks/sites/spaces/DIGITAL/pages/467108950/EN+16931+compliance",children:"Norma Europeia EN16931 CIUS"})," e as valida\xe7\xf5es adicionais do CIUS-PT, estando dispon\xedvel online ",(0,n.jsx)(o.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"neste link"}),". ",(0,n.jsxs)(o.strong,{children:["Se os ficheiros validam sintaticamente no ",(0,n.jsx)(o.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"validador online"}),", ent\xe3o dever\xe3o validar no ilink, com exce\xe7\xe3o das ",(0,n.jsx)(o.a,{href:"issued#valida%C3%A7%C3%B5es-adicionais",children:"valida\xe7\xf5es adicionais"})," definidas pelo destinat\xe1rio do documento."]})]}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," Para incluir um ficheiro ",(0,n.jsx)(o.strong,{children:"PDF"})," na fatura eletr\xf3nica e consultar outros casos de uso, consulte a sec\xe7\xe3o ",(0,n.jsx)(o.a,{href:"usecases#cria%C3%A7%C3%A3o-de-documentos-por-envio-do-cius-pt",children:"casos de uso"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," A eSPap tamb\xe9m disponibiliza v\xe1rios ",(0,n.jsx)(o.a,{href:"https://www.espap.gov.pt/Imagens/Documento.ashx?id=254",children:"exemplos do CIUS-PT"}),"."]}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"Alguns exemplos de erros no processo de valida\xe7\xe3o XML:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "document": {\n      "code": "e217",\n      "msg": "[BR-CO-25]-Caso o valor a pagar (BT-115) seja positivo, deve indicar a data de vencimento (BT-9) ou a nota da condi\xe7\xe3o de pagamento (BT-20)."\n    }\n  }\n}\n'})}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "document": {\n      "code": "e217",\n      "msg": "[DT-CIUS-PT-166]-Amount due for payment (BT-115) = Invoice total amount with VAT (BT-112) -Paid amount (BT-113) +Rounding amount (BT-114), with an acceptance range of 1.00 \u20ac (it does not mean that this tolerance is accepted by the customer)."\n    }\n  }\n}\n'})}),"\n",(0,n.jsxs)(o.p,{children:["O m\xe9todo a utilizar para envio do XML \xe9 o ",(0,n.jsx)(o.strong,{children:(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"POST /apps/documentsUBL"})}),". Neste contexto, ",(0,n.jsx)(o.strong,{children:"a chave p\xfablica identifica o emissor do documento"})," e deve corresponder \xe0 chave associada ao NIF do emissor especificado no XML (",(0,n.jsx)(o.code,{children:"AccountingSupplierParty>Party>PartyTaxScheme>CompanyID"})," para faturas/notas de cr\xe9dito, ou ",(0,n.jsx)(o.code,{children:"AccountingCustomerParty>Party>PartyTaxScheme>CompanyID"})," para encomendas). Caso isto n\xe3o se verifique, o API retornar\xe1 o seguinte erro:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "supplier": {\n      "code": "e199",\n      "msg": "A entidade criadora do documento deve ser cliente ou fornecedor do novo documento."\n    }\n  }\n}\n'})}),"\n",(0,n.jsxs)(o.p,{children:["Se o XML for v\xe1lido e respeitar todas as valida\xe7\xf5es da norma, bem como todas as ",(0,n.jsx)(o.a,{href:"issued#valida%C3%A7%C3%B5es-adicionais",children:"regras de neg\xf3cio adicionais do recetor"}),", o API retorna uma resposta de sucesso, juntamente com os dados principais do documento criado:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'HTTP status: 201 Created\n\n{\n  "success": true,\n  "message": {\n    "code": "s011",\n    "msg": "Documento criado com sucesso"\n  },\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016",\n      "number": "7411111",\n      "emission_date": "2021-04-15",\n      "type_document_fact": {\n        "id": "5c9cb870a5ef57.36583702",\n        "code": "380",\n        "alias": "invoice",\n        "type": "FT",\n        "description": "Fatura"\n      },\n      "type_document": {\n        "alias": "issued",\n        "description": "Emitido"\n      },\n      "state_document": {\n        "id": "5c9cb878745b16.4225687",\n        "alias": "sent",\n        "description": "Enviado ao cliente."\n      }\n    }\n  }\n}\n'})}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," Um documento \xe9 enviado com sucesso ao destinat\xe1rio via EDI quando o campo ",(0,n.jsx)(o.code,{children:"state_document.alias"})," tem o valor ",(0,n.jsx)(o.code,{children:"sent"})," ou ",(0,n.jsx)(o.code,{children:"accepted"}),". Caso pretenda apenas que o documento seja enviado via e-mail, o estado do documento deve ser ignorado, devendo consultar alternativamente o registo dos e-mails enviados atrav\xe9s da ",(0,n.jsx)(o.a,{href:"issued#consulta-de-estado-de-documento-enviado-via-e-mail",children:"consulta de estado"}),"."]}),"\n"]}),"\n",(0,n.jsx)(o.h3,{id:"envio-dos-dados-estruturados-do-documento",children:"Envio dos dados estruturados do documento"}),"\n",(0,n.jsxs)(o.p,{children:["Ao adotar esta op\xe7\xe3o, o ERP dispensa a gera\xe7\xe3o completa do XML, ficando o ilink respons\xe1vel por gerar o XML final. Assim, o ERP necessita apenas de enviar ao ilink todos os dados referentes ao documento. O endpoint a adotar aqui \xe9 o ",(0,n.jsx)(o.strong,{children:(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"POST /apps/documents"})})]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"img info",src:s(5756).A+"",width:"1490",height:"895"})}),"\n",(0,n.jsxs)(o.p,{children:["A especifica\xe7\xe3o deste m\xe9todo \xe9 extensa, pois abrange todos os campos poss\xedveis de uma fatura/encomenda, que est\xe3o devidamente documentados na especifica\xe7\xe3o. Todos os documentos criados por este endpoint est\xe3o sujeitos \xe0s mesmas valida\xe7\xf5es que os documentos enviados pelo m\xe9todo ",(0,n.jsx)(o.strong,{children:(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"POST /apps/documentsUBL"})}),", ou seja, o XML resultante dos dados inseridos ser\xe1 validado de acordo com o validador oficial da eSPap, que pode ser consultado online ",(0,n.jsx)(o.a,{href:"https://ppr-svc.feap.gov.pt/Doc.Client/public/CIUSvalidation/PT?language=pt",children:"neste link"}),", e segundo as ",(0,n.jsx)(o.a,{href:"issued#valida%C3%A7%C3%B5es-adicionais",children:"regras de neg\xf3cio adicionais"})," do recetor do documento, caso existam."]}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," Para incluir um ficheiro ",(0,n.jsx)(o.strong,{children:"PDF"})," na fatura eletr\xf3nica e outras situa\xe7\xf5es habituais, consulte a sec\xe7\xe3o ",(0,n.jsx)(o.a,{href:"usecases#cria%C3%A7%C3%A3o-de-documentos-por-envio-de-dados",children:"casos de uso"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," \xc9 poss\xedvel enviar v\xe1rios anexos num documento atrav\xe9s do campo ",(0,n.jsx)(o.code,{children:"files[]"})," (ver especifica\xe7\xe3o acima). Contudo, a representa\xe7\xe3o visual do documento (i.e. PDF original da fatura usado na impress\xe3o) deve ser enviada sempre no campo ",(0,n.jsx)(o.code,{children:"file"}),", sendo o campo ",(0,n.jsx)(o.code,{children:"files[]"})," reservado para ficheiros adicionais (notas de encomenda, avisos de despacho, guias de transporte, etc.). ",(0,n.jsx)(o.strong,{children:"Se o emissor do documento tem uma assinatura digital ativa no ilink, todos os anexos ser\xe3o assinados por defeito"}),", e o consumo de transa\xe7\xf5es ter\xe1 em conta a soma do tamanho ocupado por todos os anexos enviados (\xe9 debitada 1 transa\xe7\xe3o por cada 1MB de anexos enviados)."]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"envio-do-documento",children:"Envio do documento"}),"\n",(0,n.jsx)(o.h3,{id:"envio-via-edi",children:"Envio via EDI"}),"\n",(0,n.jsxs)(o.p,{children:["Um documento, ap\xf3s cria\xe7\xe3o com sucesso por qualquer um dos m\xe9todos descritos (",(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"envio de XML"})," ou ",(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"envio de dados"}),"), ser\xe1 enviado automaticamente ao destinat\xe1rio por EDI. Contudo, em casos pontuais, este poder\xe1 n\xe3o ser entregue imediatamente via EDI devido a configura\xe7\xf5es em falta e/ou outras anomalias na plataforma ilink ou no sistema do recetor. Caso isto se verifique, ser\xe1 devolvido um campo ",(0,n.jsx)(o.code,{children:"to_send_status"})," na resposta do documento para detalhar a situa\xe7\xe3o:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'HTTP status: 201 OK\n\n{\n  "success": true,\n  "message": {\n    "code": "s011",\n    "msg": "Documento criado com sucesso"\n  },\n  "response": {\n    "data": {\n      "id":"60796c3c2a6fa2.53909016",\n      "state_document": {\n        "id": "5c9cb870f34b16.42025494",\n        "alias": "tosend",\n        "description": "Por enviar ao cliente."\n      },\n      "to_send_status": {\n        "code": "sent_connection",\n        "title": "Aguardar a aceita\xe7\xe3o de liga\xe7\xe3o com o destinat\xe1rio do documento."\n      }\n    }\n  }\n}\n'})}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," Pode verificar que o documento ",(0,n.jsx)(o.strong,{children:"N\xc3O"})," foi entregue via EDI pois o campo ",(0,n.jsx)(o.code,{children:"state_document.alias"})," assume o valor ",(0,n.jsx)(o.code,{children:"tosend"})," e o motivo de erro encontra-se descrito no campo ",(0,n.jsx)(o.code,{children:"to_send_status"}),". Nesta situa\xe7\xe3o, \xe9 necess\xe1rio primeiro concluir a liga\xe7\xe3o EDI com o destinat\xe1rio e depois proceder ao reenvio."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["Os motivos poss\xedveis (",(0,n.jsx)(o.code,{children:"code"}),") para um documento n\xe3o ser entregue s\xe3o:"]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"sent_connection"}),", ",(0,n.jsx)(o.code,{children:"no_connection"}),": Liga\xe7\xe3o com o destinat\xe1rio em falta"]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"registered_entity"}),": O destinat\xe1rio n\xe3o est\xe1 registado no ilink"]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.code,{children:"received_pay_transactions"}),": O destinat\xe1rio suporta os custos dos documentos recebidos mas n\xe3o disp\xf5e de transa\xe7\xf5es suficientes para o envio do documento"]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["Ap\xf3s regularizar a situa\xe7\xe3o de erro, ser\xe1 poss\xedvel enviar o documento novamente (ver sec\xe7\xe3o de ",(0,n.jsx)(o.a,{href:"issued#criareditar-documento",children:"reenvio de documentos"}),")."]}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota"}),": O estado do documento (",(0,n.jsx)(o.code,{children:"state_document"}),") \xe9 apenas aplic\xe1vel a envios EDI. Caso o documento seja apenas enviado para um cliente arbitr\xe1rio via e-mail (PDF), o estado de envio n\xe3o reflete o envio do e-mail. Consulte a seguinte ",(0,n.jsx)(o.a,{href:"issued#consulta-de-estado-de-documento-enviado-via-e-mail",children:"sec\xe7\xe3o"})," para mais informa\xe7\xf5es."]}),"\n"]}),"\n",(0,n.jsx)(o.h3,{id:"envio-via-e-mail",children:"Envio via e-mail"}),"\n",(0,n.jsxs)(o.p,{children:["Um documento, ap\xf3s cria\xe7\xe3o com sucesso (HTTP status 201) por qualquer um dos m\xe9todos descritos (",(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"envio de XML"})," ou ",(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"envio de dados"}),"), ser\xe1 remetido via e-mail ao destinat\xe1rio caso seja especificado o campo ",(0,n.jsx)(o.code,{children:"send_by_email"})," com o valor ",(0,n.jsx)(o.code,{children:"1"}),". O(s) endere\xe7o(s) do(s) recetor(es) do documento pode(m) ser especificado(s) de 3 formas:"]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["no campo ",(0,n.jsx)(o.code,{children:"additional_emails[]"})," (em ambos os m\xe9todos de envio)"]}),"\n",(0,n.jsxs)(o.li,{children:["no campo ",(0,n.jsx)(o.code,{children:"customer[email]"})," (apenas no m\xe9todo de envio de dados)"]}),"\n",(0,n.jsxs)(o.li,{children:["no elemento ",(0,n.jsx)(o.code,{children:"cac:AccountingCustomerParty/cac:Party/cac:Contact/cbc:ElectronicMail"})," do XML (apenas no m\xe9todo de envio de XML)."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["Para consultar o envio dos e-mails e leitura dos mesmos pelo cliente, ver sec\xe7\xe3o de ",(0,n.jsx)(o.a,{href:"issued#consulta-de-estado-de-documentos-emitidos",children:"consulta de estado de documentos emitidos"}),"."]}),"\n",(0,n.jsx)(o.h3,{id:"cria\xe7\xe3o-de-documentos-e-consumo-de-assinaturas-digitais-qualificadas",children:"Cria\xe7\xe3o de documentos e consumo de assinaturas digitais qualificadas"}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota"}),": Esta sec\xe7\xe3o \xe9 apenas relevante para clientes que utilizam o ilink para assinar digitalmente os documentos emitidos. ",(0,n.jsx)(o.a,{href:"issued#assinatura-digital",children:"Ver detalhes"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["Caso esteja configurada uma assinatura digital qualificada no ilink, todos os documentos ser\xe3o assinados no momento da sua cria\xe7\xe3o, incluindo todos os ficheiros resultantes da fatura eletr\xf3nica (xml e pdf). Dado que a assinatura dos documentos n\xe3o \xe9 obrigat\xf3ria por lei em todos os cen\xe1rios de utiliza\xe7\xe3o, \xe9 poss\xedvel controlar individualmente a assinatura dos ficheiros xml e pdf no momento da cria\xe7\xe3o do documento atrav\xe9s dos campos ",(0,n.jsx)(o.code,{children:"disable_xml_sign"})," e ",(0,n.jsx)(o.code,{children:"disable_pdf_sign"}),", dispon\xedveis em ambos os m\xe9todos de cria\xe7\xe3o de documento (",(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"XML"})," ou ",(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"dados"}),"). Isto permite reduzir o consumo de assinaturas digitais, bem como otimizar o processo de cria\xe7\xe3o de documentos."]}),"\n",(0,n.jsx)(o.p,{children:"Ou seja:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["No envio de fatura digital via ",(0,n.jsx)(o.strong,{children:"PDF assinado para um consumidor final ou cliente privado"}),", n\xe3o ser\xe1 obrigat\xf3rio assinar o ficheiro XML resultante, pelo que recomendamos a utiliza\xe7\xe3o do campo ",(0,n.jsx)(o.code,{children:"disable_xml_sign: 1"}),"."]}),"\n",(0,n.jsxs)(o.li,{children:["No envio de fatura eletr\xf3nica para a ",(0,n.jsx)(o.strong,{children:"Administra\xe7\xe3o P\xfablica via EDI"})," (exemplo eSPap), n\xe3o \xe9 obrigat\xf3rio assinar o documento, no entanto \xe9 sempre poss\xedvel assinar ambos os ficheiros por motivos de seguran\xe7a adicional e integridade. Se pretende, por exemplo, desativar a assinatura digital do anexo PDF, basta usar a op\xe7\xe3o ",(0,n.jsx)(o.code,{children:"disable_pdf_sign: 1"}),"."]}),"\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.strong,{children:"Os campos acima descritos apenas t\xeam efeito quando o emissor do documento usa uma assinatura digital qualificada no ilink."})}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"valida\xe7\xf5es-adicionais",children:"Valida\xe7\xf5es adicionais"}),"\n",(0,n.jsx)(o.p,{children:"O recetor da fatura pode configurar no ilink requisitos adicionais para determinados campos (regras de neg\xf3cio), mesmo quando estes n\xe3o s\xe3o obrigat\xf3rios na especifica\xe7\xe3o CIUS-PT. Por exemplo, um cliente pode definir que apenas aceita faturas com o ficheiro PDF em anexo ou com o n\xfamero de compromisso especificado. \xc9 fundamental que estes requisitos sejam acordados previamente com o cliente/destinat\xe1rio antes da entrada em produ\xe7\xe3o, de forma a evitar erros de integra\xe7\xe3o."}),"\n",(0,n.jsx)(o.p,{children:"Caso o recetor do documento obrigue \xe0 presen\xe7a de algum campo n\xe3o especificado no XML, o API retornar\xe1 um erro como abaixo e o documento n\xe3o ser\xe1 gerado:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "commitment_number": {\n      "code": "e048",\n      "msg": "O n\xfamero de compromisso \xe9 obrigat\xf3rio."\n    }\n  }\n}\n'})}),"\n",(0,n.jsxs)(o.p,{children:["Note-se que apenas s\xe3o retornados erros neste formato quando o receptor do documento \xe9 cliente ilink e tem as devidas regras de neg\xf3cio configuradas na plataforma. Quando um documento \xe9 enviado a um sistema EDI externo, qualquer falha no processo de valida\xe7\xe3o \xe9 normalmente comunicada num momento futuro via altera\xe7\xe3o de estado para ",(0,n.jsx)(o.strong,{children:"Rejeitado"}),", com a devida mensagem de erro. \xc9 importante notar que nem todos os sistemas EDI suportam envio de mensagens de estado."]}),"\n",(0,n.jsx)(o.h2,{id:"criareditar-documento",children:"Criar/editar documento"}),"\n",(0,n.jsx)(o.p,{children:"Um documento pode ser editado e reenviado ao destinat\xe1rio:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["se ",(0,n.jsx)(o.strong,{children:"ainda n\xe3o foi enviado"})," ao cliente final"]}),"\n",(0,n.jsxs)(o.li,{children:["ou se ",(0,n.jsx)(o.strong,{children:"j\xe1 foi enviado ao cliente e o cliente pediu uma regulariza\xe7\xe3o"})]}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"Em termos pr\xe1ticos, a possibilidade de reenvio pode ser consultada atrav\xe9s do seguinte campo de resposta do documento:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:"\"state_edi_document\": {\n  \"alias\": <estado> // estados poss\xedveis de reenvio: 'regularization' ou 'reception' ou 'error'\n}\n"})}),"\n",(0,n.jsxs)(o.p,{children:["Para consultar o estado de um documento, ver sec\xe7\xe3o de ",(0,n.jsx)(o.a,{href:"issued#consulta-de-estado-de-documentos-emitidos",children:"consulta de estado de documentos emitidos"}),"."]}),"\n",(0,n.jsxs)(o.p,{children:["Para editar um documento existente, basta repetir o pedido ",(0,n.jsx)(o.strong,{children:(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocumentUBL",children:"POST /apps/documentsUBL"})})," ou ",(0,n.jsx)(o.strong,{children:(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/postDocument",children:"POST /apps/documents"})})," com os dados corrigidos, mantendo o ",(0,n.jsx)(o.strong,{children:"n\xfamero, tipo e data de emiss\xe3o"})," do documento anterior:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-javascript",children:'HTTP status: 200 OK\n\n{\n  "success": true,\n  "message": {\n    "code": "s012",\n    "msg": "Documento editado com sucesso"\n  },\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016",\n      "number": "7411111",\n      "emission_date": "2021-04-16",\n      "type_document_fact": {\n        "id": "5c9cb870a5ef57.36583702",\n        "code": "380",\n        "alias": "invoice",\n        "type": "FT",\n        "description": "Fatura"\n      },\n      "type_document": {\n        "alias": "issued",\n        "description": "Emitido"\n      },\n      "state_document": {\n        "id": "5c9cb870f34b16.42025494",\n        "alias": "tosend",\n        "description": "Por enviar ao cliente."\n      }\n    }\n  }\n}\n\n'})}),"\n",(0,n.jsx)(o.p,{children:"Caso o documento n\xe3o seja eleg\xedvel para edi\xe7\xe3o (i.e. j\xe1 foi enviado ou foi aceite pelo cliente final), ser\xe1 apresentado um erro ao tentar reenviar:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'HTTP status: 400 Bad request\n\n{\n  "success": false,\n  "errors": {\n    "number": {\n      "code": "e200",\n      "msg": "Documento j\xe1 existe."\n    }\n  }\n}\n'})}),"\n",(0,n.jsx)(o.h2,{id:"acesso-a-documentos-emitidos",children:"Acesso a documentos emitidos"}),"\n",(0,n.jsxs)(o.p,{children:["Quando um documento \xe9 registado com sucesso, ser\xe1 sempre devolvido um ",(0,n.jsx)(o.code,{children:"id"})," nas respostas, que o identifica perante o ilink. \xc9 \xfatil guardar este identificador para consultas futuras ao documento."]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'HTTP status: 201 Created\n\n{\n  "success": true,\n  "message": {\n    "code": "s011",\n    "msg": "Documento criado com sucesso"\n  },\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016"\n    }\n  }\n}\n'})}),"\n",(0,n.jsxs)(o.p,{children:["O API permite tamb\xe9m aceder a todos os dados (inclusive ao XML e PDF gerados) de todos os documentos previamente emitidos. Para tal, deve usar o m\xe9todo ",(0,n.jsx)(o.strong,{children:(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument",children:"GET /apps/documents/{id}"})}),". O ",(0,n.jsx)(o.code,{children:"id"})," recebido na cria\xe7\xe3o do documento deve ser usado como par\xe2metro aqui para aceder ao documento em quest\xe3o."]}),"\n",(0,n.jsx)(o.p,{children:"Todos os dados retornados por este m\xe9todo est\xe3o dispon\xedveis na especifica\xe7\xe3o."}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota"}),": Caso a entidade emissora do documento tenha configurado a assinatura autom\xe1tica de documentos no ilink, os URLs de acesso ao XML e ao PDF j\xe1 retornam os ficheiros assinados."]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"consulta-de-documentos-emitidos-no-portal-opcional",children:"Consulta de documentos emitidos no portal (opcional)"}),"\n",(0,n.jsxs)(o.p,{children:["Os documentos podem tamb\xe9m ser consultados no ",(0,n.jsx)(o.a,{href:"https://ilink.acin.pt",children:"portal de testes do ilink"})," usando as credenciais das entidades que foram fornecidas. Aqui pode validar visualmente se a informa\xe7\xe3o apresentada est\xe1 coerente com os dados enviados via API:"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"img info",src:s(3262).A+"",width:"1596",height:"839"})}),"\n",(0,n.jsx)(o.p,{children:"Para aceder aos anexos de um documento, deve aceder ao documento da tabela e clicar no \xedcone da lupa:"}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"img info",src:s(9741).A+"",width:"1605",height:"838"})}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," Os documentos dever\xe3o estar presentes tanto na entidade emissora (sec\xe7\xe3o de documentos emitidos), como na entidade recetora (sec\xe7\xe3o de documentos recebidos)."]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"consulta-de-estado-de-documentos-emitidos",children:"Consulta de estado de documentos emitidos"}),"\n",(0,n.jsx)(o.p,{children:"\xc9 tamb\xe9m poss\xedvel aceder ao estado atual dos documentos previamente emitidos. Esta opera\xe7\xe3o permite ao emissor do documento consultar se o documento foi aceite pelo cliente, ou se est\xe1 pendente de reenvio/regulariza\xe7\xe3o, bem como os motivos que levaram a tal."}),"\n",(0,n.jsx)(o.h3,{id:"consulta-de-estado-de-documento-enviado-via-edi",children:"Consulta de estado de documento enviado via EDI"}),"\n",(0,n.jsxs)(o.p,{children:["O ilink contempla 4 estados simplificados de documento na propriedade ",(0,n.jsx)(o.code,{children:"state_document"}),":"]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Por enviar"})," (",(0,n.jsx)(o.code,{children:"tosend"}),") - o documento n\xe3o foi enviado ao cliente. Provavelmente significa que falta alguma configura\xe7\xe3o no ilink, emissor/recetor n\xe3o autorizam liga\xe7\xe3o entre eles, ou que alguma das entidades presentes no documento n\xe3o tem transa\xe7\xf5es suficientes para proceder ao envio. Se apenas se pretende que o documento seja remetido via email, este estado deve ser ignorado."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Enviado"})," (",(0,n.jsx)(o.code,{children:"sent"}),") - o documento foi enviado ao cliente e est\xe1 pendente de aceita\xe7\xe3o. Note-se que nem todos os sistemas dos destinat\xe1rios suportam a comunica\xe7\xe3o de estados, pelo que alguns documentos poder\xe3o nunca sair deste estado."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Aceite"})," (",(0,n.jsx)(o.code,{children:"accepted"}),") - o documento foi enviado e o cliente aprovou o documento. ",(0,n.jsx)(o.strong,{children:"Estado final"}),"."]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Recusado"})," (",(0,n.jsx)(o.code,{children:"rejected"}),") - o documento foi enviado e o cliente rejeitou o mesmo devido a uma incoer\xeancia. O motivo de recusa \xe9 disponibilizado na resposta no campo ",(0,n.jsx)(o.code,{children:"reasons"}),". ",(0,n.jsx)(o.a,{href:"issued#criareditar-documento",children:"O documento poder\xe1 ser enviado novamente"})," caso seja solicitada uma regulariza\xe7\xe3o."]}),"\n"]}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," O ilink devolve tamb\xe9m o ",(0,n.jsx)(o.strong,{children:"estado de processamento EDI"})," do documento (",(0,n.jsx)(o.code,{children:"state_edi_document"}),"), que \xe9 independente dos estados acima. Para mais informa\xe7\xe3o, consulte o ",(0,n.jsx)(o.a,{href:"https://www.espap.gov.pt/Imagens/Documento.ashx?id=269",children:"Guia de Transmiss\xe3o de Documentos FE-AP, p\xe1gina 7"}),". Contudo, a leitura do estado EDI nem sempre \xe9 relevante para os softwares de fatura\xe7\xe3o."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["Existem 3 abordagens para aceder ao estado de um documento previamente emitido: ",(0,n.jsx)(o.strong,{children:"Consulta individual"}),", ",(0,n.jsx)(o.strong,{children:"Webhook de mudan\xe7a de estado"})," e ",(0,n.jsx)(o.strong,{children:"Reporte de estados"}),"."]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsxs)(o.p,{children:["Na ",(0,n.jsx)(o.strong,{children:"Consulta individual de estado"}),", basta efetuar a chamada ",(0,n.jsx)(o.strong,{children:(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument",children:"GET /apps/documents/{id}"})}),". O ",(0,n.jsx)(o.code,{children:"id"})," recebido na cria\xe7\xe3o do documento deve ser usado como par\xe2metro para aceder ao documento em quest\xe3o. O estado \xe9 devolvido no campo ",(0,n.jsx)(o.code,{children:"state_document"})," (ver especifica\xe7\xe3o). Este m\xe9todo apenas permite consultar o estado de um documento de cada vez, e como tal n\xe3o \xe9 recomendado para clientes que processam um volume elevado de documentos."]}),"\n"]}),"\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsxs)(o.p,{children:["No ",(0,n.jsx)(o.strong,{children:"Webhook de mudan\xe7a de estado"}),", o ilink tem a iniciativa de informar o emissor do documento sempre que o mesmo muda de estado. Esta \xe9 a op\xe7\xe3o recomendada em termos de desempenho e rapidez, mas pode n\xe3o ser vi\xe1vel caso o sistema a integrar perten\xe7a a uma rede n\xe3o exposta publicamente ao ilink. Para mais informa\xe7\xe3o, consulte a sec\xe7\xe3o ",(0,n.jsx)(o.a,{href:"/docs/integrations/webhooks/intro",children:"Webhooks"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(o.li,{children:["\n",(0,n.jsxs)(o.p,{children:["No ",(0,n.jsx)(o.strong,{children:"Reporte de estados"}),", a aplica\xe7\xe3o integradora tem a iniciativa de consultar os diversos eventos que levaram \xe0s altera\xe7\xf5es de estado dos documentos emitidos. Para tal, basta efetuar a chamada ",(0,n.jsx)(o.strong,{children:(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Hist%C3%B3rico%20de%20estados/getStatesReport",children:"GET /apps/states-report/documents"})}),". Cada evento identifica o documento e o estado alterados. \xc9 poss\xedvel filtrar os eventos retornados por ",(0,n.jsx)(o.code,{children:"id"})," de documento, n\xfamero de documento, intervalos de datas, entre outros (ver especifica\xe7\xe3o). Este m\xe9todo permite \xe0 aplica\xe7\xe3o consultar o estado de v\xe1rios documentos em simult\xe2neo."]}),"\n",(0,n.jsxs)(o.p,{children:["De modo a facilitar a utiliza\xe7\xe3o do reporte de estados, \xe9 adicionalmente disponibilizado o endpoint de leitura de eventos ",(0,n.jsx)(o.strong,{children:(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Hist%C3%B3rico%20de%20estados/postStatesReportRead",children:"POST /apps/states-report/documents/read"})}),", que permite marcar um ou mais ",(0,n.jsx)(o.code,{children:"id"}),"s de evento obtidos anteriormente como lidos. Os eventos marcados como lidos n\xe3o s\xe3o retornados novamente no endpoint de reporte de estados, facilitando a consulta futura do m\xe9todo anterior. Esta op\xe7\xe3o \xe9 uma alternativa escal\xe1vel para os sistemas que n\xe3o podem implementar Webhooks."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(o.h3,{id:"consulta-de-estado-de-documento-enviado-via-e-mail",children:"Consulta de estado de documento enviado via e-mail"}),"\n",(0,n.jsxs)(o.p,{children:["No cen\xe1rio de envio de documentos por e-mail, \xe9 poss\xedvel consultar o registo de envio e de leitura dos e-mails remetidos ao cliente. ",(0,n.jsxs)(o.strong,{children:["Note-se que o estado do documento retornado (",(0,n.jsx)(o.code,{children:"state_document"}),") n\xe3o \xe9 aplic\xe1vel neste cen\xe1rio"]}),", pois estes documentos por norma n\xe3o s\xe3o enviados via EDI, e como tal, o seu estado de envio ser\xe1 habitualmente ",(0,n.jsx)(o.code,{children:"to_send"}),". Este estado deve ser ignorado a favor das abordagens abaixo descritas:"]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["Na ",(0,n.jsx)(o.strong,{children:"Consulta individual"}),", basta efetuar a chamada ",(0,n.jsx)(o.strong,{children:(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocument",children:"GET /apps/documents/{id}"})}),". O ",(0,n.jsx)(o.code,{children:"id"})," recebido na cria\xe7\xe3o do documento deve ser usado como par\xe2metro para aceder ao documento em quest\xe3o. Na resposta, deve aceder \xe0 propriedade ",(0,n.jsx)(o.code,{children:"emails"}),", que retorna uma lista das mensagens enviadas e o seu estado de rece\xe7\xe3o e leitura. Este m\xe9todo apenas permite consultar o estado de um documento de cada vez e tem as mesmas limita\xe7\xf5es que a consulta individual de documentos da sec\xe7\xe3o anterior:"]}),"\n"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'HTTP status: 200 OK\n\n{\n  "success": true,\n  "response": {\n    "data": {\n      "id": "60796c3c2a6fa2.53909016",\n      ...\n      "emails": [\n        {\n          "id": "634672bab0f3b8.40302642",\n          "b_open": true, // true caso o email tenha sido lido pelo recetor\n          "b_sent": true, // true caso o email tenha sido enviado com sucesso\n          "created_at": "2022-10-12 08:54:34", // data e hora de envio do email\n          "opened_at": "2022-10-12 09:14:16", // data e hora de leitura do email\n          "address": {\n            "emails": ["joao.freitas@email.com"], // endere\xe7o de envio\n          }\n        }\n      ]\n    }\n  }\n}\n'})}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Nota:"})," Alguns clientes de e-mail (Outlook, etc.) podem bloquear o registo de leitura dos e-mails, ficando o ",(0,n.jsx)(o.code,{children:"b_open"})," a false mesmo que o e-mail tenha sido aberto em algumas situa\xe7\xf5es. O ilink tem tamb\xe9m a capacidade de detetar se um email foi devolvido pelo servidor de email, ficando respons\xe1vel por tentativas sucessivas de reenvio ao longo do tempo."]}),"\n"]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["Na ",(0,n.jsx)(o.strong,{children:"Consulta de hist\xf3rico de documento"})," \xe9 poss\xedvel consultar todas as altera\xe7\xf5es processuais de um determinado documento. Este hist\xf3rico ir\xe1 listar todas as altera\xe7\xf5es de estado que ocorreram no documento por ordem cronol\xf3gica, bem como os registos dos envios de e-mail para o destinat\xe1rio, o que permite um rastreio completo de auditoria. Pode ser acedido atrav\xe9s de ",(0,n.jsx)(o.strong,{children:(0,n.jsx)(o.a,{href:"https://ilink.acin.pt/swagger-ui/dist/index.html#/Documentos/getDocumentHistory",children:"GET /apps/documents/{id}/history"})}),"."]}),"\n"]})]})}function m(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},9741:(e,o,s)=>{s.d(o,{A:()=>a});const a=s.p+"assets/images/20230420-133914-c96ee4049998eb70825f7dcb46b5c6fb.png"}}]);